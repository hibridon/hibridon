<TITLE>optimization</TITLE><h3><center><font color=#brown >Optimization of integration parameters</h3></font><hr></center>Optimization subsections:<p><center>   <a href=#logdopt>RSTART and LOGD</a> | <a href=#airyopt>AIRY</a> | <a href=#switchopt>LOGD/AIRY switch</a> | <a href=#partialwave>Partial Wave Sum</a> | <a href=#channels>Number of Channels</a>    </center><hr>&#001;&#001;&#001;In order to carry out scattering calculations on a particularsystem you must first decide on the values of the parameters which control:<ol><li>The starting point of the integration of the coupled equations.  Thisis set by the parameter <a href=rendld.html>RSTART</a><p>As the total angular momentum (<i>J<sub>tot</sub></i>) increases, the classical turning pointwill also increase.  As this occurs, the program automaticallyadjusts <a href=rendld.html>RSTART</a> to remain a constant distance inside the innermost classicalturning point.<p><li> The accuracy of the numerical integration<p>In the LOGD propagation the accuracy is controlled by the parameter<a href=spac.html>SPAC</a>, which sets the step size.<p>    In the AIRY propagation the accuracy is controlled by twoparameters:<ul> <a href=tolai.html>TOLAI</a>, which determines how large can be the maximum of thediagonal and off-diagonal terms which are neglected<p><a href=tolai.html>RINCR</a>, which sets the point beyond which the step size is               allowed to increase</ul><p><li>The point at which the switch is made from the LOGD to the AIRYpropagator.  This is set by the parameter <a href=rendld.html>RENDLD</a>.<p> As <a href=rendld.html>RSTART</a> increases, at subsequent values of <i>J<sub>tot</sub></i>, the value of <a href=rendld.html>RENDLD</a>increases accordingly, so that the distance covered by the LOGD propagatorremains constant.  If, however, you are not using the AIRY propagator (<a href=flags.html>flag</a> <a href=airyfl.html>AIRYFL</a> = .false.), then the program does not change <a href=rendld.html>RENDLD</a> at higher valuesof <i>J<sub>tot</sub></i>.<p><li>The ending point of the integration. This is set by the parameter <a href=rendld.html>RENDAI</a>.<p><li>The number of partial waves needed and the required partial waveincrement.  This is set by the parameters <a href=jtot1.html>JTOT2</a> and <a href=jtot1.html>JTOTD</a>.<p><li>The number of quantum states required in the channel expansion</ol><hr><a name=logdopt></a><p>&#001;&#001;&#001;To set these parameters, use the <a href=optimize.html>OPTIMIZE</a><a href=commands.html> command</a> and procede as follows:<center><h4><font color=brown>Optimization of RSTART and LODG propagation</h4></center></font><ol><li> First, disable the AIRY propagation by setting <a href=airyfl.html>AIRYFL</a> = .false.<p>In this step you will adjust the two parameters that control the LOGDintegration.  OPTIMIZE checks for convergence of the square of <i>T</i> matrixelements.  The only levels checked are those which are explicity designatedin the level lists <a href=jout.html>JOUT</a> and <a href=indout.html>INDOUT</a>.  <img src=cautionsmall.gif> Make sure these parameters are setso that you have selected a representative set of levels for your problem.  Setthe total angular momentum <a href=jtot1.html>JTOT1</a> to be small.  Set <a href=jtot1.html>JTOT2</a> = <a href=jtot1.html>JTOT1</a>, and<a href=jtot1.html>JTOTD</a> = 1.<p><ol><li>First set <a href=rendld.html>RSTART</a> sufficiently small that the integration is starting inside the classically forbidden region.  Set <a href=rendld.html>RENDLD</a> to be roughly 2 bohroutside the innermost classical turning point, which you can estimate using the<a href=commands.html> command</a> <a href=turn.html>TURN</a>.  First optimize theparameter  <a href=spac.html>SPAC</a> asfollows:<p><center><tt>       OPT,SPAC,{valmax},{valmin},0.7</tt></center><p>where <tt>{valmax}</tt> is the initial value, typically 0.5 times the deBrogliewavelength (which can be found using the <a href=commands.html> command</a> <a href=debrogli.html>DEBROGLI</a>), and <tt>{valmin}</tt>is typically 0.05*<tt>valmax</tt>.<p><li>When you have found a reasonable value of <a href=spac.html>SPAC</a> save the parameters (usingthe <a href=commands.html> command</a> <a href=save.html>SAVE</a>) and then procede to adjust the value of <a href=rendld.html>RSTART</a> as follows:<p><center><tt>       OPT,RSTART,{valmax},{valmin},1,-0.25<p></center></tt>where now <br>&#001;&#001;&#001;<tt>{valmax}</tt> = innermost turning point - 0.2 bohr<br>&#001;&#001;&#001;<tt>{valmin}</tt> = <tt>{valmax}</tt> - 1.5 bohr<p>when this is complete, <a href=save.html>save</a> the optimized value of <a href=rendld.html>RSTART</a>.</ol></ol><a name=airyopt></a><p><p><hr>Optimization subsections:<p><center>   <a href=optimization.html>TOP</a> | <a href=#logdopt>RSTART and LOGD</a> | <a href=#switchopt>LOGD/AIRY switch</a> | <a href=#partialwave>Partial Wave Sum</a> | <a href=#channels>Number of Channels</a>    </center><hr><ol start=2><center><h4><font color=brown>Optimization of AIRY propagation</h4></center></font><li>Now, you can adjust the parameters that control the AIRY integration.<p>Set <a href=airyfl.html>AIRYFL</a> = .true., <a href=tolai.html>TOLAI</a> = 1.0, and <a href=rendld.html>RENDAI</a> equal to a value at whichyou expect the coupling potential to be asymptotically weak (for problemswith long-range potentials that vary only as <i>R</i><sup>-6</sup>, RENDAI should betypically 20 - 30 bohr; the value of the potential at any value of <i>R</i> canbe ascertained using the command <a href=testpot.html>TESTPOT</a>).<p> <ol><li>First adjust FSTFAC, which controls the relative size of the AIRY stepsto the LOGD steps, as follows:<p><center><tt>      OPT,FSTFAC,{valmax},{valmin},0.8<p></center></tt>with, typically, <tt>{valmax}</tt> = 20, <tt>{valmin}</tt> = 2<p><li>Then adjust <a href=rendld.html>RENDAI</a> as follows:<p><center><tt>      OPT,RENDAI,{valmin},{valmax},1,3<p></center></tt>where, typically, <tt>{valmin}</tt> = 15, <tt>{valmax}</tt> = 40 .  For long-range potentials(dipole-dipole, charge-quadrupole, charge-dipole coupling these values willhave to be much larger).<p><li>Then adjust <a href=tolai.html>TOLAI</a> as follows:<p><center><tt>      OPT,TOLAI,{valmax},1,1,{step}<p></center></tt>where, typically <tt>{valmax}</tt> = 1.5 - 2 and <tt>{step}</tt> = - 0.05.  <a href=tolai.html>TOLAI</a> controls therate at which step sizes increase in the AIRY propagation.  This isvery system dependent; typical values are 1 &#190; TOLAI &#190; 1.2.</ol></ol><a name=switchopt></a><p><p><hr>Optimization subsections:<p><center>   <a href=optimization.html>TOP</a> | <a href=#logdopt>RSTART and LOGD</a> | <a href=#airyopt>AIRY</a> | <a href=#partialwave>Partial Wave Sum</a> | <a href=#channels>Number of Channels</a>    </center><hr><ol start=3><center><h4><font color=brown>Location of LOGD/AIRY switch</h4></center></font><p><li>At this point, you need to set <a href=rendld.html>RENDLD</a>, the integration switching point.The goal is to minimize the cpu time spent in propagating the log-derivative matrix from RSTART to RENDAI. Since the LOGD propagator uses aconstant step size, its &#147;speed&#148; - how long it takes to propagate thelog-derivative matrix over a given distance - is constant.  For a givensector width, the AIRY propagator involves significantly more matrixoperations and is hence slower than the LOGD propagator.  In general thespeed ratio is about 6:1 in favor of the LOGD propagator on scalarmachines, but drops to less than 3:1 on vector machines with fast matrixmultiply library routines. However, in the AIRY propagation the intervalwidths increase with <i>R</i>, so that the speed becomes faster as <i>R</i> increases.Eventually, the AIRY propagator will become faster than the LOGDpropagator, which uses constant step sizes.	<p>The total time will be proportional to<p><center>			<i>N<sub>L</sub></i> + 6 <i>N<sub>A</sub> (N<sub>L</sub></i> + 3 <i>N<sub>A</sub></i>, on vector machines) ,</center><p>where <i>N<sub>L</sub></i> designates the number of steps in the LOGD propagation and <i>N<sub>A</sub></i>designates the number of intervals in the AIRY propagation.  For a given valueof the parameter spac, <i>N<sub>L</sub></i> will be directly proportional to <a href=rendld.html>RENDLD</a>. Thus tominimize the total cpu time you need to decrease <a href=rendld.html>RENDLD</a> (thereby decreasing<i>N<sub>L</sub></i>) while at the same time trying to minimize the total (<i>N<sub>L</sub></i> + f * <i>N<sub>A</sub></i>), where <i>f</i>=6 for scalar machines but 3for vector machines).  You can accomplish this as follows:<p>   The scattering program prints out (<i>N<sub>L</sub></i>) and<i>N<sub>A</sub></i>.   First decrease <a href=rendld.html>RENDLD</a>,reoptimize the AIRY parameters, as described above, and see if <i>N<sub>L</sub></i> + <i>f * N<sub>A</sub></i> (or the total cpu time) decreases.  If so, continue todecrease <a href=rendld.html>RENDLD</a>. Otherwise, increase <a href=rendld.html>RENDLD</a>.<p>In general, you don't need to search for a precise minimum in thefunction (<i>N<sub>L</sub></i> + <i>f * N<sub>A</sub></i>) since the number of intervals used inthe AIRY propagation will vary substantially at different values of <i>J<sub>tot</sub></i>.For systems with small deBroglie wavelengths (high mass, high collisionenergy) the minimal cpu time will correspond to using the LOGD propagatorover only a short range (0.5 -2 Bohr).  For systems with large deBrogliewavelengths (collisions involving H<sub>2</sub> or He, low collision energy), you willeven want to use the LOGD propagator over a longer range. In some cases youmay want to use only the LOGD integrator (set <a href=airyfl.html>AIRYFL</a> = .false.) , or only theAIRY integrator (set <a href=logdfl.html>LOGDFL</a> = .false.).</ol></center><a name=partialwave></a><hr>Optimization subsections:<p><center>   <a href=optimization.html>TOP</a> | <a href=#logdopt>RSTART and LOGD</a> | <a href=#airyopt>AIRY</a> | <a href=#switchopt>LOGD/AIRY switch</a> | <a href=#channels>Number of Channels</a>   </center><hr><ol start=4><center><h4><font color=brown>Determination of number of partial waves</h4></center></font><li>At this point, if you are treating a collision problem, you need to determine howmany partial waves are required to optain convergence in the differential or integralcross sections of interest.  This is governed by the value of the parameter<a href=jtot1.html><tt>JTOT2</a></tt><p><ol type=a><li>In the case of <i>differential cross sections</i>, use a representative channelbasis, but smaller than that necessary for convergence, and a large value of <a href=jtot1.html><tt>JTOT2</a></tt><p> Determine the differential cross sectionsfor several transitions of interest, over a coarse angular grid, using the <a href=difcrs.html>DIFCRS</a> command.Successively increase the parameter <tt>jtotend</tt> in the call list to <a href=difcrs.html>DIFCRS</a> untilconvergence is reached.<p><li>In the case of <i>integral</i> cross sections, use a representative channelbasis, but smaller than that necessary for convergence, and a large value of <a href=jtot1.html><tt>JTOT2</a></tt>, and a moderate value of <tt><a href=jtot1.html>JTOTD</a> (JTOTD = 3 - 5).</tt><p> Determine the partial inelastic (or elastic) cross sectionsfor several transitions of interest,  using the <a href=partc.html>PARTC</a> command.For the output (which will appear at the console as well as in the file <tt>{jobname}.psc</tt>, you willbe able to judge how large a value of <a href=jtot1.html><tt>JTOT2</a></tt> is necessary.<p>The, decrease <tt><a href=jtot1.html>JTOTD</a></tt> until you have reached convergencein the integral cross sections.<p></ol><img src=cautionsmall.gif> Remember, convergence of integral or differentialcross sections to within 1% is usually well within the errors bars of most(if not all) experiments.<p><img src=cautionsmall.gif> In the case of <a href=photof.html>photodissociation</a>, or collisions with <a href=flagsu.html>surfaces</a>, only one partial wave is involved.Consequently, this optimization step can be skipped.</ol><hr>Optimization subsections:<p><center>   <a href=optimization.html>TOP</a> | <a href=#logdopt>RSTART and LOGD</a> | <a href=#airyopt>AIRY</a> | <a href=#switchopt>LOGD/AIRY switch</a> | <a href=#partialwave>Partial wave sum   </center><a name=channels></a><hr><ol start=5><center><h4><font color=brown>Size of channel basis</h4></center></font><li>Once you have decided on the parameters which control the integration and the parameterswhich control the partial wave sum, you need only decide on the size of the channelbasis.  The number of channels is, of course, dependnet on    the particular <a href=systems.html>system</a> and/or <a href=basis.html>BASIS</a> subroutine selected. In many cases, this is controledby the parameter <tt>JMAX</tt>.  By following a similar procedure outlined in step#4 above (optimization of the partial wave sum), one can decide how large a channelbasis is necessary to obtain convergence.<p>Unfortunately, since the cpu requirement of any close-coupled calculation goesup as the <i>third</i>power of the number of channels, the choice of the maximumsize of the channel basis may involve significant computational effort.<p> <img src=cautionsmall.gif> Remember, convergence of integral or differentialcross sections to within 1% is usually well within the errors bars of most(if not all) experiments.</ol><hr>Go to:<p><center>   <a href=optimization.html>TOP</a> | <a href=#logdopt>RSTART and LOGD</a> | <a href=#airyopt>AIRY</a> | <a href=#switchopt>LOGD/AIRY switch</a> | <a href=#partialwave>Partial wave sum    </center>