!************************************************************************
!                          routines included:                           *
!                                                                       *
!   scairy     scaled airy functions and derivatives                 *
!   airymp        returns the moduli and phases of the airy          *
!                    functions and their derivatives                    *
module mod_hiamp

contains

! -------------------------------------------------------------------------
subroutine scairy (z, scai, scbi, scaip, scbip, zeta)
!     scaled airy functions and derivatives
!     this program written by d.e. manolopoulos (sept. 1986)
!     current revision date: sept-1986
!  ----------------------------------------------------------------
!     for  z .lt. (-5.0d0)
!     ai(z) = scai*cos(zeta) + scbi*sin(zeta)
!     bi(z) = scbi*cos(zeta) - scai*sin(zeta)
!     ai'(z) = scaip*cos(zeta) + scbip*sin(zeta)
!     bi'(z) = scbip*cos(zeta) - scaip*sin(zeta)
!     where zeta = (2/3)*(-z)**(3/2) + pi/4
!     for  (-5.0d0) .le. z .le. (+0.0d0)
!     ai(z) = scai
!     bi(z) = scbi
!     ai'(z) = scaip
!     bi'(z) = scbip
!     and zeta = 0
!     for  z > 0.d0
!     ai(z) = scai*exp(-zeta)
!     bi(z) = scbi*exp(+zeta)
!     ai'(z) = scaip*exp(-zeta)
!     bi'(z) = scbip*exp(+zeta)
!     where zeta = (2/3)*(+z)**(3/2)
!  ----------------------------------------------------------------
!     evaluation of the functions is based on a number of
!     chebyshev expansions
!
!     this version is suitable for machines with full word precision
!  ----------------------------------------------------------------
implicit double precision (a-h,o-z)
double precision a, b, c, c1, c2, df, dg, ex, exp1z, exp2z, f, &
                 g, pib4, root4z, rootz, rt3, scai, scaip, scbi, &
                 scbip, t, t2, xeps, y, z, zcube, zeta, zsq
data c1   / 3.55028053887817239d-01 /
data c2   / 2.58819403792806798d-01 /
data rt3  / 1.73205080756887729d+00 /
data pib4 / 7.85398163397448310d-01 /
zeta = 0.0d0
xeps = 0.0d0
! ----------------------------------------------------------------------------
!  here if near enough origin to use 3 term power series
if ( dabs(z) .le. 0.025d0) then
  zsq = z * z
  zcube = zsq * z
!  evaluate power series ( three terms is sufficient for abs(x) < 0.025)
  df = 1.d0 + zcube / 6.d0 + zcube * zcube / 180.d0
  dg = z * (1.d0 + zcube / 12.d0 + zcube * zcube / 504.d0)
  scai = c1 * df - c2 * dg
  scbi = rt3 * (c1 * df + c2 * dg)
!  now for derivatives
  df = zsq / 2.d0 + zsq * zcube / 30.d0
  dg = 1.d0 + zcube / 3.d0 + zcube * zcube / 72.d0
  scaip = c1 * df - c2 * dg
  scbip = rt3 * (c1 * df + c2 * dg)
!  scale the functions by exp(zeta) if z .gt. 0
  if (z .gt. 0.d0) then
    rootz = dsqrt(z)
    zeta = 2.0d0 * z * rootz / 3.0d0
    ex = exp(zeta)
    scai = scai * ex
    scaip = scaip * ex
    scbi = scbi / ex
    scbip = scbip / ex
  end if
  return
end if
if (z.lt.(+9.0d0)) go to 10
rootz = dsqrt(z)
root4z = dsqrt(rootz)
zeta = 2.0d0*z*rootz/3.0d0
t = 36.0d0/zeta - 1.0d0
y = ((((((((( +1.16537795324979200d-15*t &
  -1.16414171455572480d-14)*t +1.25420655508401920d-13)*t &
  -1.55860414100340659d-12)*t +2.21045776110011276d-11)*t &
  -3.67472827517194031d-10)*t +7.44830865396606612d-09)*t &
  -1.95743559326380581d-07)*t +7.44672431969805149d-06)*t &
  -5.28651881409929932d-04)*t +2.81558489585006298d-01
scai = y/root4z
y = ((((((((((( +4.50165999254528000d-15*t &
  +1.56232018374502400d-14)*t +5.26240712559918080d-14)*t &
  +2.97814898856618752d-13)*t +1.97577620975625677d-12)*t &
  +1.53678944110742706d-11)*t +1.45409933537455235d-10)*t &
  +1.71547326972380087d-09)*t +2.61898617129147064d-08)*t &
  +5.49497993491833009d-07)*t +1.76719804365109334d-05)*t &
  +1.12212109935874117d-03)*t +5.65294557558522063d-01
scbi = y/root4z
y = ((((((((( +1.20954638924697600d-15*t &
  -1.21281218539020800d-14)*t +1.31303723724964224d-13)*t &
  -1.64152781754533677d-12)*t +2.34672185025709461d-11)*t &
  -3.94507329122119338d-10)*t +8.13125005420910243d-09)*t &
  -2.19736365932356533d-07)*t +8.83993515227257822d-06)*t &
  -7.43456339972080231d-04)*t -2.82847316336379200d-01
scaip = y*root4z
y = ((((((((((( -4.59170437029478400d-15*t &
  -1.59840960512122880d-14)*t -5.41258863340784640d-14)*t &
  -3.07414589507261184d-13)*t -2.04866616770522650d-12)*t &
  -1.60321415915690897d-11)*t -1.52922073861488292d-10)*t &
  -1.82445639488695332d-09)*t -2.83250890588806503d-08)*t &
  -6.11130377639012647d-07)*t -2.07842147963678572d-05)*t &
  -1.56350017663858255d-03)*t +5.62646283094843014d-01
scbip = y*root4z
return
10 if (z.lt.(+4.5d0)) go to 20
rootz = dsqrt(z)
zeta = 2.0d0*z*rootz/3.0d0
exp1z = dexp(zeta-2.5d0*z)
exp2z = dexp(zeta-2.625d0*z)
t = 4.0d0*z/9.0d0 - 3.0d0
y = ((((((((((((((((((((( +9.69081960415394529d-11*t &
  +3.24436136050920784d-10)*t -3.57419513430644674d-09)*t &
  -3.84461320827974687d-09)*t +8.88116699085949212d-08)*t &
  -6.26105174374717557d-08)*t -1.69051051004298110d-06)*t &
  +3.80731416363041759d-06)*t +2.43840529113057777d-05)*t &
  -9.74379632673654766d-05)*t -2.45324254437931970d-04)*t &
  +1.69517926953312785d-03)*t +1.19638433540225211d-03)*t &
  -2.15255594590357451d-02)*t +9.33777073522844198d-03)*t &
  +1.98716159257796883d-01)*t -2.54001858882057718d-01)*t &
  -1.27148775197878180d+00)*t +2.52046376168394778d+00)*t &
  +5.04987271423387057d+00)*t -1.33120978544419281d+01)*t &
  -9.34903846550381088d+00)*t +3.10330812950257837d+01
scai = y*exp1z
y = (((((((((((((((((((((((( +3.79210935744593920d-14*t &
  -4.16346635040194560d-14)*t -3.63110681886588928d-13)*t &
  +1.38932592029414195d-12)*t -4.00489068810888806d-12)*t &
  +1.39019501834951721d-11)*t -4.50877182237241508d-11)*t &
  +1.38942309844733264d-10)*t -3.92503498108710093d-10)*t &
  +1.20125005161756928d-09)*t -3.14234550677825531d-09)*t &
  +1.03100587323694771d-08)*t -2.35240060783126760d-08)*t &
  +8.98525670958611253d-08)*t -1.57273011181242048d-07)*t &
  +7.77696763289738864d-07)*t -8.40211181188135235d-07)*t &
  +6.34887361301864569d-06)*t -2.73464023289055762d-06)*t &
  +4.54606729925166230d-05)*t +2.20459155042947089d-06)*t &
  +2.58823388957588056d-04)*t +7.31023768389466446d-05)*t &
  +1.01013806904596356d-03)*t +2.64794416332118755d-04)*t &
  +1.97499785553709145d-03
scbi = y/exp1z
y = ((((((((((((((((((((( -4.40679918437492851d-10*t &
  +1.30954945449348301d-10)*t +1.30052079376596751d-08)*t &
  -2.21315827945437064d-08)*t -2.56850909380644963d-07)*t &
  +8.66960855365698346d-07)*t +3.75622307499741911d-06)*t &
  -2.15396233361107222d-05)*t -3.55804094667597110d-05)*t &
  +3.95317852914037711d-04)*t +5.03369361986934094d-05)*t &
  -5.54634417403436820d-03)*t +5.29658186908372832d-03)*t &
  +5.91311623537658225d-02)*t -1.09446664596286554d-01)*t &
  -4.63589435529194219d-01)*t +1.25323269822030972d+00)*t &
  +2.50138108959469254d+00)*t -9.12668774193995449d+00)*t &
  -8.14385732036876466d+00)*t +4.00134082550833019d+01)*t &
  +1.15396202931444799d+01)*t -8.17378314444550419d+01
scaip = y*exp1z
y = (((((((((((((((((((((((( -1.12976379481423872d-13*t &
  +2.84163275199873024d-13)*t +9.21367859618119680d-14)*t &
  -6.47465116933029888d-13)*t +5.66210442158931968d-13)*t &
  -3.03158042458901709d-12)*t +1.32640217809876419d-11)*t &
  -3.03558223041639219d-11)*t +5.32290407073565901d-11)*t &
  +1.67561690905544950d-11)*t -3.35234276365918044d-10)*t &
  +2.92807773020050397d-09)*t -8.76900994127464369d-09)*t &
  +4.69138029321003869d-08)*t -1.00929917942876779d-07)*t &
  +5.40401934648687824d-07)*t -8.19977129258456927d-07)*t &
  +5.13367651438974580d-06)*t -4.77800617725922708d-06)*t &
  +4.02415391117897098d-05)*t -1.74571192912274417d-05)*t &
  +2.45332091645215217d-04)*t -2.22916383050374016d-05)*t &
  +1.02535993549737948d-03)*t +5.94033287658300975d-05)*t &
  +2.17420627539345627d-03
scbip = y/exp2z
return
20 if (z.le.(+0.0d0)) go to 40
rootz = dsqrt(z)
zeta = 2.0d0*z*rootz/3.0d0
exp1z = dexp(zeta-1.5d0*z)
exp2z = dexp(zeta-1.375d0*z)
t = 4.0d0*z/9.0d0 - 1.0d0
if (z.lt.(+xeps)) go to 30
y = ((((((((((((((((((((((( +4.97635854909020570d-12*t &
  -3.25024150273916928d-11)*t -5.15773946723072737d-11)*t &
  +8.66802872160017711d-10)*t -9.51292671519803048d-10)*t &
  -1.33268133924677102d-08)*t +4.37061406144179625d-08)*t &
  +1.18943714086308365d-07)*t -8.66980482244589319d-07)*t &
  -2.46768077494905499d-08)*t +1.10610939830483627d-05)*t &
  -1.80475663535516462d-05)*t -9.22213518989192294d-05)*t &
  +3.15767712665407001d-04)*t +4.08626419412850994d-04)*t &
  -3.12704269924340764d-03)*t +6.27899244118607949d-04)*t &
  +1.99062142478229001d-02)*t -2.27427058211322122d-02)*t &
  -7.94869698136278246d-02)*t +1.54261999158247445d-01)*t &
  +1.75618463128730757d-01)*t -5.05223670654169859d-01)*t &
  -1.49695902416050331d-01)*t +6.91290454439828966d-01
scai = y*exp1z
y = (((((((((((((((((((((((((((-8.01144609907912212d-11*t &
  +2.67566208080291037d-10)*t +1.74416971406971503d-10)*t &
  -3.12642164666800066d-09)*t +1.22114569059570056d-08)*t &
  -2.93647730218878800d-08)*t +1.76951994785830839d-08)*t &
  +2.13143266932123830d-07)*t -1.15569603602267288d-06)*t &
  +3.34394065752949896d-06)*t -5.20143492253259528d-06)*t &
  -3.21937890029830155d-06)*t +5.00360593064643409d-05)*t &
  -1.77449408434194908d-04)*t +3.86357389967150628d-04)*t &
  -4.53337922165622921d-04)*t -2.60866378774883161d-04)*t &
  +3.01355585350049504d-03)*t -8.39047077309199055d-03)*t &
  +1.63240267627966090d-02)*t -1.90830727084112485d-02)*t &
  +1.65592661387959142d-02)*t +1.76101803014184860d-02)*t &
  -3.36652019472526494d-02)*t +1.23831258886916327d-01)*t &
  -6.48342330363017516d-02)*t +2.20310550882807725d-01)*t &
  -1.03883014957365224d-02)*t +2.06857611342460346d-01
scbi = y/exp2z
30 y = ((((((((((((((((((((((( -2.31635825886515692d-11*t &
  +8.43840142802870600d-11)*t +3.68028065271203758d-10)*t &
  -2.61043232825754937d-09)*t -4.65110871930215858d-10)*t &
  +4.46164842334855713d-08)*t -9.24599436690579710d-08)*t &
  -4.55809882095931368d-07)*t +2.21024501804834447d-06)*t &
  +1.50251398952558802d-06)*t -2.91830008657289876d-05)*t &
  +3.51391100964982453d-05)*t +2.37966767002002741d-04)*t &
  -7.00969870295148024d-04)*t -9.84923358717942729d-04)*t &
  +6.68935321740601810d-03)*t -1.66398286740112083d-03)*t &
  -3.83618654865390504d-02)*t +4.80463615092658847d-02)*t &
  +1.28359791076466449d-01)*t -2.80267155846714091d-01)*t &
  -2.06049815358004057d-01)*t +7.63522843530878467d-01)*t &
  +6.47699892977822355d-02)*t -8.32940737409625965d-01
scaip = y*exp2z
y = (((((((((((((((((((((((((((+2.69330665471830131d-10*t &
  -1.25313111217921013d-09)*t +1.45057587508619405d-09)*t &
  +5.82827351134571594d-09)*t -3.96093412314305685d-08)*t &
  +1.37346521367521144d-07)*t -2.78927594518121271d-07)*t &
  +2.96531845420687661d-08)*t +2.27734981888044076d-06)*t &
  -1.02295902888535994d-05)*t +2.65515218319523965d-05)*t &
  -3.86457370206378782d-05)*t -1.52212232476268640d-05)*t &
  +2.84765225803690646d-04)*t -9.65798046252914453d-04)*t &
  +2.04618065580453522d-03)*t -2.68702422147972510d-03)*t &
  +8.36839039610090712d-04)*t +6.87131161447866570d-03)*t &
  -2.10563741100004648d-02)*t +4.13290131622517073d-02)*t &
  -5.03310394511775398d-02)*t +5.95467795825179773d-02)*t &
  -1.64213101223235839d-02)*t +5.02536006477020710d-02)*t &
  +5.75601787687195966d-02)*t +1.33220031651076020d-01)*t &
  +7.76356357899154668d-02)*t +2.11213324176049168d-01
scbip = y/exp1z
return
40 if (z.lt.(-5.0d0)) go to 60
t = z/5.0d0
t = -t*t*t
t = 2.0d0*t - 1.0d0
t2 = 2.0d0*t
if (z.gt.(-xeps)) go to 50
a = +1.63586492025000000d-18
b = t2*a -1.14937368283025000d-16
c = t2*b-a +7.06090635856696000d-15
a = t2*c-b -3.75504581033290114d-13
b = t2*a-c +1.70874975807662448d-11
c = t2*b-a -6.56273599013291800d-10
a = t2*c-b +2.09250023300659871d-08
b = t2*a-c -5.42780372893997236d-07
c = t2*b-a +1.11655763472468469d-05
a = t2*c-b -1.76193215080912647d-04
b = t2*a-c +2.03792657403144947d-03
c = t2*b-a -1.61616260941907957d-02
a = t2*c-b +7.87369695059018748d-02
b = t2*a-c -1.88090320218915726d-01
c = t2*b-a +8.83593328666433903d-02
a = t2*c-b +9.46330439565858235d-02
f = t*a-c +7.60869994141726643d-02
a = +1.23340698467000000d-19
b = t2*a -9.05440546731800000d-18
c = t2*b-a +5.83052348377146000d-16
a = t2*c-b -3.26253073273305810d-14
b = t2*a-c +1.56911825099665634d-12
c = t2*b-a -6.40386375393414830d-11
a = t2*c-b +2.18414557202733054d-09
b = t2*a-c -6.11127835033401880d-08
c = t2*b-a +1.37095478225289560d-06
a = t2*c-b -2.39464595313812449d-05
b = t2*a-c +3.13306256975299299d-04
c = t2*b-a -2.90953380590207648d-03
a = t2*c-b +1.76972907074092250d-02
b = t2*a-c -6.17055677164122241d-02
c = t2*b-a +9.52472833367213949d-02
a = t2*c-b -4.32381694223484894d-02
g = t*a-c +3.76828717701544063d-02
scai = f - g*z
scbi = rt3*(f + g*z)
50 a = -2.51308436743000000d-18
b = t2*a +1.65543326242034000d-16
c = t2*b-a -9.49237123028142500d-15
a = t2*c-b +4.68795260455788096d-13
b = t2*a-c -1.96942895842729954d-11
c = t2*b-a +6.93493715818491929d-10
a = t2*c-b -2.01076965264476206d-08
b = t2*a-c +4.69655735896232104d-07
c = t2*b-a -8.59527033121202608d-06
a = t2*c-b +1.18871496270269531d-04
b = t2*a-c -1.18244097697332692d-03
c = t2*b-a +7.87645202148185146d-03
a = t2*c-b -3.14174372672396468d-02
b = t2*a-c +6.20464642445295805d-02
c = t2*b-a -4.83824291776351778d-02
f = t*c-b +2.64808460123486707d-02
a = +5.89382778069400000d-18
b = t2*a -4.04811810887971000d-16
c = t2*b-a +2.42680453287673090d-14
a = t2*c-b -1.25683910148099294d-12
b = t2*a-c +5.55607745069567295d-11
c = t2*b-a -2.06683376304577072d-09
a = t2*c-b +6.35924425685425485d-08
b = t2*a-c -1.58422527393619013d-06
c = t2*b-a +3.11007119112993551d-05
a = t2*c-b -4.64189437787271433d-04
b = t2*a-c +5.00970025411579034d-03
c = t2*b-a -3.62166342717373453d-02
a = t2*c-b +1.53114671641953510d-01
b = t2*a-c -2.69270807740667256d-01
c = t2*b-a -9.61843661149152853d-02
a = t2*c-b +2.07099372879297732d-01
g = t*a-c +9.79943887874547828d-02
scaip = z*z*f - g
scbip = rt3*(z*z*f + g)
return
60 rootz = dsqrt(-z)
root4z = -dsqrt(rootz)
zeta = 2.0d0*(-z)*rootz/3.0d0
t = -250.0d0/(z*z*z) - 1.0d0
a = ((((((((((((( -4.50071772808806400d-15*t &
  +1.11777933477806080d-14)*t -1.39959545848483840d-14)*t &
  +4.93110187870320640d-14)*t -2.02193307034590720d-13)*t &
  +7.53585452663569920d-13)*t -3.14632365928501299d-12)*t &
  +1.52351450024952975d-11)*t -8.75801572233507014d-11)*t &
  +6.27349413509555121d-10)*t -6.02183526555303242d-09)*t &
  +8.70043536788235270d-08)*t -2.32935044050984079d-06)*t &
  +1.83605337367638430d-04)*t -5.64003555099413391d-01
scbi = a/root4z
b = (((((((((((((((( -4.12972759036723200d-15*t &
  +8.36512465551360000d-15)*t -2.05945081774080000d-16)*t &
  +6.23733840790323200d-15)*t -5.81333983959859200d-14)*t &
  +1.52893566095288320d-13)*t -4.11064788026333184d-13)*t &
  +1.33820884559538637d-12)*t -4.74293914921785574d-12)*t &
  +1.84868021228605050d-11)*t -8.15686769476673166d-11)*t &
  +4.19373390376196942d-10)*t -2.61584084406303574d-09)*t &
  +2.10021454539364698d-08)*t -2.37847770210509358d-07)*t &
  +4.43114636962516363d-06)*t -1.83241371436579068d-04)*t &
  +3.89918976811026487d-02
scai = (b/zeta)/root4z
a = ((((((((((((( -4.58484390222233600d-15*t &
  +1.13969221615738880d-14)*t -1.43160328250060800d-14)*t &
  +5.04734978526300160d-14)*t -2.07055957015081472d-13)*t &
  +7.73043520694004480d-13)*t -3.23454581960357018d-12)*t &
  +1.57043540332660220d-11)*t -9.06023827679991573d-11)*t &
  +6.52303613917050367d-10)*t -6.30993998756281944d-09)*t &
  +9.23711460831703303d-08)*t -2.54030284953639173d-06)*t &
  +2.17448385781448409d-04)*t +5.64409671680379110d-01
scaip = a*root4z
b = (((((((((((((((( +4.19612197958451200d-15*t &
  -8.50454708509081600d-15)*t +2.31421341122560000d-16)*t &
  -6.39683104557465600d-15)*t +5.92509321833062400d-14)*t &
  -1.56008660983891968d-13)*t +4.20106807813331968d-13)*t &
  -1.36926896339755520d-12)*t +4.86000800286762854d-12)*t &
  -1.89780061819570625d-11)*t +8.39314701970122041d-11)*t &
  -4.32843814802265754d-10)*t +2.71124934991469715d-09)*t &
  -2.19026888712002973d-08)*t +2.50504395196083566d-07)*t &
  -4.75245434337472120d-06)*t +2.05252791097940732d-04)*t &
  -5.46414841607309762d-02
scbip = (b/zeta)*root4z
zeta = zeta + pib4
return
end

subroutine airymp (x, ftheta, fphi, xmmod, xnmod, scai, scbi, &
                    zeta)
!  subroutine to return the moduli and phases of the airy functions and their
!  derivatives
!  author:  millard alexander
!  current revision date: 4-nov-1991
! ---------------------------------------------------------------------------
!  variables in call list:
!    x     argument of airy functions
!    ftheta, xmmod         on return: contain the (double precision)
!                                 phase and modulus of ai(x) and bi(x) (see
!                                 below).
!    fphi, xnmod           on return: contain the (double precision)
!                                 phase and modulus of ai'(x) and Bi'(x) (see
!                                 below).
!    scai, scbi, zeta      on return:  for x .le. 0, returns constants such th
!     ai(x) = scai * cos(zeta) + scbi * sin(zeta)
!     bi(x) = scbi * cos(zeta) - scai * sin(zeta)
!     where zeta = (2/3) * (-x) ** (3/2) + pi/4
!                          and, for x .gt. 0
!     ai(x) = scai * exp(-zeta)
!     bi(x) = scbi * exp(+zeta)
!     where zeta = (2/3) * x ** (3/2)
!    N.B. on entry scai, scbi are identical to above values, except for
!    -5 .le. x .le. 0, where on entry scai = ai(x) and scbi = bi(x)

! ----------------------------------------------------------------------------
!  for negative x
! ----------------------------------------------------------------------------
!  the moduli and phases are defined by
!      ai(-x) = m(x) cos[theta(x)]
!      bi(-x) = m(x) sin[theta(x)]
!      ai'(-x) = n(x) cos[phi(x)]
!      bi'(-x) = n(x) sin[phi(x)]
!  in other words
!          2              2        2
!      m(x)  = sqrt[ ai(x)  + bi(x)  ]
!          2               2         2
!      n(x)  = sqrt[ ai'(x)  + Bi'(x)  ]
!      theta(x) = atan [ bi(x) / ai(x) ]
!      phi(x)   = atan [ bi'(x) / Ai'(x) ]
!  to determine these moduli and phases we use the subroutine
!  scairy, written by d. manolopoulos (sept. 1986)
!  this subroutine returns the following quantities:
!     scai, scbi, scaip, scpib, and zeta, where
!     for  x .lt. -5.0
!     ai(x) = scai * cos(zeta) + scbi * sin(zeta)
!     bi(x) = scbi * cos(zeta) - scai * sin(zeta)
!     ai'(x) = scaip * cos(zeta) + scbip * sin(zeta)
!     bi'(x) = scbip * cos(zeta) - scaip * sin(zeta)
!     where zeta = (2/3) * (-x) ** (3/2) + pi/4
!
!     for  -5.0 .le. x .le. 0.0
!
!     ai(x) = scai
!     bi(x) = scbi
!     ai'(x) = scaip
!     bi'(x) = scbip
!     and zeta = 0
! ----------------------------------------------------------------------------
!  for positive x ( x > 0)
! ----------------------------------------------------------------------------
!  the moduli and phases are defined by
!      ai(x) = m(x) sinh[theta(x)]
!      bi(x) = m(x) cosh[theta(x)]
!      ai'(x) = n(x) sinh[phi(x)]
!      bi'(x) = n(x) cosh[phi(x)]
!  in other words
!          2              2        2
!      m(x)  = sqrt[ bi(x)  - ai(x)  ]
!          2               2         2
!      n(x)  = sqrt[ bi'(x)  - ai'(x)  ]
!      theta(x) = atanh [ ai(x) / bi(x) ]
!      phi(x)   = atanh [ ai'(x) / bi'(x) ]
!  here the the exponentially scaled airy functions
!  ai(x), ai'(x), bi(x), bi'(x) are:
!      ai(x)  = ai(x)  * exp[zeta]
!      ai'(x) = ai'(x) * exp[zeta]
!      bi(x)  = bi(x)  * exp[-zeta]
!      bi'(x) = bi'(x) * exp[-zeta]
!  to determine these moduli and phases we use the subroutine
!  scairy, written by d. manolopoulos (sept. 1986)
!  this subroutine returns the following quantities:
!     scai, scbi, scaip, scpib, and zeta
!  in terms of which the exponentially scaled airy functions are defined by
!   ai(x) = scai * exp(-zeta)
!   bi(x) = scbi * exp(+zeta)
!   ai'(x) = scaip * exp(-zeta)
!   bi'(x) = scbip * exp(+zeta)
!   where zeta = (2/3) * x ** (3/2)
!
! ----------------------------------------------------------------------------
implicit double precision (a-h,o-z)
data twoth/0.666666666666666667d0/
data pib4 / 7.85398163397448310d-01 /
call scairy (x, scai, scbi, scaip, scbip, zeta)
if ( x .le. 0.d0) then
  xmmod = sqrt( scai ** 2 + scbi ** 2)
  xnmod = sqrt( scaip ** 2 + scbip ** 2)
  ftheta = atan2 (scbi, scai)
  fphi = atan2 (scbip, scaip)
  if (x .lt. (-5.0d0) ) then
    ftheta = ftheta - zeta
    fphi = fphi - zeta
  else
    zeta=twoth*(-x)*sqrt(-x)+pib4
    sn=sin(zeta)
    cs=cos(zeta)
    ai=scai*cs-scbi*sn
    bi=scbi*cs+scai*sn
    scai=ai
    scbi=bi
  end if
else
  xmmod = sqrt( - scai ** 2 + scbi ** 2)
  xnmod = sqrt( - scaip ** 2 + scbip ** 2)
  ratio = scai / scbi
  ftheta = 0.5 * log ( (1.d0 + ratio) / (1.d0 - ratio) )
  ratio = scaip / scbip
  fphi = 0.5 * log ( (1.d0 + ratio) / (1.d0 - ratio) )
end if
return
end
end module mod_hiamp
