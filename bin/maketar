#!/bin/csh -f
# HIBRIDON bin/maketar $Revision: 2004.3 $ --- make hibridon tar file
# maketar [c]: make exportable (public) tar of hibridon code
#   if option h is included, html files will be included from "mha's folder"
#   if option c is included, copy will be exported to /scratch/mha on
#   mha-ibm1.umd.edu
# the PATH variable should be set to include the hibridon bin directory
 
set basedir=`hibriddir`
alias rm 'rm -f'
@ items = $#argv
if ($items > 2) then
  echo "usage: maketar [h] [c]"
  goto end
endif
set htmloption = false
set copoption = false
if ($items == 0) then
  echo "no html help files will be included"
  echo "tar files will NOT be exported to mha-ibm1"
  set copoption = false
  set htmloption = false
endif
if ($items == 1) then
  echo "html help files will be included"
  echo "tar files will NOT be exported to mha-ibm1"
  set copoption = false
  set htmloption = true
endif
if ($items == 2) then
  echo "html help files will be included"
  echo "tar files will be exported to mha-ibm1"
  set copoption = true
  set htmloption = true
endif
set htar=/Users/mha/scratch/htar
cd $basedir
if (-e $basedir/tar.log) then
  rm $basedir/tar.log
endif
cd ..
if (-e $htar) then
 cd $htar
 echo "erasing /Users/mha/scratch/htar"
 rm -r ./*
else
  echo "creating /Users/mha/scratch/htar"
  mkdir $htar
  cd $htar
endif
echo ""
echo "copying all files to $htar ..."
echo "copying all files to $htar ..." >>& $basedir/tar.log
cp -pr $basedir/* . >>& $basedir/tar.log

echo ""
echo "removing executables ..."
echo "removing executables ..." >>& $basedir/tar.log
rm -r $htar/nohe  >>& $basedir/tar.log
rm -r $htar/phhe  >>& $basedir/tar.log
rm -r $htar/bin/progs/* >>& $basedir/tar.log
rm  $htar/bin/hib_help* >>& $basedir/tar.log
rm  $htar/src/*.*inp >>& $basedir/tar.log
rm  $htar/src/*.sav >>& $basedir/tar.log
rm  $htar/src/hib_* >>& $basedir/tar.log
rm  $htar/src/hi*.new >>& $basedir/tar.log
rm  $htar/src/hi*.ibm* >>& $basedir/tar.log
rm  $htar/src/hi*new.* >>& $basedir/tar.log
rm  $htar/src/*temp.* >>& $basedir/tar.log
rm  $htar/src/*.hold >>& $basedir/tar.log
rm  $htar/src/Outpt >>& $basedir/tar.log
rm  -r $htar/src/ibm1 >>& $basedir/tar.log
rm  -r $htar/src/hp2  >>& $basedir/tar.log
rm  $htar/bin/*.hold >>& $basedir/tar.log
rm  -r $htar/bin/conf >>& $basedir/tar.log
rm  $htar/bin/*.exe >>& $basedir/tar.log
rm  $htar/bin/*.log >>& $basedir/tar.log
rm  $htar/*.log >>& $basedir/tar.log
rm  $htar/README >>& $basedir/tar.log
rm  $htar/README_4.1* >>& $basedir/tar.log
rm -r $htar/bin/comsplit.exe  >>& $basedir/tar.log

if $htmloption == 'false' then
  echo ""
  echo "removing html help files ..."
  rm -r $htar/doc/hib_html
endif
echo ""
echo "removing previous version files ..."
echo "removing previous version files ..." >>& $basedir/tar.log
rm -r  $htar/*.~* >>& $basedir/tar.log
rm  $htar/*.~* >>& $basedir/tar.log
rm  $htar/README_4.0* >>& $basedir/tar.log
rm  $htar/bin/*.~* >>& $basedir/tar.log
rm  $htar/src/*.~* >>& $basedir/tar.log
rm  $htar/src/pot/*.~* >>& $basedir/tar.log
rm  $htar/doc/*.~* >>& $basedir/tar.log
rm  $htar/utilities/*.~* >>& $basedir/tar.log
echo ""
echo "removing compiled object files ..."
echo "removing compiled object files ..." >>& $basedir/tar.log
rm $htar/src/*.o
rm $htar/src/pot/*.o
rm $htar/utilities/*.o
echo ""
echo "removing makehibkey and hkey.f ..."
echo "removing makehibkey and hkey.f ..." >>& $basedir/tar.log
rm -r $htar/bin/makehibkey.* >>& $basedir/tar.log
rm -r $htar/src/hkey.* >>& $basedir/tar.log
echo ""
echo "removing common files ..."
echo "removing common files ..." >>& $basedir/tar.log
rm -r $htar/src/common >>& $basedir/tar.log
echo ""
echo "removing unneeded test directories"
rm -r $htar/testautodbl >>& $basedir/tar.log
rm -r $htar/testhold >>& $basedir/tar.log
echo ""
echo "removing pot.f files ..."
echo "removing pot.f files ..." >>& $basedir/tar.log
rm -r $htar/src/pot/common
if (-e $htar/src/pot/pot_yang) then
  rm -r $htar/src/pot/pot_yang
endif
rm  $htar/src/pot/*.f >>& $basedir/tar.log
echo ""
echo "copying pot.f files from include.list ..."
echo "copying pot.f files from include.list ..." >>& $basedir/tar.log
$basedir/bin/potcopy >>& $basedir/tar.log
echo ""
echo "removing other local files ..."
echo "removing other local files ..." >>& $basedir/tar.log
cd $htar
rm buglist >>& $basedir/tar.log
rm -r hold >>& $basedir/tar.log
rm -r $htar/users >>& $basedir/tar.log
rm -r smm >>& $basedir/tar.log
rm libmass.a >>& $basedir/tar.log
rm -r testmass >>& $basedir/tar.log
rm invtime.m >>& $basedir/tar.log
rm Info.workstations >>& $basedir/tar.log
rm CONFIG* >>& $basedir/tar.log
rm *.log.* >>& $basedir/tar.log
rm $htar/bin/*.log.* >>& $basedir/tar.log
rm $htar/bin/test* >>& $basedir/tar.log
rm $htar/bin/runtest.~* >>& $basedir/tar.log
rm $htar/bin/*.BAK >>& $basedir/tar.log
rm $htar/tests/*.out >>& $basedir/tar.log
rm $htar/tests/*.sav >>& $basedir/tar.log
rm $htar/tests/Outpt* >>& $basedir/tar.log
rm $htar/tests/J* >>& $basedir/tar.log
rm $htar/tests/*.smt >>& $basedir/tar.log
rm $htar/src/A* >>& $basedir/tar.log
rm $htar/src/J* >>& $basedir/tar.log
rm $htar/src/O* >>& $basedir/tar.log
rm $htar/doc/hibrid.hlp.old >>& $basedir/tar.log
rm -r $htar/testnew >>& $basedir/tar.log
rm  $htar/hibrid*.Z >>& $basedir/tar.log
rm  $htar/hibrid*.uu >>& $basedir/tar.log
rm $htar/patch*.tar.Z.uu >>& $basedir/tar.log
rm -r $htar/patch* >>& $basedir/tar.log

echo ""
echo "creating tar file ..."
echo "creating tar file ..." >>& $basedir/tar.log
if (-e hibrid4.2.tar.gz) then
  rm hibrid4.2.tar.gz
endif
tar -cvf hibrid4.2.tar * >>& $basedir/tar.log

#$exit

echo ""
echo "gzip'ing tar file ..."
echo "gzip'ing tar file ..." >>& $basedir/tar.log
gzip hibrid4.2.tar >>& $basedir/tar.log



echo ""
echo "$htar/hibrid.tar.gz created, see $basedir/tar.log for diagnostics"
echo ""

if $copoption == 'true' then
  echo ""
  echo "putting hibrid.tar.gz files on mha-ibm1 ..."
  echo "putting hibrid.tar.gz files on mha-ibm1 ..." >>& $basedir/tar.log
  rcp -p hibrid.tar.gz mha-ibm1.umd.edu:/scratch/mha/htar
endif

#rm hibrid.tar.Z
#cd 
#rm -r $htar
echo ""
exit
