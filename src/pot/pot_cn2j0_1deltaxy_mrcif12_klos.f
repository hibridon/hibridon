*  System:  C(1D,3P) + N2(j=0) - spherically averaged MRCISD-F12+Q PES
*
*   calculation of potential energy curves and spin-orbit matrix
*   elements by j.klos 
*
*   3P and 1D-3P spin-orbit matrix elements extend to large R.
*   compute 3P spin-orbit splitting using large R values
*  
*   adapted to C-N2 by j. klos from the Xe-O basis 
*   written by p. dagdigian
*   revision date:  22-oct-2014
*   current revision date: 21-jun-2015
*
      include "common/syusr"
      include "common/bausr"
      include "common/ground"
* --------------------------------------------------------------------------
      subroutine loapot(iunit,filnam)
* --------------------------------------------------------------------------
      character*(*) filnam
      common /coselb/ ibasty
      include "common/parbas"
      include "common/parpot"
      potnam='C(1D,3P)-N2(j=0)'
      npot=1
      ibasty=22
      lammin(1)=1
      lammax(1)=19
      mproj(1)=0
      ntv(1)=1
      ivcol(1,1)=0
      ivrow(1,1)=0
      return
      end
* --------------------------------------------------------------------------
      subroutine driver
      implicit double precision (a-h,o-z)
      common /cosysi/ junk(5), npot
      common /cosysr/ isrcod, junkr, en(4)
      common /covvl/ vvl(19)
      include "common/parpot"
      potnam='C(1D,3P)-N2(j=0)'
      econv=219474.6d0
      print *, potnam
1     print *, 'R (bohr):'
      read (5, *, end=99) r
      if (r.le.0.d0) goto 99
      call pot(vv0,r)
      write (6, 100) (econv*vvl(i), i=1,19)
100   format('  ',6(1pe16.8)/'  ',6(1pe16.8)
     +  '  ',7(1pe16.8))
      goto 1
99    rr=2.6d0
      dr=0.25d0
      open (unit=12,file='cn2j0_mrcisdf12_vlms.txt')
      write(12,109)
109   format(' R/bohr 1Sig  1Pi  1Del  3Sig  3Pi  Axy   Azy',
     :  '  Bss  Byx  Bxs  Bsy  Bxd  Axy(R=inf)   Azy(R=inf)',
     :  '  Bss(R=inf)  Byx(R=inf)  Bxs(R=inf)  Bsy(R=inf)',
     :  '  Bxd(R=inf)')
      do i=1,201
        call pot(vv0,rr)
        write (12,110) rr,(econv*vvl(j),j=1,19)
110     format(f7.2,19(1pe16.8))
        rr = rr + dr
      enddo
      close(12)
      end
* --------------------------------------------------------------------------
      subroutine pot (vv0, r)
*  subroutine to calculate the r-dependent coefficients
*  in atomic units (distance and energy)
* ----------------------------------------------------------------------
*  on entry:
*    r:      interparticle distance
*  on return:
*    vv0        (not used)
*    vvl(1,3)   contains the 1Sigma+, 1Pi, 1Delta energies
*    vvl(4,5)   contains the 3Sigma- and 3Pi PE energies
*    vvl(6,7)   contains Axy and Azy, the spin-orbit matrix elements
*               within the 3P state
*    vvl(8,12)  contains Bss, Byx, Bxs, Bsy, and Bxd, the spin-orbit
*               matrix elements coupling the 1D and 3P states
*    vvl(13,19) values of the Axy, Azy, Bss, Byx, Bxs, Bsy, and Bxd
*               matrix elements at R=inf
*  variable in common block /conlam/ used here
*    nlam:      the number of angular coupling terms actually used
*  variable in common block /covvl/
*    vvl:       array to store r-dependence of each
*               angular term in the potential
*  variable in common block /coconv/
*    econv:     conversion factor from cm-1 to hartrees
*  variables in common /cosysr/
*    isrcod:    number of real parameters
*    en1d:      asymptotic energy of the 1D state (cm-1)
* 
* author:  paul dagdigian
* latest revision date:  22-oct-2014
* adapted for C+N2 by j.klos: june-july 2015
* ----------------------------------------------------------------------
      implicit double precision (a-h,o-z)
      include "common/parbas"
      common /covvl/ vvl(19)

      dimension rr(85),vl(425),rso(22),somat(154)
      dimension csplel(85,5),csplso(22,12),vecel(85),vecso(22)
      dimension v(19)
*
*  values or R for PE curves
      data rr /
     +  2.600,  2.700,  2.800,  2.900,  3.000,
     +  3.100,  3.200,  3.300,  3.400,  3.500,
     +  3.600,  3.700,  3.800,  3.900,  4.000,
     +  4.100,  4.200,  4.300,  4.400,  4.500,
     +  4.600,  4.700,  4.800,  5.000,  5.100,
     +  5.200,  5.300,  5.400,  5.500,  5.600,
     +  5.700,  5.800,  5.900,  6.000,  6.100,
     +  6.200,  6.300,  6.400,  6.500,  6.600,
     +  6.700,  6.800,  6.900,  7.000,  7.100,
     +  7.200,  7.300,  7.400,  7.500,  7.600,
     +  7.700,  7.800,  7.900,  8.000,  8.250,
     +  8.500,  8.750,  9.000,  9.250,  9.500,
     +  9.750, 10.000, 10.250, 10.500, 10.750,
     + 11.000, 11.250, 11.500, 11.750, 12.000,
     + 12.500, 13.000, 13.500, 14.000, 15.000,
     + 16.000, 17.000, 18.000, 19.000, 20.000,
     + 22.000, 24.000, 26.000, 28.000, 30.000 /
*  values of the 5 PE curves
      data vl /  
* 1Sigma+ potential data
     + 7.1378912e+04, 5.4455505e+04, 4.0832646e+04, 3.0107940e+04,
     + 2.1778732e+04, 1.5402666e+04, 1.0634283e+04, 7.1772532e+03,
     + 4.7898580e+03, 3.2526571e+03, 2.3706513e+03, 2.0336251e+03,
     + 2.0449188e+03, 2.2677203e+03, 2.6097567e+03, 2.9893386e+03,
     + 3.3386298e+03, 3.6001504e+03, 3.7507060e+03, 3.7997866e+03,
     + 3.7599905e+03, 3.6506688e+03, 3.4926585e+03, 3.0906587e+03,
     + 2.8682858e+03, 2.6401250e+03, 2.4100058e+03, 2.1812107e+03,
     + 1.9564753e+03, 1.7384442e+03, 1.5294933e+03, 1.3319317e+03,
     + 1.1480682e+03, 9.8021162e+02, 8.3012191e+02, 6.9736273e+02,
     + 5.8094873e+02, 4.7989456e+02, 3.9321487e+02, 3.1980353e+02,
     + 2.5807118e+02, 2.0630770e+02, 1.6280295e+02, 1.2584680e+02,
     + 9.3968362e+01, 6.6653754e+01, 4.3628340e+01, 2.4617488e+01,
     + 9.3465623e+00, -2.5037679e+00, -1.1431628e+01, -1.7979839e+01,
     + -2.2691226e+01, -2.6108609e+01, -3.1319051e+01, -3.2912047e+01,
     + -3.1978691e+01, -2.9664737e+01, -2.6957783e+01, -2.4158147e+01,
     + -2.1394325e+01, -1.8794812e+01, -1.6462606e+01, -1.4398719e+01,
     + -1.2578661e+01, -1.0977944e+01, -9.5738552e+00, -8.3507825e+00,
     + -7.2948899e+00, -6.3923445e+00, -4.9811015e+00, -3.9517112e+00,
     + -3.1509926e+00, -2.5281608e+00, -1.6740009e+00, -1.1374769e+00,
     + -7.9115105e-01, -5.6182720e-01, -4.0644256e-01, -2.9896600e-01,
     + -1.6897408e-01, -1.0037590e-01, -6.2169682e-02, -3.9899424e-02,
     + -2.6402745e-02,
* 1Pi potential data
     + 5.6989311e+04, 4.4326256e+04, 3.4992079e+04, 2.8342034e+04,
     + 2.3858696e+04, 2.1184332e+04, 2.0010710e+04, 2.5362392e+04,
     + 2.2584564e+04, 2.0427364e+04, 1.9062040e+04, 1.8526889e+04,
     + 1.8769149e+04, 1.9381548e+04, 1.9594933e+04, 1.8822720e+04,
     + 1.7248337e+04, 1.5247574e+04, 1.3134919e+04, 1.1162777e+04,
     + 9.5221029e+03, 8.1688392e+03, 7.0023181e+03, 5.0731165e+03,
     + 4.3049525e+03, 3.6500404e+03, 3.0886790e+03, 2.6060420e+03,
     + 2.1921784e+03, 1.8378908e+03, 1.5361492e+03, 1.2804654e+03,
     + 1.0643513e+03, 8.8131889e+02, 7.2548288e+02, 5.9336989e+02,
     + 4.8210948e+02, 3.8883117e+02, 3.1066452e+02, 2.4498392e+02,
     + 1.9014309e+02, 1.4474064e+02, 1.0737516e+02, 7.6645221e+01,
     + 5.1280902e+01, 3.0538187e+01, 1.3804547e+01, 4.6744695e-01,
     + -1.0085643e+01, -1.8410637e+01, -2.4836965e+01, -2.9637441e+01,
     + -3.3084877e+01, -3.5452085e+01, -3.8018192e+01, -3.7303159e+01,
     + -3.4900511e+01, -3.1717041e+01, -2.8383668e+01, -2.5114536e+01,
     + -2.2019592e+01, -1.9208784e+01, -1.6765190e+01, -1.4664400e+01,
     + -1.2855133e+01, -1.1286109e+01, -9.9115917e+00, -8.7080198e+00,
     + -7.6573770e+00, -6.7416462e+00, -5.2497545e+00, -4.1227319e+00,
     + -3.2659892e+00, -2.6119374e+00, -1.7046771e+00, -1.1429565e+00,
     + -7.8443659e-01, -5.4959615e-01, -3.9220374e-01, -2.8453371e-01,
     + -1.5635353e-01, -9.0237060e-02, -5.4260218e-02, -3.3781889e-02,
     + -2.1668826e-02,
* 1delta_xy potential data
     + 4.5900327e+04, 3.1185636e+04, 2.0000188e+04, 1.1657144e+04,
     + 5.5918109e+03, 1.3401488e+03, -1.4722791e+03, -3.1598474e+03,
     + -4.0459173e+03, -4.3353490e+03, -4.2131054e+03, -3.8348234e+03,
     + -3.3272979e+03, -2.7713783e+03, -2.2120055e+03, -1.6927637e+03,
     + -1.2469427e+03, -9.0569895e+02, -6.7157547e+02, -5.1794001e+02,
     + -4.1955939e+02, -3.6187453e+02, -3.3308605e+02, -3.2549167e+02,
     + -3.3242488e+02, -3.4105034e+02, -3.4901719e+02, -3.5483241e+02,
     + -3.5786075e+02, -3.5766326e+02, -3.5443703e+02, -3.4853813e+02,
     + -3.4032267e+02, -3.3014671e+02, -3.1836282e+02, -3.0530943e+02,
     + -2.9132147e+02, -2.7673383e+02, -2.6188145e+02, -2.4706219e+02,
     + -2.3242585e+02, -2.1808520e+02, -2.0415300e+02, -1.9074201e+02,
     + -1.7794764e+02, -1.6579587e+02, -1.5429535e+02, -1.4345469e+02,
     + -1.3328253e+02, -1.2378082e+02, -1.1492475e+02, -1.0668283e+02,
     + -9.9023565e+01, -9.1915472e+01, -7.6351760e+01, -6.3554883e+01,
     + -5.3061018e+01, -4.4475683e+01, -3.7447150e+01, -3.1725372e+01,
     + -2.7085721e+01, -2.3303570e+01, -2.0173046e+01, -1.7563289e+01,
     + -1.5362194e+01, -1.3457656e+01, -1.1756715e+01, -1.0242999e+01,
     + -8.9192882e+00, -7.7883669e+00, -6.0648309e+00, -4.8379028e+00,
     + -3.8667749e+00, -3.1077844e+00, -2.0712883e+00, -1.4153046e+00,
     + -9.8997662e-01, -7.0699538e-01, -5.1433275e-01, -3.8043510e-01,
     + -2.1739745e-01, -1.3054806e-01, -8.1725461e-02, -5.3004666e-02,
     + -3.5440168e-02,
*  3Sigma- potential data
     + 5.0096029e+04, 3.5347272e+04, 2.4093549e+04, 1.5645871e+04,
     + 9.4374801e+03, 5.0053519e+03, 1.9804028e+03, 5.3501508e+01,
     + -1.0649420e+03, -1.5581259e+03, -1.6034225e+03, -1.3503807e+03,
     + -9.7311068e+02, -5.8126209e+02, -2.2898783e+02, 4.0115582e+01,
     + 2.2009862e+02, 3.1416866e+02, 3.3679476e+02, 3.1399220e+02,
     + 2.6888379e+02, 2.1101040e+02, 1.4647544e+02, 1.7005380e+01,
     + -4.0244515e+01, -9.0285428e+01, -1.3270418e+02, -1.6750576e+02,
     + -1.9511327e+02, -2.1601981e+02, -2.3092556e+02, -2.4058247e+02,
     + -2.4574251e+02, -2.4715764e+02, -2.4553223e+02, -2.4138030e+02,
     + -2.3516831e+02, -2.2736268e+02, -2.1842987e+02, -2.0878957e+02,
     + -1.9867457e+02, -1.8827089e+02, -1.7776459e+02, -1.6734170e+02,
     + -1.5716457e+02, -1.4730077e+02, -1.3779416e+02, -1.2868862e+02,
     + -1.2002803e+02, -1.1184692e+02, -1.0414243e+02, -9.6902366e+01,
     + -9.0114535e+01, -8.3766741e+01, -6.9718538e+01, -5.8010749e+01,
     + -4.8314940e+01, -4.0323306e+01, -3.3750197e+01, -2.8377967e+01,
     + -2.4005972e+01, -2.0433567e+01, -1.7475816e+01, -1.5010620e+01,
     + -1.2931587e+01, -1.1132328e+01, -9.5247146e+00, -8.0936781e+00,
     + -6.8424142e+00, -5.7741219e+00, -4.1514716e+00, -3.0114088e+00,
     + -2.1223881e+00, -1.4574644e+00, -7.1554613e-01, -3.0668960e-01,
     + -8.6870518e-02, 2.8052700e-02, 8.5134151e-02, 1.1025454e-01,
     + 1.1605629e-01, 1.0078655e-01, 8.2102540e-02, 6.5294797e-02,
     + 5.1532358e-02,
*  3Pi potential data
     + 6.0216722e+04, 4.7931691e+04, 3.9051386e+04, 3.2915960e+04,
     + 2.8971856e+04, 2.6938124e+04, 2.6363066e+04, 2.5888488e+04,
     + 2.2810254e+04, 2.0342030e+04, 1.8642583e+04, 1.7669699e+04,
     + 1.7261779e+04, 1.7256434e+04, 1.7482352e+04, 1.7706973e+04,
     + 1.7430275e+04, 1.6116717e+04, 1.3893739e+04, 1.1550972e+04,
     + 9.7283744e+03, 8.3520546e+03, 7.1757023e+03, 5.1328255e+03,
     + 4.3243129e+03, 3.6465749e+03, 3.0686258e+03, 2.5707074e+03,
     + 2.1442886e+03, 1.7814599e+03, 1.4748445e+03, 1.2171988e+03,
     + 1.0012792e+03, 8.1984222e+02, 6.6635437e+02, 5.3712246e+02,
     + 4.2916337e+02, 3.3949401e+02, 2.6513127e+02, 2.0334413e+02,
     + 1.5240989e+02, 1.1085794e+02, 7.7217674e+01, 5.0018473e+01,
     + 2.7933876e+01, 1.0214015e+01, -3.7468301e+00, -1.4554380e+01,
     + -2.2814355e+01, -2.9074561e+01, -3.3651149e+01, -3.6802357e+01,
     + -3.8786422e+01, -3.9861582e+01, -3.9856033e+01, -3.7348750e+01,
     + -3.3742452e+01, -2.9790979e+01, -2.5994588e+01, -2.2488072e+01,
     + -1.9314861e+01, -1.6518384e+01, -1.4125204e+01, -1.2094424e+01,
     + -1.0368281e+01, -8.8890134e+00, -7.6047022e+00, -6.4868058e+00,
     + -5.5126245e+00, -4.6594489e+00, -3.2428755e+00, -2.1430968e+00,
     + -1.2971492e+00, -7.2907896e-01, -1.2794280e-01, 1.6711117e-01,
     + 2.9354933e-01, 3.3423928e-01, 3.3267313e-01, 3.1146219e-01,
     + 2.5135795e-01, 1.9394936e-01, 1.4770906e-01, 1.1246340e-01,
     + 8.6091057e-02/
*  values or R for spin-orbit matrix elements
      data rso /  
     +  2.500,  2.600,  2.700,  2.800,  2.900,
     +  3.000,  3.250,  3.500,  3.750,  4.000,
     +  4.250,  4.500,  4.750,  5.000,  5.250,
     +  5.500,  6.000,  6.500,  7.000,  7.500,
     +  8.000,  8.500 /
*  values of Axy and Azy - spin-orbit matrix elements within 3P state
*  then values of the B spin-orbit matrix elements, coupling the 1D and 3P states
       data somat /  
*Axy 
     + 7.3533064e+00, 7.1760858e+00, 7.2032622e+00, 7.0677826e+00,
     + 6.8191100e+00, 6.4441836e+00, 4.6125346e+00, 2.7045492e+00,
     + 1.8016910e+00, 8.8584460e-01, -1.1301260e+01, -1.2132700e+01,
     + -1.2185314e+01, -1.2251393e+01, -1.2323324e+01, -1.2391251e+01,
     + -1.2501664e+01, -1.2573060e+01, -1.2613743e+01, -1.2635765e+01,
     + -1.2647385e+01,-1.2653434e+01,
*Azy
     + 1.5997406e+01, 1.5393277e+01, 1.4672379e+01, 1.3868708e+01,
     + 1.2973927e+01, 1.1966807e+01, -3.2734576e+00, -4.2296898e+00,
     + -5.0625812e+00, -5.7112436e+00, -9.6140138e+00, -9.6788492e+00,
     + -9.4706408e+00, -9.3193416e+00, -9.2156842e+00, -9.1435636e+00,
     + -9.0538820e+00, -9.0057412e+00, -8.9801800e+00, -8.9665226e+00,
     + -8.9592414e+00, -8.9555396e+00,
*Now SO matrices coupling 1D with 3P
*Bss
     + -1.2636580e+01, -1.2483684e+01, -1.2345977e+01, -1.2188727e+01,
     + -1.2016666e+01, -1.1831139e+01, -1.1339144e+01, -1.0794024e+01,
     + -1.0471625e+01, -1.0251196e+01, -1.0052757e+01, -1.0397351e+01,
     + -1.0814327e+01, -1.1104682e+01, -1.1190682e+01, -1.1045988e+01,
     + -1.0235880e+01, -1.0015630e+01, -1.4632104e+01, -1.7580381e+01,
     + -1.7575874e+01, -1.7516951e+01,
*Byx
     + -1.8704955e+01, -1.8775959e+01, -1.8820181e+01, -1.8852884e+01,
     + -1.8872291e+01, -1.8867772e+01, -1.8123240e+01, -1.7098610e+01,
     + -1.6533818e+01, -1.5680805e+01, -1.4046242e+01, -1.4501206e+01,
     + -1.4595934e+01, -1.4698057e+01, -1.4792462e+01, -1.4872485e+01,
     + -1.4989496e+01, -1.5059140e+01, -1.5097222e+01, -1.5117346e+01,
     + -1.5127853e+01, -1.5133355e+01,
*Bxs
     + 1.1955620e+01, 1.1599867e+01, 1.0986716e+01, 1.0658346e+01,
     + 1.0471981e+01, 1.0390853e+01, 6.3962542e+00, -2.0167710e+00,
     + -2.9905988e+00, -4.0267374e+00, -4.3569860e-01, -1.3606194e+00,
     + -2.2477394e+00, -3.0468912e+00, -3.8493280e+00, -4.7240870e+00,
     + -6.2941958e+00, -7.1867050e+00, -4.4684650e+00, -4.0165420e+00,
     + -4.8488046e+00, -5.1357016e+00,
*Bsy
     + 1.5595443e+01, 1.5060100e+01, 1.4428877e+01, 1.3717902e+01,
     + 1.2922150e+01, 1.2036464e+01, 6.1275298e+00, -5.2415502e+00,
     + -6.4476436e+00, -7.8913314e+00, -1.1305415e+01, -1.1262216e+01,
     + -1.1125409e+01, -1.1020931e+01, -1.0944991e+01, -1.0888427e+01,
     + -1.0810886e+01, -1.0764282e+01, -1.0737297e+01, -1.0721993e+01,
     + -1.0713580e+01, -1.0709255e+01,
*Bxd
     + 1.2826999e+01, 4.8097760e+00, 2.6086924e+00, 1.9586522e+00,
     + 1.4925332e+00, 1.1311968e+00, 3.6209264e+00, 6.9875558e+00,
     + 6.4788620e+00, 5.1165226e+00, -1.6010948e+00, -3.1824814e+00,
     + -5.3530848e+00, -5.6219994e+00, -6.4720552e+00, -7.1100466e+00,
     + -7.9373760e+00, -8.7424488e+00, -1.1276066e+01, -1.1522868e+01,
     + -1.1306808e+01, -1.1220817e+01/
*
*  set vv0 term to zero
      vv0 = 0.d0
*
*  spline fits
      if (ifirst .eq. 0) then
*  spline fit of the coefficients for the PE curves
        indel=1
        do ilam=1,5
          call dcopy(85,vl(indel),1,vecel,1)
*  evaluate derivative at first point
          der1=(vecel(2)-vecel(1))/(rr(2)-rr(1))
          call dspline(rr,vecel,85,der1,0d0,csplel(1,ilam))
          indel = indel + 85
        enddo
*  spline fit of the coefficients for the spin-orbit matrix elements
        indso=1
        do ilam=6,12
          call dcopy(22,somat(indso),1,vecso,1)
*  evaluate derivative at first point
          der1=(vecso(2)-vecso(1))/(rso(2)-rso(1))
          call dspline(rso,vecso,22,der1,0d0,csplso(1,ilam))
          indso = indso + 22   !1st
        enddo
        ifirst = 1
      endif
*  determine splined coefficients for PE curves at r=R
      indel=1
      do ilam=1,5
        call dcopy(85,vl(indel),1,vecel,1)
        call dsplint(rr,vecel,csplel(1,ilam),85,r,vvx)
        v(ilam) = vvx
        call dcopy(85,vl(indel),1,vecel,1)
        indel = indel + 85
*  fix long-range behavior of PE curves to go to zero at large R
        if (r.gt.25.d0) then
          switch_lr = 0.5*(tanh(0.5*(r - 30.d0)) + 1.d0)
          v(ilam) = (1.d0 - switch_lr) * v(ilam)
        endif
      enddo
*  determine splined coefficients for spin-orbit matrix elements at r=R
      indso=1
      do ilam=6,12
        call dcopy(22,somat(indso),1,vecso,1)
        call dsplint(rso,vecso,csplso(1,ilam),22,r,vvx)
        v(ilam) = vvx
        call dcopy(22,somat(indso),1,vecso,1)
        indso = indso + 22
c  if r equals 8.5 bohr, set equal to SO matrix element at R=8.5
        if (r.ge.8.5d0) v(ilam) = somat(indso-1)
        v(ilam+7) = somat(indso-1)
      enddo
      call dcopy(19,v,1,vvl,1)
* convert to hartree
      econv=1.d0/219474.6d0
      call dscal(19,econv,vvl,1)
      return
      end
*===================================eof====================================
