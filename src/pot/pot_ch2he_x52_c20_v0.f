*  system:  CH2(X)-He, PES from Lifang Ma
*  Modified by Lifang Ma, 03/02/2011
*  Modified by Lifang Ma, 03/29/2011, now number of coefficients is 20.
*
*  L. Ma, P. J. Dagdigian, and M. H. Alexander, J. Chem. Phys. 136, 224306 (2012).
*
*  CH2 defined to lie on the xz plane, with the origin at center of mass
*  x axis is the C2 symmetry axis of the CH2 molecule
*  z axis is the a inertial axis of the molecule (perpendicular to C2 axis)
*  when theta = 90, phi = 0, He is on C side of molecule
*  phi = 0 has all 4 atoms coplanar
*
*  Note:  subroutine spline_ch2he requires 1 data file to be in hib44/bin/progs/potdata:
*         ch2he_x52_v0.dat
*
      include "common/syusr"
      include "common/ground"
      include "common/bausr"
* ------------------------------------------------------------------------
      subroutine driver
      implicit double precision (a-h,o-z)
      common /covvl/ vvl(19)
*      common /vspline/ vsp_jacek(52)
      common /coloapot/ s4pi
      common /copotvec/ vec(40,21)
      include "common/parpot"
      s4pi = sqrt ( 4.d0 * acos(-1.d0) )
      rr=3.5d0
      dr=0.5d0
      potnam='MA CH2(X,000)-He PES'
      print *, potnam
1     print *, 'R (bohr):'
      read (5, *, end=99) r
      call pot(vv0,r)
      econv=219474.6d0
*     vlm coefficient is returned in atomic units (hartree)
*     convert from atomic units for printout
      write (6, 100) vv0*econv*s4pi, (econv*vvl(i), i=1,19)
100   format(/' v(lam,0):',4(1pe16.8)/' v(lam,1):',3(1pe16.8)/
     :    ' v(lam,2):',3(1pe16.8)/' v(lam,3):',3(1pe16.8)/
     :    ' v(lam,4):',3(1pe16.8)/' v(lam,5):',2(1pe16.8)/
     :    ' v(lam,6):',2(1pe16.8)/)
99       goto 1
      end
* ------------------------------------------------------------------------
      subroutine loapot(iunit,filnam)
      implicit double precision (a-h,o-z)
      character*(*) filnam
      include "common/parbas"
      include "common/parpot" 
      common /conlam/ nlam, nlammx, lamnum(2)
      potnam='MA CH2(X,000)-He PES'
*
      nterm = 7
      do i=1,nterm
        mproj(i)=i-1
      enddo
      lammin(1) = 2
      do i=2,nterm
        lammin(i)=i-1
      enddo
      lammax(1) = 6
      lammax(2) = 5
      lammax(3) = 6
      lammax(4) = 7
      lammax(5) = 8
      lammax(6) = 7
      lammax(7) = 8
      nlam=0
*      do i=1,nterm
*          lamnum(i)=lammax(i)-lammin(i)+1
*          nlam=nlam+lamnum(i)
*      enddo
*      nlamhold=nlam
*
      ipotsy = 2
*
      ntv(1)=1
      ivcol(1,1)=0
      ivrow(1,1)=0
*  calculate total number of anisotropic terms
      nlam = 0
      do i=1,nterm
        lmin = lammin(i)
        lmax = lammax(i)
        lamnum(i)=(lammax(i)-lammin(i))/2+1
        do lb = lmin, lmax, ipotsy
          nlam = nlam + 1
        end do
      end do
*      print *, 'nlam, nlamhold:  ', nlam, nlamhold
      nlammx = nlam
      return
      end
* ----------------------------------------------------------------------
      subroutine pot (vv0, r)
*  subroutine to calculate the r-dependent coefficients
*  in atomic units (distance and energy)
* ----------------------------------------------------------------------
*  on entry:
*    r:          interparticle distance
*  on return:
*    vv0         contains isotropic term (Y00)
*  variable in common block /covvl/
*    vvl:        vector of length 6 to store r-dependence of each term
*                in potential expansion
*    vvl(1-3):   expansion coefficients in Yl0 (l=2:6:2) of v(lam,0)
*    vvl(4-6):   expansion coefficients in [Yl1 + Y(l,-1)] (l=1:5:2) of v(lam,1)
*    vvl(7-9):   expansion coefficients in [Yl2 + Y(l,-2)] (l=2:6:2) of v(lam,2)
*    vvl(10-12): expansion coefficients in [Yl3 + Y(l,-3)] (l=3:7:2) of v(lam,3)
*    vvl(13-15): expansion coefficients in [Yl4 + Y(l,-4)] (l=4:8:2) of v(lam,4)
*    vvl(16-17): expansion coefficients in [Yl5 + Y(l,-5)] (l=5:7:2) of v(lam,5)
*    vvl(18-19): expansion coefficients in [Yl6 + Y(l,-6)] (l=6:8:2) of v(lam,6)
*  variable in common block /coloapot/
*    s4pi:       normalization factor for isotropic potential
*
*  uses linear least squares routines from lapack
*
* author:  lifang ma and paul dagdigian
* latest revision date:  march-29-2011
*
      implicit double precision (a-h,o-z)
      dimension iwork(3000),ylm(52,20)
      dimension swork(20), work(3624)
      dimension y00(52),y11(52),y20(52),y22(52),y31(52)
      dimension y33(52),y40(52),y42(52),y51(52),y53(52)
      dimension y60(52),y62(52),y44(52),y55(52),y64(52)
      dimension y66(52),y73(52),y75(52),y84(52),y86(52)
*
*
      common /covvl/ vvl(19)
      common /coloapot/ s4pi
      common /vspline/ vsp_jacek(52)
      common /vvalue/  vv(988),v(19,52), vvec(19)
      data c6 /8.396812d6/

*
*  coefficients for Ylm terms - all (lambda,mu) combinations up to lambda .le. 8
*  and mu .le. 6, except y71, y80 and y82 terms due to linear dependence problem
*  with lambda + mu = even (total of 19 anisotropic terms)
*  determined on a grid of 10 theta and 6 phi values:
*    th = [0:30:90];   %grid of 4 angles
*    ph = [0:15:180];  %grid of 13 angles
*  Ylm(th,ph) is calulated by ~/ch2he/x_bent/fitting_AOG/fitting_AOG_v0_c20.m, with the order of 
*  ph=0, th=0~90->ph=15, th=0~90 â€¦.->ph=180, th=0~90
*  All values of Ylm have been normalized
*  Note:  The ylm terms for mu .gt. 0 are defined as:
*           [Y(lambda,mu) + (-1)^mu * Y(lambda, -nu)]
*
         data y00/
     :2.8209479d-1,   2.8209479d-1,   2.8209479d-1,  
     :2.8209479d-1,   2.8209479d-1,   2.8209479d-1,  
     :2.8209479d-1,   2.8209479d-1,   2.8209479d-1,  
     :2.8209479d-1,   2.8209479d-1,   2.8209479d-1,  
     :2.8209479d-1,   2.8209479d-1,   2.8209479d-1,  
     :2.8209479d-1,   2.8209479d-1,   2.8209479d-1,  
     :2.8209479d-1,   2.8209479d-1,   2.8209479d-1,  
     :2.8209479d-1,   2.8209479d-1,   2.8209479d-1,  
     :2.8209479d-1,   2.8209479d-1,   2.8209479d-1,  
     :2.8209479d-1,   2.8209479d-1,   2.8209479d-1,  
     :2.8209479d-1,   2.8209479d-1,   2.8209479d-1,  
     :2.8209479d-1,   2.8209479d-1,   2.8209479d-1,  
     :2.8209479d-1,   2.8209479d-1,   2.8209479d-1,  
     :2.8209479d-1,   2.8209479d-1,   2.8209479d-1,  
     :2.8209479d-1,   2.8209479d-1,   2.8209479d-1,  
     :2.8209479d-1,   2.8209479d-1,   2.8209479d-1,  
     :2.8209479d-1,   2.8209479d-1,   2.8209479d-1,  
     :2.8209479d-1/
                data y20/
     :6.3078313d-1,   3.9423946d-1,  -7.8847891d-2, 
     :-3.1539157d-1,   6.3078313d-1,   3.9423946d-1, 
     :-7.8847891d-2,  -3.1539157d-1,   6.3078313d-1,  
     :3.9423946d-1,  -7.8847891d-2,  -3.1539157d-1,  
     :6.3078313d-1,   3.9423946d-1,  -7.8847891d-2, 
     :-3.1539157d-1,   6.3078313d-1,   3.9423946d-1, 
     :-7.8847891d-2,  -3.1539157d-1,   6.3078313d-1,  
     :3.9423946d-1,  -7.8847891d-2,  -3.1539157d-1,  
     :6.3078313d-1,   3.9423946d-1,  -7.8847891d-2, 
     :-3.1539157d-1,   6.3078313d-1,   3.9423946d-1, 
     :-7.8847891d-2,  -3.1539157d-1,   6.3078313d-1,  
     :3.9423946d-1,  -7.8847891d-2,  -3.1539157d-1,  
     :6.3078313d-1,   3.9423946d-1,  -7.8847891d-2, 
     :-3.1539157d-1,   6.3078313d-1,   3.9423946d-1, 
     :-7.8847891d-2,  -3.1539157d-1,   6.3078313d-1,  
     :3.9423946d-1,  -7.8847891d-2,  -3.1539157d-1,  
     :6.3078313d-1,   3.9423946d-1,  -7.8847891d-2, 
     :-3.1539157d-1/
                data y40/
     :8.4628438d-1,   1.9834790d-2,  -2.4462908d-1,  
     :3.1735664d-1,   8.4628438d-1,   1.9834790d-2, 
     :-2.4462908d-1,   3.1735664d-1,   8.4628438d-1,  
     :1.9834790d-2,  -2.4462908d-1,   3.1735664d-1,  
     :8.4628438d-1,   1.9834790d-2,  -2.4462908d-1,  
     :3.1735664d-1,   8.4628438d-1,   1.9834790d-2, 
     :-2.4462908d-1,   3.1735664d-1,   8.4628438d-1,  
     :1.9834790d-2,  -2.4462908d-1,   3.1735664d-1,  
     :8.4628438d-1,   1.9834790d-2,  -2.4462908d-1,  
     :3.1735664d-1,   8.4628438d-1,   1.9834790d-2, 
     :-2.4462908d-1,   3.1735664d-1,   8.4628438d-1,  
     :1.9834790d-2,  -2.4462908d-1,   3.1735664d-1,  
     :8.4628438d-1,   1.9834790d-2,  -2.4462908d-1,  
     :3.1735664d-1,   8.4628438d-1,   1.9834790d-2, 
     :-2.4462908d-1,   3.1735664d-1,   8.4628438d-1,  
     :1.9834790d-2,  -2.4462908d-1,   3.1735664d-1,  
     :8.4628438d-1,   1.9834790d-2,  -2.4462908d-1,  
     :3.1735664d-1/
                 data y60/
     :1.0171072d0,  -3.8042194d-1,   3.2877197d-1, 
     :-3.1784601d-1,   1.0171072d0,  -3.8042194d-1,  
     :3.2877197d-1,  -3.1784601d-1,   1.0171072d0, 
     :-3.8042194d-1,   3.2877197d-1,  -3.1784601d-1,  
     :1.0171072d0,  -3.8042194d-1,   3.2877197d-1, 
     :-3.1784601d-1,   1.0171072d0,  -3.8042194d-1,  
     :3.2877197d-1,  -3.1784601d-1,   1.0171072d0, 
     :-3.8042194d-1,   3.2877197d-1,  -3.1784601d-1,  
     :1.0171072d0,  -3.8042194d-1,   3.2877197d-1, 
     :-3.1784601d-1,   1.0171072d0,  -3.8042194d-1,  
     :3.2877197d-1,  -3.1784601d-1,   1.0171072d0, 
     :-3.8042194d-1,   3.2877197d-1,  -3.1784601d-1,  
     :1.0171072d0,  -3.8042194d-1,   3.2877197d-1, 
     :-3.1784601d-1,   1.0171072d0,  -3.8042194d-1,  
     :3.2877197d-1,  -3.1784601d-1,   1.0171072d0, 
     :-3.8042194d-1,   3.2877197d-1,  -3.1784601d-1,  
     :1.0171072d0,  -3.8042194d-1,   3.2877197d-1, 
     :-3.1784601d-1/
               data y11/
     :0.0000000d0,  -3.4549415d-1,  -5.9841342d-1, 
     :-6.9098830d-1,   0.0000000d0,  -3.3372172d-1, 
     :-5.7802298d-1,  -6.6744344d-1,   0.0000000d0, 
     :-2.9920671d-1,  -5.1824122d-1,  -5.9841342d-1,  
     :0.0000000d0,  -2.4430126d-1,  -4.2314219d-1, 
     :-4.8860251d-1,   0.0000000d0,  -1.7274707d-1, 
     :-2.9920671d-1,  -3.4549415d-1,   0.0000000d0, 
     :-8.9420466d-2,  -1.5488079d-1,  -1.7884093d-1,  
     :0.0000000d0,  -2.1155415d-17,  -3.6642254d-17, 
     :-4.2310830d-17,  -0.0000000d0,   8.9420466d-2,  
     :1.5488079d-1,   1.7884093d-1,  -0.0000000d0,  
     :1.7274707d-1,   2.9920671d-1,   3.4549415d-1, 
     :-0.0000000d0,   2.4430126d-1,   4.2314219d-1,  
     :4.8860251d-1,  -0.0000000d0,   2.9920671d-1,  
     :5.1824122d-1,   5.9841342d-1,  -0.0000000d0,  
     :3.3372172d-1,   5.7802298d-1,   6.6744344d-1, 
     :-0.0000000d0,   3.4549415d-1,   5.9841342d-1,  
     :6.9098830d-1/
             data y31/
     :0.0000000d0,  -8.8874551d-1,  -1.3994112d-1,  
     :6.4636037d-1,   0.0000000d0,  -8.5846224d-1, 
     :-1.3517275d-1,   6.2433617d-1,   0.0000000d0, 
     :-7.6967619d-1,  -1.2119257d-1,   5.5976450d-1,  
     :0.0000000d0,  -6.2843797d-1,  -9.8953318d-2,  
     :4.5704580d-1,   0.0000000d0,  -4.4437275d-1, 
     :-6.9970562d-2,   3.2318018d-1,   0.0000000d0, 
     :-2.3002426d-1,  -3.6219428d-2,   1.6729037d-1,  
     :0.0000000d0,  -5.4419967d-17,  -8.5689225d-18,  
     :3.9578158d-17,  -0.0000000d0,   2.3002426d-1,  
     :3.6219428d-2,  -1.6729037d-1,  -0.0000000d0,  
     :4.4437275d-1,   6.9970562d-2,  -3.2318018d-1, 
     :-0.0000000d0,   6.2843797d-1,   9.8953318d-2, 
     :-4.5704580d-1,  -0.0000000d0,   7.6967619d-1,  
     :1.2119257d-1,  -5.5976450d-1,  -0.0000000d0,  
     :8.5846224d-1,   1.3517275d-1,  -6.2433617d-1, 
     :-0.0000000d0,   8.8874551d-1,   1.3994112d-1, 
     :-6.4636037d-1/
            data y51/
     :0.0000000d0,  -7.4065131d-1,   6.5875860d-1, 
     :-6.4056330d-1,   0.0000000d0,  -7.1541423d-1,  
     :6.3631195d-1,  -6.1873663d-1,   0.0000000d0, 
     :-6.4142285d-1,   5.7050169d-1,  -5.5474409d-1,  
     :0.0000000d0,  -5.2371957d-1,   4.6581268d-1, 
     :-4.5294665d-1,   0.0000000d0,  -3.7032566d-1,  
     :3.2937930d-1,  -3.2028165d-1,   0.0000000d0, 
     :-1.9169467d-1,   1.7049927d-1,  -1.6578998d-1,  
     :0.0000000d0,  -4.5351813d-17,   4.0337331d-17, 
     :-3.9223191d-17,  -0.0000000d0,   1.9169467d-1, 
     :-1.7049927d-1,   1.6578998d-1,  -0.0000000d0,  
     :3.7032566d-1,  -3.2937930d-1,   3.2028165d-1, 
     :-0.0000000d0,   5.2371957d-1,  -4.6581268d-1,  
     :4.5294665d-1,  -0.0000000d0,   6.4142285d-1, 
     :-5.7050169d-1,   5.5474409d-1,  -0.0000000d0,  
     :7.1541423d-1,  -6.3631195d-1,   6.1873663d-1, 
     :-0.0000000d0,   7.4065131d-1,  -6.5875860d-1,  
     :6.4056330d-1/
          data y22/
     :0.0000000d0,   1.9313710d-1,   5.7941130d-1,  
     :7.7254840d-1,   0.0000000d0,   1.6726164d-1,  
     :5.0178491d-1,   6.6904654d-1,   0.0000000d0,  
     :9.6568551d-2,   2.8970565d-1,   3.8627420d-1,  
     :0.0000000d0,   1.1826237d-17,   3.5478710d-17,  
     :4.7304947d-17,  -0.0000000d0,  -9.6568551d-2, 
     :-2.8970565d-1,  -3.8627420d-1,  -0.0000000d0, 
     :-1.6726164d-1,  -5.0178491d-1,  -6.6904654d-1, 
     :-0.0000000d0,  -1.9313710d-1,  -5.7941130d-1, 
     :-7.7254840d-1,  -0.0000000d0,  -1.6726164d-1, 
     :-5.0178491d-1,  -6.6904654d-1,  -0.0000000d0, 
     :-9.6568551d-2,  -2.8970565d-1,  -3.8627420d-1, 
     :-0.0000000d0,  -3.5478710d-17,  -1.0643613d-16, 
     :-1.4191484d-16,   0.0000000d0,   9.6568551d-2,  
     :2.8970565d-1,   3.8627420d-1,   0.0000000d0,  
     :1.6726164d-1,   5.0178491d-1,   6.6904654d-1,  
     :0.0000000d0,   1.9313710d-1,   5.7941130d-1,  
     :7.7254840d-1/
          data y42/
     :0.0000000d0,   7.1086195d-1,   3.7633868d-1, 
     :-6.6904654d-1,   0.0000000d0,   6.1562451d-1,  
     :3.2591886d-1,  -5.7941130d-1,   0.0000000d0,  
     :3.5543098d-1,   1.8816934d-1,  -3.3452327d-1,  
     :0.0000000d0,   4.3527741d-17,   2.3044098d-17, 
     :-4.0967285d-17,  -0.0000000d0,  -3.5543098d-1, 
     :-1.8816934d-1,   3.3452327d-1,  -0.0000000d0, 
     :-6.1562451d-1,  -3.2591886d-1,   5.7941130d-1, 
     :-0.0000000d0,  -7.1086195d-1,  -3.7633868d-1,  
     :6.6904654d-1,  -0.0000000d0,  -6.1562451d-1, 
     :-3.2591886d-1,   5.7941130d-1,  -0.0000000d0, 
     :-3.5543098d-1,  -1.8816934d-1,   3.3452327d-1, 
     :-0.0000000d0,  -1.3058322d-16,  -6.9132294d-17,  
     :1.2290186d-16,   0.0000000d0,   3.5543098d-1,  
     :1.8816934d-1,  -3.3452327d-1,   0.0000000d0,  
     :6.1562451d-1,   3.2591886d-1,  -5.7941130d-1,  
     :0.0000000d0,   7.1086195d-1,   3.7633868d-1, 
     :-6.6904654d-1/
           data y62/
     :0.0000000d0,   9.8726371d-1,  -7.0228037d-1,  
     :6.5139049d-1,   0.0000000d0,   8.5499545d-1, 
     :-6.0819264d-1,   5.6412071d-1,   0.0000000d0,  
     :4.9363185d-1,  -3.5114018d-1,   3.2569524d-1,  
     :0.0000000d0,   6.0452467d-17,  -4.3002270d-17,  
     :3.9886164d-17,  -0.0000000d0,  -4.9363185d-1,  
     :3.5114018d-1,  -3.2569524d-1,  -0.0000000d0, 
     :-8.5499545d-1,   6.0819264d-1,  -5.6412071d-1, 
     :-0.0000000d0,  -9.8726371d-1,   7.0228037d-1, 
     :-6.5139049d-1,  -0.0000000d0,  -8.5499545d-1,  
     :6.0819264d-1,  -5.6412071d-1,  -0.0000000d0, 
     :-4.9363185d-1,   3.5114018d-1,  -3.2569524d-1, 
     :-0.0000000d0,  -1.8135740d-16,   1.2900681d-16, 
     :-1.1965849d-16,   0.0000000d0,   4.9363185d-1, 
     :-3.5114018d-1,   3.2569524d-1,   0.0000000d0,  
     :8.5499545d-1,  -6.0819264d-1,   5.6412071d-1,  
     :0.0000000d0,   9.8726371d-1,  -7.0228037d-1,  
     :6.5139049d-1/
           data y33/
     :0.0000000d0,  -1.0430596d-1,  -5.4198965d-1, 
     :-8.3444765d-1,   0.0000000d0,  -7.3755449d-2, 
     :-3.8324455d-1,  -5.9004359d-1,   0.0000000d0, 
     :-6.3868978d-18,  -3.3187294d-17,  -5.1095182d-17, 
     :-0.0000000d0,   7.3755449d-2,   3.8324455d-1,  
     :5.9004359d-1,  -0.0000000d0,   1.0430596d-1,  
     :5.4198965d-1,   8.3444765d-1,  -0.0000000d0,  
     :7.3755449d-2,   3.8324455d-1,   5.9004359d-1, 
     :-0.0000000d0,   1.9160693d-17,   9.9561883d-17,  
     :1.5328555d-16,   0.0000000d0,  -7.3755449d-2, 
     :-3.8324455d-1,  -5.9004359d-1,   0.0000000d0, 
     :-1.0430596d-1,  -5.4198965d-1,  -8.3444765d-1,  
     :0.0000000d0,  -7.3755449d-2,  -3.8324455d-1, 
     :-5.9004359d-1,   0.0000000d0,  -3.1934489d-17, 
     :-1.6593647d-16,  -2.5547591d-16,  -0.0000000d0,  
     :7.3755449d-2,   3.8324455d-1,   5.9004359d-1, 
     :-0.0000000d0,   1.0430596d-1,   5.4198965d-1,  
     :8.3444765d-1/
          data y53/
     :0.0000000d0,  -4.9729410d-1,  -5.6174259d-1,  
     :6.9188744d-1,   0.0000000d0,  -3.5164003d-1, 
     :-3.9721200d-1,   4.8923830d-1,   0.0000000d0, 
     :-3.0450481d-17,  -3.4396813d-17,   4.2365887d-17, 
     :-0.0000000d0,   3.5164003d-1,   3.9721200d-1, 
     :-4.8923830d-1,  -0.0000000d0,   4.9729410d-1,  
     :5.6174259d-1,  -6.9188744d-1,  -0.0000000d0,  
     :3.5164003d-1,   3.9721200d-1,  -4.8923830d-1, 
     :-0.0000000d0,   9.1351443d-17,   1.0319144d-16, 
     :-1.2709766d-16,   0.0000000d0,  -3.5164003d-1, 
     :-3.9721200d-1,   4.8923830d-1,   0.0000000d0, 
     :-4.9729410d-1,  -5.6174259d-1,   6.9188744d-1,  
     :0.0000000d0,  -3.5164003d-1,  -3.9721200d-1,  
     :4.8923830d-1,   0.0000000d0,  -1.5225241d-16, 
     :-1.7198407d-16,   2.1182943d-16,  -0.0000000d0,  
     :3.5164003d-1,   3.9721200d-1,  -4.8923830d-1, 
     :-0.0000000d0,   4.9729410d-1,   5.6174259d-1, 
     :-6.9188744d-1/
         data y73/
     :0.0000000d0,  -9.3865333d-1,   6.5570748d-1, 
     :-6.6379904d-1,   0.0000000d0,  -6.6372813d-1,  
     :4.6365520d-1,  -4.6937680d-1,   0.0000000d0, 
     :-5.7475940d-17,   4.0150503d-17,  -4.0645968d-17, 
     :-0.0000000d0,   6.6372813d-1,  -4.6365520d-1,  
     :4.6937680d-1,  -0.0000000d0,   9.3865333d-1, 
     :-6.5570748d-1,   6.6379904d-1,  -0.0000000d0,  
     :6.6372813d-1,  -4.6365520d-1,   4.6937680d-1, 
     :-0.0000000d0,   1.7242782d-16,  -1.2045151d-16,  
     :1.2193791d-16,   0.0000000d0,  -6.6372813d-1,  
     :4.6365520d-1,  -4.6937680d-1,   0.0000000d0, 
     :-9.3865333d-1,   6.5570748d-1,  -6.6379904d-1,  
     :0.0000000d0,  -6.6372813d-1,   4.6365520d-1, 
     :-4.6937680d-1,   0.0000000d0,  -2.8737970d-16,  
     :2.0075252d-16,  -2.0322984d-16,  -0.0000000d0,  
     :6.6372813d-1,  -4.6365520d-1,   4.6937680d-1, 
     :-0.0000000d0,   9.3865333d-1,  -6.5570748d-1,  
     :6.6379904d-1/
         data y44/
     :0.0000000d0,   5.5316587d-2,   4.9784928d-1,  
     :8.8506538d-1,   0.0000000d0,   2.7658293d-2,  
     :2.4892464d-1,   4.4253269d-1,  -0.0000000d0, 
     :-2.7658293d-2,  -2.4892464d-1,  -4.4253269d-1, 
     :-0.0000000d0,  -5.5316587d-2,  -4.9784928d-1, 
     :-8.8506538d-1,  -0.0000000d0,  -2.7658293d-2, 
     :-2.4892464d-1,  -4.4253269d-1,   0.0000000d0,  
     :2.7658293d-2,   2.4892464d-1,   4.4253269d-1,  
     :0.0000000d0,   5.5316587d-2,   4.9784928d-1,  
     :8.8506538d-1,   0.0000000d0,   2.7658293d-2,  
     :2.4892464d-1,   4.4253269d-1,  -0.0000000d0, 
     :-2.7658293d-2,  -2.4892464d-1,  -4.4253269d-1, 
     :-0.0000000d0,  -5.5316587d-2,  -4.9784928d-1, 
     :-8.8506538d-1,  -0.0000000d0,  -2.7658293d-2, 
     :-2.4892464d-1,  -4.4253269d-1,   0.0000000d0,  
     :2.7658293d-2,   2.4892464d-1,   4.4253269d-1,  
     :0.0000000d0,   5.5316587d-2,   4.9784928d-1,  
     :8.8506538d-1/
         data y64/
     :0.0000000d0,   3.2333302d-1,   7.0241311d-1, 
     :-7.1356253d-1,   0.0000000d0,   1.6166651d-1,  
     :3.5120656d-1,  -3.5678126d-1,  -0.0000000d0, 
     :-1.6166651d-1,  -3.5120656d-1,   3.5678126d-1, 
     :-0.0000000d0,  -3.2333302d-1,  -7.0241311d-1,  
     :7.1356253d-1,  -0.0000000d0,  -1.6166651d-1, 
     :-3.5120656d-1,   3.5678126d-1,   0.0000000d0,  
     :1.6166651d-1,   3.5120656d-1,  -3.5678126d-1,  
     :0.0000000d0,   3.2333302d-1,   7.0241311d-1, 
     :-7.1356253d-1,   0.0000000d0,   1.6166651d-1,  
     :3.5120656d-1,  -3.5678126d-1,  -0.0000000d0, 
     :-1.6166651d-1,  -3.5120656d-1,   3.5678126d-1, 
     :-0.0000000d0,  -3.2333302d-1,  -7.0241311d-1,  
     :7.1356253d-1,  -0.0000000d0,  -1.6166651d-1, 
     :-3.5120656d-1,   3.5678126d-1,   0.0000000d0,  
     :1.6166651d-1,   3.5120656d-1,  -3.5678126d-1,  
     :0.0000000d0,   3.2333302d-1,   7.0241311d-1, 
     :-7.1356253d-1/
         data y84/
     :0.0000000d0,   7.6379893d-1,  -5.4708090d-1,  
     :6.7658314d-1,   0.0000000d0,   3.8189947d-1, 
     :-2.7354045d-1,   3.3829157d-1,  -0.0000000d0, 
     :-3.8189947d-1,   2.7354045d-1,  -3.3829157d-1, 
     :-0.0000000d0,  -7.6379893d-1,   5.4708090d-1, 
     :-6.7658314d-1,  -0.0000000d0,  -3.8189947d-1,  
     :2.7354045d-1,  -3.3829157d-1,   0.0000000d0,  
     :3.8189947d-1,  -2.7354045d-1,   3.3829157d-1,  
     :0.0000000d0,   7.6379893d-1,  -5.4708090d-1,  
     :6.7658314d-1,   0.0000000d0,   3.8189947d-1, 
     :-2.7354045d-1,   3.3829157d-1,  -0.0000000d0, 
     :-3.8189947d-1,   2.7354045d-1,  -3.3829157d-1, 
     :-0.0000000d0,  -7.6379893d-1,   5.4708090d-1, 
     :-6.7658314d-1,  -0.0000000d0,  -3.8189947d-1,  
     :2.7354045d-1,  -3.3829157d-1,   0.0000000d0,  
     :3.8189947d-1,  -2.7354045d-1,   3.3829157d-1,  
     :0.0000000d0,   7.6379893d-1,  -5.4708090d-1,  
     :6.7658314d-1/
        data y55/
     :0.0000000d0,  -2.9008263d-2,  -4.5219406d-1, 
     :-9.2826441d-1,   0.0000000d0,  -7.5078909d-3, 
     :-1.1703644d-1,  -2.4025251d-1,  -0.0000000d0,  
     :2.5121892d-2,   3.9161155d-1,   8.0390056d-1, 
     :-0.0000000d0,   2.0511939d-2,   3.1974949d-1,  
     :6.5638206d-1,   0.0000000d0,  -1.4504131d-2, 
     :-2.2609703d-1,  -4.6413220d-1,   0.0000000d0, 
     :-2.8019830d-2,  -4.3678592d-1,  -8.9663456d-1,  
     :0.0000000d0,  -8.8812191d-18,  -1.3844450d-16, 
     :-2.8419901d-16,  -0.0000000d0,   2.8019830d-2,  
     :4.3678592d-1,   8.9663456d-1,  -0.0000000d0,  
     :1.4504131d-2,   2.2609703d-1,   4.6413220d-1,  
     :0.0000000d0,  -2.0511939d-2,  -3.1974949d-1, 
     :-6.5638206d-1,   0.0000000d0,  -2.5121892d-2, 
     :-3.9161155d-1,  -8.0390056d-1,  -0.0000000d0,  
     :7.5078909d-3,   1.1703644d-1,   2.4025251d-1, 
     :-0.0000000d0,   2.9008263d-2,   4.5219406d-1,  
     :9.2826441d-1/
         data y75/
     :0.0000000d0,  -2.0066415d-1,  -8.0435429d-1,  
     :7.3385745d-1,   0.0000000d0,  -5.1935703d-2, 
     :-2.0818221d-1,   1.8993628d-1,  -0.0000000d0,  
     :1.7378025d-1,   6.9659125d-1,  -6.3553919d-1, 
     :-0.0000000d0,   1.4189098d-1,   5.6876437d-1, 
     :-5.1891558d-1,   0.0000000d0,  -1.0033207d-1, 
     :-4.0217715d-1,   3.6692872d-1,   0.0000000d0, 
     :-1.9382668d-1,  -7.7694658d-1,   7.0885186d-1,  
     :0.0000000d0,  -6.1435676d-17,  -2.4626248d-16,  
     :2.2467904d-16,  -0.0000000d0,   1.9382668d-1,  
     :7.7694658d-1,  -7.0885186d-1,  -0.0000000d0,  
     :1.0033207d-1,   4.0217715d-1,  -3.6692872d-1,  
     :0.0000000d0,  -1.4189098d-1,  -5.6876437d-1,  
     :5.1891558d-1,   0.0000000d0,  -1.7378025d-1, 
     :-6.9659125d-1,   6.3553919d-1,  -0.0000000d0,  
     :5.1935703d-2,   2.0818221d-1,  -1.8993628d-1, 
     :-0.0000000d0,   2.0066415d-1,   8.0435429d-1, 
     :-7.3385745d-1/
            data y66/
     :0.0000000d0,   1.5096379d-2,   4.0760222d-1,  
     :9.6616823d-1,   0.0000000d0,   9.2438658d-19,  
     :2.4958438d-17,   5.9160741d-17,  -0.0000000d0, 
     :-1.5096379d-2,  -4.0760222d-1,  -9.6616823d-1, 
     :-0.0000000d0,  -2.7731598d-18,  -7.4875313d-17, 
     :-1.7748222d-16,   0.0000000d0,   1.5096379d-2,  
     :4.0760222d-1,   9.6616823d-1,   0.0000000d0,  
     :4.6219329d-18,   1.2479219d-16,   2.9580371d-16, 
     :-0.0000000d0,  -1.5096379d-2,  -4.0760222d-1, 
     :-9.6616823d-1,   0.0000000d0,   2.0345849d-17,  
     :5.4933793d-16,   1.3021343d-15,   0.0000000d0,  
     :1.5096379d-2,   4.0760222d-1,   9.6616823d-1,  
     :0.0000000d0,   8.3194793d-18,   2.2462594d-16,  
     :5.3244667d-16,  -0.0000000d0,  -1.5096379d-2, 
     :-4.0760222d-1,  -9.6616823d-1,  -0.0000000d0, 
     :-3.6984808d-17,  -9.9858981d-16,  -2.3670277d-15,  
     :0.0000000d0,   1.5096379d-2,   4.0760222d-1,  
     :9.6616823d-1/
           data y86/
     :0.0000000d0,   1.2057078d-1,   8.7340300d-1, 
     :-7.5283222d-1,   0.0000000d0,   7.3828313d-18,  
     :5.3480510d-17,  -4.6097678d-17,  -0.0000000d0, 
     :-1.2057078d-1,  -8.7340300d-1,   7.5283222d-1, 
     :-0.0000000d0,  -2.2148494d-17,  -1.6044153d-16,  
     :1.3829303d-16,   0.0000000d0,   1.2057078d-1,  
     :8.7340300d-1,  -7.5283222d-1,   0.0000000d0,  
     :3.6914156d-17,   2.6740255d-16,  -2.3048839d-16, 
     :-0.0000000d0,  -1.2057078d-1,  -8.7340300d-1,  
     :7.5283222d-1,   0.0000000d0,   1.6249692d-16,  
     :1.1771118d-15,  -1.0146149d-15,   0.0000000d0,  
     :1.2057078d-1,   8.7340300d-1,  -7.5283222d-1,  
     :0.0000000d0,   6.6445482d-17,   4.8132459d-16, 
     :-4.1487910d-16,  -0.0000000d0,  -1.2057078d-1, 
     :-8.7340300d-1,   7.5283222d-1,  -0.0000000d0, 
     :-2.9538788d-16,  -2.1397610d-15,   1.8443731d-15,  
     :0.0000000d0,   1.2057078d-1,   8.7340300d-1, 
     :-7.5283222d-1/



*  determine matrix of ylm's for use in least squares fitting,  use here 
*  only up through lambda = 8. ordering is y00, y20, y40, y60, y11, 
*      y31, y51, y22, y42, y62, y33, y53, y73, y44, y64, y84,
*      y55, y75, y66, y86

      call dcopy(52,y00,1,ylm(1,1),1)
      call dcopy(52,y20,1,ylm(1,2),1)
      call dcopy(52,y40,1,ylm(1,3),1)
      call dcopy(52,y60,1,ylm(1,4),1)
      call dcopy(52,y11,1,ylm(1,5),1)
      call dcopy(52,y31,1,ylm(1,6),1)
      call dcopy(52,y51,1,ylm(1,7),1)
      call dcopy(52,y22,1,ylm(1,8),1)
      call dcopy(52,y42,1,ylm(1,9),1)
      call dcopy(52,y62,1,ylm(1,10),1)
      call dcopy(52,y33,1,ylm(1,11),1)
      call dcopy(52,y53,1,ylm(1,12),1)
      call dcopy(52,y73,1,ylm(1,13),1)
      call dcopy(52,y44,1,ylm(1,14),1)
      call dcopy(52,y64,1,ylm(1,15),1)
      call dcopy(52,y84,1,ylm(1,16),1)
      call dcopy(52,y55,1,ylm(1,17),1)
      call dcopy(52,y75,1,ylm(1,18),1)
      call dcopy(52,y66,1,ylm(1,19),1)
      call dcopy(52,y86,1,ylm(1,20),1)          


*  call subroutine spline_ch2he to get pot values at distance r      
      call spline_ch2he(vsp_jacek,r)
*
*     when r equals to 4 or 7, print out potential energies at 52 different angles
*     This is used to varify the subroutine, it can be commened out
      if (r.eq.4.OR.r.eq.7) then
         print *, 'Pot energies'
         write (6,110) (vsp_jacek(j),j=1,52)  
      endif
110      format(52(1pe16.8))
      lwork=3624
      rcond=1.d-6
      call dgelsd(52,20,1,ylm,52,vsp_jacek,52,swork,rcond,irank,work
     : ,lwork,iwork,info)
*
*  convert to atomic units and fill vlm coefficients
      tohat=1.d0/219474.6d0
*  save anisotropic terms
      call dcopy(19,vsp_jacek(2),1,vvl,1)
* at r=15.5, merge spherical potential to long-range behaviour and damp
* all the anisotropic terms 
      fact=0.5d0*(tanh((r-15.5d0))+1d0)
      s4pi = sqrt ( 4.d0 * acos(-1.d0) )
      vv0=vsp_jacek(1)*(1d0-fact)-fact*c6/r**6
      vv0=vv0*tohat/s4pi
      call dscal(19,(1d0-fact),vvl,1)
      call dscal(19,tohat,vvl,1)
      return
      end
      
* ----------------------------------------------------------------------
      subroutine spline_ch2he(vsp_jacek, r)
c  spline_ch2he.f
c  using Jacek's code to do spline_fit of pot
c  example:
c    K=57
c    call splinej(K,Rp,XX,b0,c0,d0)
c    VNO=sevalj(K, r, Rp, XX, b0,c0,d0)
c  where,
c  K  the number of points to be fitted
c  Rp, XX   orignal data, Rp & XX should have the same dimensions
c  r  new distance, where pot need to be calculated by spline-Fitchbur
c  VNO  pot at r, output
      implicit double precision (a-h,o-z)   
      integer k
      dimension b0(19,52),c0(19,52),a0(19,52),rr(19)
      dimension vsp_jacek(52)
      dimension vv(988),v(19,52),vvec(19,52)
      data rr /3.5,4,4.5,5,5.5,6,6.5,7,7.5,8,8.5,9,9.5,10,11,
     : 12,13,15,20/
      data ifirst /0/
      if (ifirst.eq.0) then
         open (unit=10,file=
     :     'potdata/ch2he_x52_v0.dat')
         read (10,*) vv
         close(10)

         do i=1,19
            do j=1,52         
              k=(i-1)*52+j
              v(i,j)=vv(k)
            enddo
         enddo          
*        print *,'in loop'
         do j=1,52
            call dcopy(19,v(1,j),1,vvec(1,j),1)
* vvec contains potentials at all 19 points (rows) for each 52 theta/phi (columns)
* determine spline coefficients for all 52 theta/phi values
            call spline(19,rr,vvec(1,j),a0(1,j),b0(1,j),c0(1,j))
         enddo
         ifirst=1
*         save ifirst
      endif
      do j=1,52
* using previously determined spline coefficients to determine potential at all 52 theta/phi values
          vsp_jacek(j)=seval(19,r,rr,vvec(1,j),a0(1,j),b0(1,j),c0(1,j))
      enddo             
         
       end   



