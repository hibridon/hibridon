* System:  CH(X 2Pi)+He
* New D. Ben Abdallah PES
* Reference: D. Ben Abdallah et al .Phys. Chem. News 12 (2003) 1-15
* REFIT OF THE CEPA DATA TO CORRECT FOR SHORT RANGE BAD
* BEHAVIOR AT 90 DEGREES
* REFIT USING RKHS BY JACEK KLOS 12/2008 Univ. of Maryland
      include "common/syusr"

      subroutine driver
      implicit double precision (a-h,o-z)
      common /covvl/ vvl(19)
      econv=219474.6d0
1      print *, ' r (bohr)'
      read (5, *, end=99) r
      call pot(vv0,r)
      if (r.le.0) goto 99
      write (6, 100) vv0,vvl
100   format(' vsum',/,5(1pe16.8),/,5e16.8,/,e16.8,/,
     :    '  vdif',/,5e16.8,/,4e16.8)
      goto 1
99    rr=3.0d0
      dr=0.1d0
      open (unit=12,file='chhe_driss_rkhs_vlms.dat')
      write(12,109)
109   format(' %R/bohr V00  ...')
      do i=1,250
        call pot(vv0,rr)
        write (12,110) rr,vv0*econv, econv*vvl
110     format(f7.2,19(1pe16.8))
        rr = rr + dr
      enddo
      close(12)
      end
      include "common/bausr"
      include "common/ground"
      subroutine loapot(iunit,filnam)
* ------------------------------------------------------------------------
      character*(*) filnam
      include "common/parbas"
      include "common/parpot"
      common /conlam/ nlam, nlammx, lamnum(1)
      potnam='D.Ben Abdallah He-CH(X) CEPA refit'
      lammin(1)=1
      lammax(1)=10
      lammin(2)=2
      lammax(2)=10
      nlam=20
      mproj(1)=0
      mproj(2)=2
      ntv(1)=1
      ivcol(1,1)=0
      ivrow(1,1)=0
      return
      end
* ----------------------------------------------------------------------
      subroutine pot ( vv0, rr)
*
*  subroutine to calculate the r-dependent coefficients in the
*  He-CH(X) potentials. deepened and shifted
*  in atomic units (distance and energy)
* ----------------------------------------------------------------------
*  on entry:
*    r:        interparticle distance (in atomic units)
*  on return:
*    vv0:      contains isotropic term (d00 term in vsum)
*  variable in common block /covvl/
*    vvl:      vector of length 19 to store r-dependence of each term
*              in potential expansion
*    vvl(1-10)  expansion coefficients in dl0 (l=1:10) of vsum
*    vvl(11-19) expansion coefficients in dl2 (l=11:19) of vdif

* uses linear least squares routines from cmlib

* author:  millard alexander
* note:    modified for he-ch by mark cybulski 7/9/96
*          slightly revised by mha 1/29/97
*          adapted for RKHS refit of CEPA 12/21/2008
* ----------------------------------------------------------------------

      implicit double precision (a-h,o-z)
      dimension xlam1(22),xlam2(22),r0(22),c1(22),c2(22),c3(22),
     :          clr(22),vsum(11),xsum(11),vdif(11),xdif(11),
     :          vap(11),va2p(11),d0(121),d2(81),aa(121)
      dimension kpvt(12),qraux(12),work(77),rsd(11), re(22)
      dimension thta(11)
      common /covvl/ vvl(19)
      data half, zero, one, alph /0.5d0, 0.d0, 1.d0, 1.2d0/
      data onemin /-1.d0/

* mark cybulski's parameters:
*     npoint is the number of points for which data are available
*     nparm is the number of parameters in the fitted function
      data nparm, npoint / 7, 11/

*
*     for distances beyond rmax difference potential is damped
*
      data rmax /20d0/
*
*     re's for ab initio potentials
*
*      coefficicients for d0 rotation matrices
*      stored (by column) for each of 11 angles and for L=0:10
*      angles are 0 20 40 60 80 90 100 120 140 160 180

      data d0/
*      L = 0
     *  1.0000000d+00,  1.0000000d+00,  1.0000000d+00,  1.0000000d+00,
     *  1.0000000d+00,  1.0000000d+00,  1.0000000d+00,  1.0000000d+00,
     *  1.0000000d+00,  1.0000000d+00,  1.0000000d+00,
*      L = 1
     *  1.0000000d+00,  9.3969262d-01,  7.6604444d-01,  5.0000000d-01,
     *  1.7364818d-01,  5.0532155d-16, -1.7364818d-01, -5.0000000d-01,
     * -7.6604444d-01, -9.3969262d-01, -1.0000000d+00,
*      L = 2
     *  1.0000000d+00,  8.2453333d-01,  3.8023613d-01, -1.2500000d-01,
     * -4.5476947d-01, -5.0000000d-01, -4.5476947d-01, -1.2500000d-01,
     *  3.8023613d-01,  8.2453333d-01,  1.0000000d+00,
*      L = 3
     *  1.0000000d+00,  6.6488473d-01, -2.5233334d-02, -4.3750000d-01,
     * -2.4738193d-01, -7.5798232d-16,  2.4738193d-01,  4.3750000d-01,
     *  2.5233334d-02, -6.6488473d-01, -1.0000000d+00,
*      L = 4
     *  1.0000000d+00,  4.7497774d-01, -3.1900435d-01, -2.8906250d-01,
     *  2.6590161d-01,  3.7500000d-01,  2.6590161d-01, -2.8906250d-01,
     * -3.1900435d-01,  4.7497774d-01,  1.0000000d+00,
*      L = 5
     *  1.0000000d+00,  2.7149175d-01, -4.1968205d-01,  8.9843750d-02,
     *  2.8101754d-01,  9.4747791d-16, -2.8101754d-01, -8.9843750d-02,
     *  4.1968205d-01, -2.7149175d-01, -1.0000000d+00,
*      L = 6
     *  1.0000000d+00,  7.1903002d-02, -3.2357073d-01,  3.2324219d-01,
     * -1.3212134d-01, -3.1250000d-01, -1.3212134d-01,  3.2324219d-01,
     * -3.2357073d-01,  7.1903002d-02,  1.0000000d+00,
*      L = 7
     *  1.0000000d+00, -1.0722616d-01, -1.0060171d-01,  2.2314453d-01,
     * -2.8347992d-01, -1.1053909d-15,  2.8347992d-01, -2.2314453d-01,
     *  1.0060171d-01,  1.0722616d-01, -1.0000000d+00,
*      L = 8
     *  1.0000000d+00, -2.5183943d-01,  1.3862680d-01, -7.3638916d-02,
     *  2.3307850d-02,  2.7343750d-01,  2.3307850d-02, -7.3638916d-02,
     *  1.3862680d-01, -2.5183943d-01,  1.0000000d+00,
*      L = 9
     *  1.0000000d+00, -3.5169654d-01,  2.9001295d-01, -2.6789856d-01,
     *  2.5962717d-01,  1.2435648d-15, -2.5962717d-01,  2.6789856d-01,
     * -2.9001295d-01,  3.5169654d-01, -1.0000000d+00,
*      L =10
     *  1.0000000d+00, -4.0126914d-01,  2.9734522d-01, -1.8822861d-01,
     *  6.4682128d-02, -2.4609375d-01,  6.4682128d-02, -1.8822861d-01,
     *  2.9734522d-01, -4.0126914d-01,  1.0000000d+00 /

*     coefficicients for d2 rotation matrices
*     stored (by column) for each of 9 angles and for L=2:10
*     angles are 20 40 60 80 90 100 120 140 160

      data d2/
*      L = 2
     *  7.1633967d-02,  2.5301754d-01,  4.5927933d-01,  5.9390715d-01,
     *  6.1237244d-01,  5.9390715d-01,  4.5927933d-01,  2.5301754d-01,
     *  7.1633967d-02,
*      L = 3
     *  1.5051848d-01,  4.3340069d-01,  5.1348990d-01,  2.3060769d-01,
     *  6.9194003d-16, -2.3060769d-01, -5.1348990d-01, -4.3340069d-01,
     * -1.5051848d-01,
*      L = 4
     *  2.3957418d-01,  5.0756736d-01,  2.2234765d-01, -3.0244624d-01,
     * -3.9528471d-01, -3.0244624d-01,  2.2234765d-01,  5.0756736d-01,
     *  2.3957418d-01,
*      L = 5
     *  3.2835759d-01,  4.3600553d-01, -1.6982082d-01, -2.7746877d-01,
     * -9.1535062d-16,  2.7746877d-01,  1.6982082d-01, -4.3600553d-01,
     * -3.2835759d-01,
*      L = 6
     *  4.0592179d-01,  2.3830028d-01, -3.4523418d-01,  1.5131756d-01,
     *  3.2021721d-01,  1.5131756d-01, -3.4523418d-01,  2.3830028d-01,
     *  4.0592179d-01,
*      L = 7
     *  4.6231022d-01, -1.3906540d-02, -1.9131358d-01,  2.8490318d-01,
     *  1.0854723d-15, -2.8490318d-01,  1.9131358d-01,  1.3906540d-02,
     * -4.6231022d-01,
*      L = 8
     *  4.8973053d-01, -2.2700359d-01,  1.1374299d-01, -3.5240961d-02,
     * -2.7731624d-01, -3.5240961d-02,  1.1374299d-01, -2.2700359d-01,
     *  4.8973053d-01,
*      L = 9
     *  4.8345441d-01, -3.2461587d-01,  2.7905801d-01, -2.6334950d-01,
     * -1.2296697d-15,  2.6334950d-01, -2.7905801d-01,  3.2461587d-01,
     * -4.8345441d-01,
*      L =10
     *  4.4236809d-01, -2.7891371d-01,  1.6870456d-01, -5.7117496d-02,
     *  2.4836194d-01, -5.7117496d-02,  1.6870456d-01, -2.7891371d-01,
     *  4.4236809d-01 /


*     determine A' and A" potentials at angles
*     first shift radius out

      r = rr + rrshift
      rm3 = one / ( r**3 )
      rm6 = rm3 * rm3
      thta(1)=0.d0
      thta(2)=20.d0
      thta(3)=40.d0
      thta(4)=60.d0
      thta(5)=80.d0
      thta(6)=90.d0
      thta(7)=100.d0
      thta(8)=120.d0
      thta(9)=140.d0
      thta(10)=160.d0
      thta(11)=180.d0


      do 100 i = 1, npoint

         vsum( i ) = vsum_2d(r,thta(i))

*        don't compute vdif for colinear geometries
         if( i .ne. 1 .and. i .ne. npoint ) then
            vdif( i - 1 ) = vdif_2d(r,thta(i))

*        for long range damp out difference potential

            if( r .gt. rmax ) then
               damp = - ( tanh( one * ( r - rmax ) ) - one )
               vdif( i - 1 ) = vdif( i - 1 ) * damp
            end if
         end if

100   continue

* solve simultaneous equations for solutions
* first for vsigma

      tol = 1.0d-10
      call dcopy( ntots, d0, 1, aa, 1 )

      call dqrank(aa,npoint,npoint,npoint,tol,kr,kpvt,qraux,work)
      call dqrlss(aa,npoint,npoint,npoint,kr,vsum,xsum,rsd,kpvt,qraux)

*     convert to hartree (potential is in cm-1)

      conv = 1.d0/219474.6d0
      call dscal( npoint, conv, xsum, 1 )
      vv0 = xsum( 1 )
      call dcopy( npoint - 1, xsum( 2 ), 1, vvl, 1 )

*     solve simultaneous equations for solutions
*     for vdif

      call dcopy( ntotd, d2, 1, aa, 1 )
      call dqrank( aa, npnt2, npnt2, npnt2, tol, kr, kpvt, qraux, work )
      call dqrlss( aa, npnt2, npnt2, npnt2, kr, vdif, xdif, rsd, kpvt,
     *             qraux )
* Vdiff is defined as 0.5(VA"-VA')
      call dscal( npnt2, conv, xdif, 1 )
      call dcopy( npnt2, xdif, 1, vvl( npoint ), 1 )
      return
      end


C PROGRAM TO GENERATE 2-D He-CH(X) VSUM DIABAT
C DISTANCE- AND PL0-Like
C REPRODUCING KERNEL HILBERT SPACE METHOD 
C BY J. KLOS 12/19/2008 UNIVERSITY OF MARYLAND
C AB INITIO:  CEPA POINTS FROM BEN ABDALLAH
C Units: bohrs, degrees and cm-1

C      PROGRAM EVALUATE
C      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
C      PARAMETER(NPT=319,ZERO=0.D0,ONE=1.D0)
C      DIMENSION RR(301)
C
C        DO I=1,301
C         RR(I)=2.5D0+0.05D0*(I-1)
C         DO J=1,91
C          ANGL=2.D0*(J-1)
C          PES=VSUM_2D(RR(I),ANGL)
C          WRITE(6,*) RR(I),ANGL,PES
C         ENDDO
C        ENDDO
C
C      END
       
      FUNCTION VSUM_2D(RR,TT)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      PARAMETER (NPT=319)
      DIMENSION VAB(NPT),VCOEF(NPT),VCOEF1(150),VCOEF2(169)
      DIMENSION R1(150),R2(169),THETA1(150),THETA2(169) 
      DIMENSION R(NPT),THETA(NPT)
      DATA R1/
     .                 3.00D0,
     .                 3.25D0,
     .                 3.50D0,
     .                 3.75D0,
     .                 4.00D0,
     .                 4.25D0,
     .                 4.50D0,
     .                 4.75D0,
     .                 5.00D0,
     .                 5.25D0,
     .                 5.50D0,
     .                 5.75D0,
     .                 6.00D0,
     .                 6.25D0,
     .                 6.50D0,
     .                 6.75D0,
     .                 7.00D0,
     .                 7.25D0,
     .                 7.50D0,
     .                 7.75D0,
     .                 8.00D0,
     .                 8.25D0,
     .                 8.50D0,
     .                 8.75D0,
     .                 9.00D0,
     .                 9.50D0,
     .                10.00D0,
     .                11.00D0,
     .                13.00D0,
     .                 3.00D0,
     .                 3.25D0,
     .                 3.50D0,
     .                 3.75D0,
     .                 4.00D0,
     .                 4.25D0,
     .                 4.50D0,
     .                 4.75D0,
     .                 5.00D0,
     .                 5.25D0,
     .                 5.50D0,
     .                 5.75D0,
     .                 6.00D0,
     .                 6.25D0,
     .                 6.50D0,
     .                 6.75D0,
     .                 7.00D0,
     .                 7.25D0,
     .                 7.50D0,
     .                 7.75D0,
     .                 8.00D0,
     .                 8.25D0,
     .                 8.50D0,
     .                 8.75D0,
     .                 9.00D0,
     .                 9.50D0,
     .                10.00D0,
     .                11.00D0,
     .                13.00D0,
     .                 3.00D0,
     .                 3.25D0,
     .                 3.50D0,
     .                 3.75D0,
     .                 4.00D0,
     .                 4.25D0,
     .                 4.50D0,
     .                 4.75D0,
     .                 5.00D0,
     .                 5.25D0,
     .                 5.50D0,
     .                 5.75D0,
     .                 6.00D0,
     .                 6.25D0,
     .                 6.50D0,
     .                 6.75D0,
     .                 7.00D0,
     .                 7.25D0,
     .                 7.50D0,
     .                 7.75D0,
     .                 8.00D0,
     .                 8.25D0,
     .                 8.50D0,
     .                 8.75D0,
     .                 9.00D0,
     .                 9.50D0,
     .                10.00D0,
     .                11.00D0,
     .                13.00D0,
     .                 3.00D0,
     .                 3.25D0,
     .                 3.50D0,
     .                 3.75D0,
     .                 4.00D0,
     .                 4.25D0,
     .                 4.50D0,
     .                 4.75D0,
     .                 5.00D0,
     .                 5.25D0,
     .                 5.50D0,
     .                 5.75D0,
     .                 6.00D0,
     .                 6.25D0,
     .                 6.50D0,
     .                 6.75D0,
     .                 7.00D0,
     .                 7.25D0,
     .                 7.50D0,
     .                 7.75D0,
     .                 8.00D0,
     .                 8.25D0,
     .                 8.50D0,
     .                 8.75D0,
     .                 9.00D0,
     .                 9.50D0,
     .                10.00D0,
     .                11.00D0,
     .                13.00D0,
     .                 3.00D0,
     .                 3.25D0,
     .                 3.50D0,
     .                 3.75D0,
     .                 4.00D0,
     .                 4.25D0,
     .                 4.50D0,
     .                 4.75D0,
     .                 5.00D0,
     .                 5.25D0,
     .                 5.50D0,
     .                 5.75D0,
     .                 6.00D0,
     .                 6.25D0,
     .                 6.50D0,
     .                 6.75D0,
     .                 7.00D0,
     .                 7.25D0,
     .                 7.50D0,
     .                 7.75D0,
     .                 8.00D0,
     .                 8.25D0,
     .                 8.50D0,
     .                 8.75D0,
     .                 9.00D0,
     .                 9.50D0,
     .                10.00D0,
     .                11.00D0,
     .                13.00D0,
     .                 3.00D0,
     .                 3.25D0,
     .                 3.50D0,
     .                 3.75D0,
     .                 4.00D0/
      DATA R2/
     .              4.25D0,
     .              4.50D0,
     .              4.75D0,
     .              5.00D0,
     .              5.25D0,
     .              5.50D0,
     .              5.75D0,
     .              6.00D0,
     .              6.25D0,
     .              6.50D0,
     .              6.75D0,
     .              7.00D0,
     .              7.25D0,
     .              7.50D0,
     .              7.75D0,
     .              8.00D0,
     .              8.25D0,
     .              8.50D0,
     .              8.75D0,
     .              9.00D0,
     .              9.50D0,
     .             10.00D0,
     .             11.00D0,
     .             13.00D0,
     .              3.00D0,
     .              3.25D0,
     .              3.50D0,
     .              3.75D0,
     .              4.00D0,
     .              4.25D0,
     .              4.50D0,
     .              4.75D0,
     .              5.00D0,
     .              5.25D0,
     .              5.50D0,
     .              5.75D0,
     .              6.00D0,
     .              6.25D0,
     .              6.50D0,
     .              6.75D0,
     .              7.00D0,
     .              7.25D0,
     .              7.50D0,
     .              7.75D0,
     .              8.00D0,
     .              8.25D0,
     .              8.50D0,
     .              8.75D0,
     .              9.00D0,
     .              9.50D0,
     .             10.00D0,
     .             11.00D0,
     .             13.00D0,
     .              3.00D0,
     .              3.25D0,
     .              3.50D0,
     .              3.75D0,
     .              4.00D0,
     .              4.25D0,
     .              4.50D0,
     .              4.75D0,
     .              5.00D0,
     .              5.25D0,
     .              5.50D0,
     .              5.75D0,
     .              6.00D0,
     .              6.25D0,
     .              6.50D0,
     .              6.75D0,
     .              7.00D0,
     .              7.25D0,
     .              7.50D0,
     .              7.75D0,
     .              8.00D0,
     .              8.25D0,
     .              8.50D0,
     .              8.75D0,
     .              9.00D0,
     .              9.50D0,
     .             10.00D0,
     .             11.00D0,
     .             13.00D0,
     .              3.00D0,
     .              3.25D0,
     .              3.50D0,
     .              3.75D0,
     .              4.00D0,
     .              4.25D0,
     .              4.50D0,
     .              4.75D0,
     .              5.00D0,
     .              5.25D0,
     .              5.50D0,
     .              5.75D0,
     .              6.00D0,
     .              6.25D0,
     .              6.50D0,
     .              6.75D0,
     .              7.00D0,
     .              7.25D0,
     .              7.50D0,
     .              7.75D0,
     .              8.00D0,
     .              8.25D0,
     .              8.50D0,
     .              8.75D0,
     .              9.00D0,
     .              9.50D0,
     .             10.00D0,
     .             11.00D0,
     .             13.00D0,
     .              3.00D0,
     .              3.25D0,
     .              3.50D0,
     .              3.75D0,
     .              4.00D0,
     .              4.25D0,
     .              4.50D0,
     .              4.75D0,
     .              5.00D0,
     .              5.25D0,
     .              5.50D0,
     .              5.75D0,
     .              6.00D0,
     .              6.25D0,
     .              6.50D0,
     .              6.75D0,
     .              7.00D0,
     .              7.25D0,
     .              7.50D0,
     .              7.75D0,
     .              8.00D0,
     .              8.25D0,
     .              8.50D0,
     .              8.75D0,
     .              9.00D0,
     .              9.50D0,
     .             10.00D0,
     .             11.00D0,
     .             13.00D0,
     .              3.00D0,
     .              3.25D0,
     .              3.50D0,
     .              3.75D0,
     .              4.00D0,
     .              4.25D0,
     .              4.50D0,
     .              4.75D0,
     .              5.00D0,
     .              5.25D0,
     .              5.50D0,
     .              5.75D0,
     .              6.00D0,
     .              6.25D0,
     .              6.50D0,
     .              6.75D0,
     .              7.00D0,
     .              7.25D0,
     .              7.50D0,
     .              7.75D0,
     .              8.00D0,
     .              8.25D0,
     .              8.50D0,
     .              8.75D0,
     .              9.00D0,
     .              9.50D0,
     .             10.00D0,
     .             11.00D0,
     .             13.00D0/

      DATA THETA1/
     .               0D0,
     .               0D0,
     .               0D0,
     .               0D0,
     .               0D0,
     .               0D0,
     .               0D0,
     .               0D0,
     .               0D0,
     .               0D0,
     .               0D0,
     .               0D0,
     .               0D0,
     .               0D0,
     .               0D0,
     .               0D0,
     .               0D0,
     .               0D0,
     .               0D0,
     .               0D0,
     .               0D0,
     .               0D0,
     .               0D0,
     .               0D0,
     .               0D0,
     .               0D0,
     .               0D0,
     .               0D0,
     .               0D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           90.00D0,
     .           90.00D0,
     .           90.00D0,
     .           90.00D0,
     .           90.00D0/
       DATA THETA2 /
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              180.00D0,
     .              180.00D0,
     .              180.00D0,
     .              180.00D0,
     .              180.00D0,
     .              180.00D0,
     .              180.00D0,
     .              180.00D0,
     .              180.00D0,
     .              180.00D0,
     .              180.00D0,
     .              180.00D0,
     .              180.00D0,
     .              180.00D0,
     .              180.00D0,
     .              180.00D0,
     .              180.00D0,
     .              180.00D0,
     .              180.00D0,
     .              180.00D0,
     .              180.00D0,
     .              180.00D0,
     .              180.00D0,
     .              180.00D0,
     .              180.00D0,
     .              180.00D0,
     .              180.00D0,
     .              180.00D0,
     .              180.00D0/
      DATA VCOEF1/
     .           928183460.3584116697311401D0, 
     .         -1479029381.8796329498291016D0,
     .           668215153.7482533454895020D0,
     .          -173022572.9908299744129181D0,
     .            91271707.1637316495180130D0,
     .           -24535980.5450572930276394D0,
     .             2826681.9911664961837232D0,
     .           -13389298.3480014223605394D0,
     .           -12358595.3567719925194979D0,
     .            -8707479.2199164088815451D0,
     .           -15060284.2407195363193750D0,
     .             3726452.8544249646365643D0,
     .           -23712233.1747662201523781D0,
     .            17668025.0798232927918434D0,
     .           -11643567.1556115336716175D0,
     .             3064192.9272769773378968D0,
     .            25161378.5944585427641869D0,
     .           -55550022.3026065379381180D0,
     .            83798317.6883450746536255D0,
     .           -71482771.1948015689849854D0,
     .            75980996.4400481432676315D0,
     .           -38078321.0919976830482483D0,
     .            17336158.3808321654796600D0,
     .           -34944531.3511429876089096D0,
     .            46353240.0724054202437401D0,
     .            -1725455.1533703017048538D0,
     .            -7537463.5799987940117717D0,
     .             9095043.7650057338178158D0,
     .            -2516354.0244242968037724D0,
     .           340261597.0186518430709839D0,
     .           142071617.0509473979473114D0,
     .          -136399481.7156175971031189D0,
     .           -22814518.0730439759790897D0,
     .           -61520420.4596839547157288D0,
     .           -61592443.6165520697832108D0,
     .           -71540570.8993432521820068D0,
     .           -76352624.6306404471397400D0,
     .           -67006066.5490339472889900D0,
     .           -71502607.6148126870393753D0,
     .           -35945470.1276352033019066D0,
     .           -71192210.6317672431468964D0,
     .            27384971.4580838009715080D0,
     .           -70934583.5256057828664780D0,
     .            43363245.4779548123478889D0,
     .            -7919956.7362082898616791D0,
     .           -38260291.9064208492636681D0,
     .           183384711.1920208632946014D0,
     .          -229153129.9034493863582611D0,
     .           363662894.9174503087997437D0,
     .          -392909817.0376781821250916D0,
     .           318870135.9204269647598267D0,
     .           -95403203.4051544666290283D0,
     .            72004226.7057757228612900D0,
     .           -33616641.8465581759810448D0,
     .             9914597.6803168207406998D0,
     .            47029585.0546461120247841D0,
     .            -8764554.9077140223234892D0,
     .             5948124.0970721803605556D0,
     .           -92407151.2450062483549118D0,
     .           343359695.9356355667114258D0,
     .          -133898799.4267705529928207D0,
     .            27306321.8182955496013165D0,
     .           -43391563.8359860852360725D0,
     .           -26106975.0501386560499668D0,
     .           -36585748.5448508635163307D0,
     .           -30417321.3831771947443485D0,
     .           -32168039.8843028657138348D0,
     .           -11784848.7422116678208113D0,
     .           -44316470.1415991112589836D0,
     .            28910351.1201596446335316D0,
     .           -60922841.4220189824700356D0,
     .            70842173.8241463601589203D0,
     .           -70686161.2154740691184998D0,
     .            70929786.7596482783555984D0,
     .            -5544551.8640188472345471D0,
     .           -51003977.2100966051220894D0,
     .           163804517.6634586751461029D0,
     .          -332935870.0217027664184570D0,
     .           518225368.8817280530929565D0,
     .          -483737063.3421561717987061D0,
     .           285011179.4382676482200623D0,
     .           -24473605.7666076943278313D0,
     .           -97766202.9445734173059464D0,
     .           127094809.6971997916698456D0,
     .           -94783154.4078412950038910D0,
     .            49162943.3793955296278000D0,
     .           -15318753.0321058128029108D0,
     .           184419861.9953895211219788D0,
     .          -545203045.4447623491287231D0,
     .           243574212.4194911420345306D0,
     .           -63611792.6094789281487465D0,
     .            42216980.5943039357662201D0,
     .             6586942.8699755752459168D0,
     .            30907993.8157477006316185D0,
     .            24930360.8959697633981705D0,
     .            30206228.4162060469388962D0,
     .            38384276.3162792995572090D0,
     .            16005837.3019332643598318D0,
     .            53699572.2602775692939758D0,
     .           -25924159.7120043188333511D0,
     .            44033096.2330452203750610D0,
     .            25737530.1343699060380459D0,
     .           -54485967.3674129098653793D0,
     .           153262087.9991568624973297D0,
     .          -368329612.5440742373466492D0,
     .           475180514.6417367458343506D0,
     .          -454194549.2277655601501465D0,
     .           362154677.4213625788688660D0,
     .          -270942910.4674361348152161D0,
     .           209753910.0715611875057220D0,
     .          -388767351.2647587060928345D0,
     .           384833242.3828699588775635D0,
     .          -215970685.3044001162052155D0,
     .            87903085.5500250607728958D0,
     .           -42507970.0855520218610764D0,
     .            15550454.7532663494348526D0,
     .          -808097659.4139432907104492D0,
     .          1319153003.5224337577819824D0,
     .          -660996343.7794246673583984D0,
     .           146266235.8340071737766266D0,
     .           -92340314.3802459388971329D0,
     .            29039907.9656406864523888D0,
     .             4720978.7200003322213888D0,
     .            24456487.3309829719364643D0,
     .            42453644.4836842119693756D0,
     .           -39123771.8865213170647621D0,
     .           133793529.5678217113018036D0,
     .          -179316682.1001477539539337D0,
     .           360401607.6907349228858948D0,
     .          -380540532.1333428621292114D0,
     .           185026268.3690026700496674D0,
     .           126904350.5982129722833633D0,
     .          -664826303.2905832529067993D0,
     .          1389309059.1710796356201172D0,
     .         -1760190683.7374646663665771D0,
     .          1568466127.2919833660125732D0,
     .         -1256056472.0153791904449463D0,
     .           686328803.2844855785369873D0,
     .          -193267506.6062500476837158D0,
     .           314995829.1121688485145569D0,
     .          -343504410.8858994841575623D0,
     .          -117125313.4587754011154175D0,
     .           269228427.9894619584083557D0,
     .          -141389161.4581453800201416D0,
     .            40941198.3784747049212456D0,
     .           682630569.1873698234558105D0,
     .         -1318293737.5220386981964111D0,
     .           646385281.3334774971008301D0,
     .          -146584977.9257560074329376D0,
     .           101751615.5360030680894852D0/
         DATA VCOEF2/               
     .           -6635522.4074257193133235D0,
     .           19023085.1180420666933060D0,
     .           12387188.1929713655263186D0,
     .          -13229091.2296892423182726D0,
     .           83259747.1185591220855713D0,
     .         -140698198.4971530735492706D0,
     .          292555438.0878685712814331D0,
     .         -579286708.4719734191894531D0,
     .          733062775.3155843019485474D0,
     .         -449545775.9708054065704346D0,
     .          -99186173.1279789656400681D0,
     .          954822386.8368710279464722D0,
     .        -2064080923.4916172027587891D0,
     .         2546009621.8027482032775879D0,
     .        -2088631237.8299479484558105D0,
     .         1301919923.1205024719238281D0,
     .         -338778225.2320163249969482D0,
     .         -340886181.4237085580825806D0,
     .          -56804799.8984061852097511D0,
     .          414289875.6203835606575012D0,
     .          -31194380.2409434355795383D0,
     .         -222314045.2267606258392334D0,
     .          151411081.6235977113246918D0,
     .          -58466586.0241260901093483D0,
     .         -333748145.4450973868370056D0,
     .          544468133.1953130960464478D0,
     .         -265414580.8389937579631805D0,
     .           75631829.8067075759172440D0,
     .          -28455465.5267898105084896D0,
     .           18753403.2100991718471050D0,
     .            4800357.8821724038571119D0,
     .            3625289.1347718778997660D0,
     .           15425137.5926457159221172D0,
     .          -43134302.5131840854883194D0,
     .           85938746.7435682266950607D0,
     .         -176152217.8100932240486145D0,
     .          358122119.0301772356033325D0,
     .         -488295499.7205993533134460D0,
     .          306696922.3107843995094299D0,
     .           82324971.1926651597023010D0,
     .         -645766386.4559451341629028D0,
     .         1237231484.2698302268981934D0,
     .        -1396545155.2834889888763428D0,
     .         1001383498.1834464073181152D0,
     .         -593598396.4314601421356201D0,
     .          277396693.6485590338706970D0,
     .         -136189683.5930345058441162D0,
     .          500658580.4271361231803894D0,
     .         -683129993.2521555423736572D0,
     .          408419817.0738099813461304D0,
     .         -142184177.9989885091781616D0,
     .           -4676858.9385917885228992D0,
     .           23585775.3629979752004147D0,
     .           58102874.8472995311021805D0,
     .          -89605670.3176800906658173D0,
     .           96725534.2445577532052994D0,
     .             929876.1902768258005381D0,
     .           12646527.2578035425394773D0,
     .           -5365691.4932485828176141D0,
     .          -12049303.2524896413087845D0,
     .          -11950190.9158262256532907D0,
     .          -25285271.9163310825824738D0,
     .           -1298363.1493749574292451D0,
     .          -34949336.2232742458581924D0,
     .            8519602.7837151959538460D0,
     .          -52367359.1395201310515404D0,
     .           20161079.9069141037762165D0,
     .           70016538.2315677106380463D0,
     .         -294835889.9881150722503662D0,
     .          499582978.7742246389389038D0,
     .         -512034967.8078836202621460D0,
     .          225877054.9410076439380646D0,
     .          213912398.2106091678142548D0,
     .         -417439013.5230391621589661D0,
     .          295935222.9088557362556458D0,
     .          -10463735.1780369840562344D0,
     .         -249497972.3844749629497528D0,
     .          290334686.9935848116874695D0,
     .         -131542482.7594056427478790D0,
     .           40317567.5895135626196861D0,
     .           24782581.2501434199512005D0,
     .          -19871790.6610407978296280D0,
     .           -5789748.2316305031999946D0,
     .          241121808.6375057697296143D0,
     .          -99660500.3184252828359604D0,
     .           11092879.3025540951639414D0,
     .          -35561129.7698388770222664D0,
     .          -19883833.4369605742394924D0,
     .          -33180013.9290431477129459D0,
     .          -24096119.6624339334666729D0,
     .          -28107276.9795194566249847D0,
     .          -21755837.1063129678368568D0,
     .          -28930695.3053462207317352D0,
     .            -848487.2520778427133337D0,
     .          -46163919.4548812806606293D0,
     .           46662233.1322811841964722D0,
     .          -78078719.3743837475776672D0,
     .           98311928.1146602779626846D0,
     .         -133082951.7172477543354034D0,
     .          134211395.9406949430704117D0,
     .            1503440.0894908788613975D0,
     .         -181755780.4576238393783569D0,
     .          318781696.7533062100410461D0,
     .         -251515685.6335471570491791D0,
     .          141035755.2229252755641937D0,
     .          -98195765.4037495106458664D0,
     .           98722135.0783896148204803D0,
     .          -53137899.4836884811520576D0,
     .           62046121.8853335306048393D0,
     .          -31038032.5010131262242794D0,
     .           21154938.9190261512994766D0,
     .          341895564.9633393287658691D0,
     .         -370769670.0974586606025696D0,
     .          127539648.1911807358264923D0,
     .          -55369951.5732775554060936D0,
     .            7389531.3577453428879380D0,
     .          -20495400.5061847604811192D0,
     .           -9623224.1842109709978104D0,
     .          -18572662.4276907779276371D0,
     .          -12040309.3247041068971157D0,
     .          -16631514.2410016693174839D0,
     .           -6381487.9361723959445953D0,
     .          -17885778.2171212993562222D0,
     .           20541676.6525670029222965D0,
     .          -40711585.8915032595396042D0,
     .            4880519.0413829553872347D0,
     .           73829802.2304031103849411D0,
     .         -153332414.4068827331066132D0,
     .          183145629.6965818405151367D0,
     .          -99468617.5274626314640045D0,
     .          -53059614.5626049265265465D0,
     .          226778349.1750307083129883D0,
     .         -281627574.8421632647514343D0,
     .          233853449.8831947147846222D0,
     .          -69777961.2963993400335312D0,
     .          -55248625.3572549596428871D0,
     .           91353093.5468294769525528D0,
     .          -43656164.3995729312300682D0,
     .           12062420.5208421777933836D0,
     .            2587843.8799509662203491D0,
     .           31186515.0258118808269501D0,
     .          -21192307.6532731838524342D0,
     .            2380790.1877848035655916D0,
     .           -4592109.0306805139407516D0,
     .           -1234338.3535875524394214D0,
     .           -2547023.6115622972138226D0,
     .           -1961284.1523041860200465D0,
     .           -2098114.9805773813277483D0,
     .           -1982543.7659499901346862D0,
     .           -1105499.6296304073184729D0,
     .           -1352172.4983313144184649D0,
     .           -1593891.7082084161229432D0,
     .           -6928903.4057881701737642D0,
     .           14195851.8564592469483614D0,
     .           -5053344.4312657834962010D0,
     .          -23852727.9705751538276672D0,
     .           61453342.9058720543980598D0,
     .          -81778178.1690335422754288D0,
     .           55119658.7931183353066444D0,
     .           18717932.5457333736121655D0,
     .          -80264651.0346212387084961D0,
     .           86385086.6662817746400833D0,
     .          -48331468.0124092847108841D0,
     .           -1485236.8888571518473327D0,
     .           38811896.1084526926279068D0,
     .          -40956597.9602262750267982D0,
     .           21385737.4330927170813084D0,
     .            1267804.2397945399861783D0,
     .           -4971204.9423857750371099D0/
         
C Kernel parameters
      N1=2
      M=5
      N2=10
      M2=0
C
      DO I=1,NPT 
C 150 size of the first R array or Theta or Coef
      IF (I.LE.150) THEN 
       VCOEF(I)=VCOEF1(I)
       R(I)=R1(I)
       THETA(I)=THETA1(I)
      ELSE
       VCOEF(I)=VCOEF2(I-150)
       R(I)=R2(I-150)
       THETA(I)=THETA2(I-150)
      ENDIF
      ENDDO
      PI=DACOS(-1.D0)
      FACT=PI/180.D0
C      EVALUATE PES    
       SUMA=ZERO
       XTT=DCOS(TT*FACT)
       DO I=1,NPT
        TI=DCOS(THETA(I)*FACT)
        SUMA=SUMA+VCOEF(I)*RKHS_DK(R(I),RR,N1,M)*RKHS_OP(TI,XTT,N2,M2)
       END DO
       VSUM_2D=SUMA
       RETURN
       END


C------RKHS ROUTINES

C------------------------RKHS---------------------------------
C Fortran  Deck with distance-like and angular-like 
C kernels for RKHS interpolation method
C****************************************************
C* By J. KLOS  12/05/2007   University of Maryland  *
C* REVISON: 1.0                                     * 
C* jasztol@gmail.com                                *
C****************************************************
C-------------------------------------------------------------
C FUNCTIONS:
C
C RKHS_DK(X,Y,N,M): Reproducing kernel for  distance-like (DK) 
C                   variables, see Ho, Rabitz Eq(17) of
C                   J. Chem. Phys. 104, 2584 (1996) 
C                   Range = [0, inf]
C
C  INPUT: X,Y-DOUBLE PRECISION
C          N:INTEGER:ORDER OF SMOOTHNESS OF THE FUNCTION
C          M>=0:INTEGER:RECIPROCAL POWER OF THE WEIGHT W(X)=X**(-M)
C  OUTPUT: DOUBLE PRECISION
C -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -            
C RKHS_AK(X,Y,N): Reproducing kernel for  angular-like (AK) 
C                   variables, see Ho, Rabitz Eq(23) of
C                   J. Chem. Phys. 104, 2584 (1996) 
C                    Range = [0, 1]
C    
C  INPUT: X,Y-DOUBLE PRECISION
C          N:INTEGER:ORDER OF SMOOTHNESS OF THE FUNCTION
C  OUPUT: DOUBLE PRECISION
C  HINT: SCALE ANGLES TO [0,1] INTEGRAL FOR ANGLES, FOR EXAMPLE: 
C          X=(1.d0-cosd(ANGLE))/2.d0
C -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -
C RKHS_OP(X,Y,N,M):Reproducing kernel for angular like 
C                    variables with a use of orthogonal 
C                    polynomials Plm(L,M,X) where X is 
C                    K=SUM_L=M^N PLM(X)PLM(X')
C                    variable transformed from angles as
C                    x=cos(theta)
C-------------------------------------------------------------
       DOUBLE PRECISION FUNCTION RKHS_DK(X,Y,N,M)
       IMPLICIT DOUBLE PRECISION (A-H,O-Z)
       IF (X .LT. Y) THEN
           XB=X
           XU=Y
       ELSE
           XB=Y
           XU=X
       ENDIF

C       M=ABS(M)! FORCE M>=0
       NSQR=N*N
       XUPOWM=XU**(-(M+1))

C      TERM WITH BETA FUNCTION
       CALL BETA(DFLOAT(M+1),DFLOAT(N),BETATERM)

C      GET TERM WITH 2F1 HYPERGEOMETRIC  GAUSS FUNCTION
       CALL HYGFX(DFLOAT(-N+1),DFLOAT(M+1),DFLOAT(N+M+1),XB/XU,HF)
       RKHS_DK=NSQR*XUPOWM*BETATERM*HF
       RETURN
       END

C-------------------------------------------------------------
       DOUBLE PRECISION FUNCTION RKHS_EXPR(X,Y,XE,N)
       IMPLICIT DOUBLE PRECISION (A-H,O-Z)
       PARAMETER (ZERO=0.D0,ONE=1.D0)
       
       SUMA=ZERO
       Z1=(X-XE)/XE
       Z2=(Y-XE)/XE
       DO I=0,N
       SUMA=SUMA+(Z1**I)*(Z2**I)
       ENDDO

       RKHS_EXPR=SUMA
       RETURN
       END


C-------------------------------------------------------------
       DOUBLE PRECISION FUNCTION RKHS_AK(X,Y,N)
       IMPLICIT DOUBLE PRECISION (A-H,O-Z)
       PARAMETER (ZERO=0.D0,ONE=1.D0)
       
       IF ((X.EQ.ZERO).OR.(Y.EQ.ZERO)) THEN
          RKHS_AK=ONE
          RETURN
       ENDIF
       IF (X .LT. Y) THEN
           XB=X
           XU=Y
       ELSE
           XB=Y
           XU=X
       ENDIF

       SUMA=ZERO
C      GET POLYNOMIAL TERM
       DO I=0,N-1
       SUMA=SUMA+(XU**I)*(XB**I)
       END DO

C      GET TERM WITH 2F1 HYPERGEOMETRIC  GAUSS FUNCTION
       CALL HYGFX(DFLOAT(1),DFLOAT(-N+1),DFLOAT(N+1),XB/XU,HF)
       
       RKHS_AK=SUMA+N*(XB**N)*(XU**(N-1))*HF
       RETURN
       END

       DOUBLE PRECISION FUNCTION RKHS_OP(X,Y,N,M)
       IMPLICIT DOUBLE PRECISION (A-H,O-Z)
       PARAMETER (ZERO=0.D0,ONE=1.D0)

       SUMA=ZERO
C      GET ORTHOGONAL POLYNOMIAL TERM
       DO I=ABS(M),N
       SUMA=SUMA+PLGNDR(I,M,X)*PLGNDR(I,M,Y)
       END DO
       RKHS_OP=SUMA
       RETURN
       END

       DOUBLE PRECISION FUNCTION RKHS_OP2L(X,Y,N,M)
       IMPLICIT DOUBLE PRECISION (A-H,O-Z)
       PARAMETER (ZERO=0.D0,ONE=1.D0)
 
       SUMA=ZERO
C      GET ORTHOGONAL POLYNOMIAL TERM
       DO I=ABS(M),N,2
       SUMA=SUMA+PLGNDR(I,M,X)*PLGNDR(I,M,Y)
       END DO
       RKHS_OP2L=SUMA
       RETURN
       END


            


      FUNCTION PLGNDR(L,M,x)
      IMPLICIT DOUBLE PRECISION (A-H, O-Z)
      if(m.lt.0.or.m.gt.l.or.abs(x).gt.1.)pause
     *'bad arguments in plgndr'
      pmm=1.
      if(m.gt.0) then
        somx2=dsqrt((1.-x)*(1.+x))
        fact=1.
        do 11 i=1,m
          pmm=-pmm*fact*somx2
          fact=fact+2.
11      continue
      endif
      if(l.eq.m) then
        plgndr=pmm
      else
        pmmp1=x*(2*m+1)*pmm
        if(l.eq.m+1) then
          plgndr=pmmp1
        else
         do 12 ll=m+2,l
            pll=(x*(2*ll-1)*pmmp1-(ll+m-1)*pmm)/(ll-m)
            pmm=pmmp1
            pmmp1=pll
12        continue
          plgndr=pll
        endif
      endif
      return
      END



        SUBROUTINE BETA(P,Q,BT)
C
C       ==========================================
C       Purpose: Compute the beta function B(p,q)
C       Input :  p  --- Parameter  ( p > 0 )
C                q  --- Parameter  ( q > 0 )
C       Output:  BT --- B(p,q)
C       Routine called: GAMMA for computing Ã¢(x)
C       ==========================================
C
        IMPLICIT DOUBLE PRECISION (A-H,O-Z)
        CALL GAMMA(P,GP)
        CALL GAMMA(Q,GQ)
        PPQ=P+Q
        CALL GAMMA(PPQ,GPQ)
        BT=GP*GQ/GPQ
        RETURN
        END


        SUBROUTINE GAMMA(X,GA)
C
C       ==================================================
C       Purpose: Compute gamma function (x)
C       Input :  x  --- Argument of ( x )
C                       ( x is not equal to 0,-1,-2,...)
C       Output:  GA --- (x)
C       ==================================================
C
        IMPLICIT DOUBLE PRECISION (A-H,O-Z)
        DIMENSION G(26)
        PI=3.141592653589793D0
        IF (X.EQ.INT(X)) THEN
           IF (X.GT.0.0D0) THEN
              GA=1.0D0
              M1=X-1
              DO 10 K=2,M1
10               GA=GA*K
           ELSE
              GA=1.0D+300
           ENDIF
        ELSE
           IF (DABS(X).GT.1.0D0) THEN
              Z=DABS(X)
              M=INT(Z)
              R=1.0D0
              DO 15 K=1,M
15               R=R*(Z-K)
              Z=Z-M
           ELSE
              Z=X
           ENDIF
           DATA G/1.0D0,0.5772156649015329D0,
     &          -0.6558780715202538D0, -0.420026350340952D-1,
     &          0.1665386113822915D0,-.421977345555443D-1,
     &          -.96219715278770D-2, .72189432466630D-2,
     &          -.11651675918591D-2, -.2152416741149D-3,
     &          .1280502823882D-3, -.201348547807D-4,
     &          -.12504934821D-5, .11330272320D-5,
     &          -.2056338417D-6, .61160950D-8,
     &          .50020075D-8, -.11812746D-8,
     &          .1043427D-9, .77823D-11,
     &          -.36968D-11, .51D-12,
     &          -.206D-13, -.54D-14, .14D-14, .1D-15/
           GR=G(26)
           DO 20 K=25,1,-1
20            GR=GR*Z+G(K)
           GA=1.0D0/(GR*Z)
           IF (DABS(X).GT.1.0D0) THEN
              GA=GA*R
              IF (X.LT.0.0D0) GA=-PI/(X*GA*DSIN(PI*X))
           ENDIF
        ENDIF
        RETURN
        END



        SUBROUTINE HYGFX(A,B,C,X,HF)
C
C       ====================================================
C       Purpose: Compute hypergeometric function F(a,b,c,x)
C       Input :  a --- Parameter
C                b --- Parameter
C                c --- Parameter, c <> 0,-1,-2,...
C                x --- Argument   ( x < 1 )
C       Output:  HF --- F(a,b,c,x)
C       Routines called:
C            (1) GAMMA for computing gamma function
C            (2) PSI_AAA for computing psi function
C       ====================================================
C
        IMPLICIT DOUBLE PRECISION (A-H,O-Z)
        LOGICAL L0,L1,L2,L3,L4,L5
        PI=3.141592653589793D0
        EL=.5772156649015329D0
        L0=C.EQ.INT(C).AND.C.LT.0.0
        L1=1.0D0-X.LT.1.0D-15.AND.C-A-B.LE.0.0
        L2=A.EQ.INT(A).AND.A.LT.0.0
        L3=B.EQ.INT(B).AND.B.LT.0.0
        L4=C-A.EQ.INT(C-A).AND.C-A.LE.0.0
        L5=C-B.EQ.INT(C-B).AND.C-B.LE.0.0
        IF (L0.OR.L1) THEN
           WRITE(*,*)'The hypergeometric series is divergent'
           RETURN
        ENDIF
        EPS=1.0D-15
        IF (X.GT.0.95) EPS=1.0D-8
        IF (X.EQ.0.0.OR.A.EQ.0.0.OR.B.EQ.0.0) THEN
           HF=1.0D0
           RETURN
        ELSE IF (1.0D0-X.EQ.EPS.AND.C-A-B.GT.0.0) THEN
           CALL GAMMA(C,GC)
           CALL GAMMA(C-A-B,GCAB)
           CALL GAMMA(C-A,GCA)
           CALL GAMMA(C-B,GCB)
           HF=GC*GCAB/(GCA*GCB)
           RETURN
        ELSE IF (1.0D0+X.LE.EPS.AND.DABS(C-A+B-1.0).LE.EPS) THEN
           G0=DSQRT(PI)*2.0D0**(-A)
           CALL GAMMA(C,G1)
           CALL GAMMA(1.0D0+A/2.0-B,G2)
           CALL GAMMA(0.5D0+0.5*A,G3)
           HF=G0*G1/(G2*G3)
           RETURN
        ELSE IF (L2.OR.L3) THEN
           IF (L2) NM=INT(ABS(A))
           IF (L3) NM=INT(ABS(B))
           HF=1.0D0
           R=1.0D0
           DO 10 K=1,NM
              R=R*(A+K-1.0D0)*(B+K-1.0D0)/(K*(C+K-1.0D0))*X
10            HF=HF+R
           RETURN
        ELSE IF (L4.OR.L5) THEN
           IF (L4) NM=INT(ABS(C-A))
           IF (L5) NM=INT(ABS(C-B))
           HF=1.0D0
           R=1.0D0
           DO 15 K=1,NM
              R=R*(C-A+K-1.0D0)*(C-B+K-1.0D0)/(K*(C+K-1.0D0))*X
15            HF=HF+R
           HF=(1.0D0-X)**(C-A-B)*HF
           RETURN
        ENDIF
        AA=A
        BB=B
        X1=X
        IF (X.LT.0.0D0) THEN
           X=X/(X-1.0D0)
           IF (C.GT.A.AND.B.LT.A.AND.B.GT.0.0) THEN
              A=BB
              B=AA
           ENDIF
           B=C-B
        ENDIF
        IF (X.GE.0.75D0) THEN
           GM=0.0D0
           IF (DABS(C-A-B-INT(C-A-B)).LT.1.0D-15) THEN
              M=INT(C-A-B)
              CALL GAMMA(A,GA)
              CALL GAMMA(B,GB)
              CALL GAMMA(C,GC)
              CALL GAMMA(A+M,GAM)
              CALL GAMMA(B+M,GBM)
              CALL PSI_AAA(A,PA)
              CALL PSI_AAA(B,PB)
              IF (M.NE.0) GM=1.0D0
              DO 30 J=1,ABS(M)-1
30               GM=GM*J
              RM=1.0D0
              DO 35 J=1,ABS(M)
35               RM=RM*J
              F0=1.0D0
              R0=1.0D0
              R1=1.0D0
              SP0=0.D0
              SP=0.0D0
              IF (M.GE.0) THEN
                 C0=GM*GC/(GAM*GBM)
                 C1=-GC*(X-1.0D0)**M/(GA*GB*RM)
                 DO 40 K=1,M-1
                    R0=R0*(A+K-1.0D0)*(B+K-1.0)/(K*(K-M))*(1.0-X)
40                  F0=F0+R0
                 DO 45 K=1,M
45                  SP0=SP0+1.0D0/(A+K-1.0)+1.0/(B+K-1.0)-1.0/K
                 F1=PA+PB+SP0+2.0D0*EL+DLOG(1.0D0-X)
                 DO 55 K=1,250
                    SP=SP+(1.0D0-A)/(K*(A+K-1.0))+(1.0-B)/(K*(B+K-1.0))
                    SM=0.0D0
                    DO 50 J=1,M
50                     SM=SM+(1.0D0-A)/((J+K)*(A+J+K-1.0))+1.0/
     &                    (B+J+K-1.0)
                    RP=PA+PB+2.0D0*EL+SP+SM+DLOG(1.0D0-X)
                    R1=R1*(A+M+K-1.0D0)*(B+M+K-1.0)/(K*(M+K))*(1.0-X)
                    F1=F1+R1*RP
                    IF (DABS(F1-HW).LT.DABS(F1)*EPS) GO TO 60
55                  HW=F1
60               HF=F0*C0+F1*C1
              ELSE IF (M.LT.0) THEN
                 M=-M
                 C0=GM*GC/(GA*GB*(1.0D0-X)**M)
                 C1=-(-1)**M*GC/(GAM*GBM*RM)
                 DO 65 K=1,M-1
                    R0=R0*(A-M+K-1.0D0)*(B-M+K-1.0)/(K*(K-M))*(1.0-X)
65                  F0=F0+R0
                 DO 70 K=1,M
70                  SP0=SP0+1.0D0/K
                 F1=PA+PB-SP0+2.0D0*EL+DLOG(1.0D0-X)
                 DO 80 K=1,250
                    SP=SP+(1.0D0-A)/(K*(A+K-1.0))+(1.0-B)/(K*(B+K-1.0))
                    SM=0.0D0
                    DO 75 J=1,M
75                     SM=SM+1.0D0/(J+K)
                    RP=PA+PB+2.0D0*EL+SP-SM+DLOG(1.0D0-X)
                    R1=R1*(A+K-1.0D0)*(B+K-1.0)/(K*(M+K))*(1.0-X)
                    F1=F1+R1*RP
                    IF (DABS(F1-HW).LT.DABS(F1)*EPS) GO TO 85
80                  HW=F1
85               HF=F0*C0+F1*C1
              ENDIF
           ELSE
              CALL GAMMA(A,GA)
              CALL GAMMA(B,GB)
              CALL GAMMA(C,GC)
              CALL GAMMA(C-A,GCA)
              CALL GAMMA(C-B,GCB)
              CALL GAMMA(C-A-B,GCAB)
              CALL GAMMA(A+B-C,GABC)
              C0=GC*GCAB/(GCA*GCB)
              C1=GC*GABC/(GA*GB)*(1.0D0-X)**(C-A-B)
              HF=0.0D0
              R0=C0
              R1=C1
              DO 90 K=1,250
                 R0=R0*(A+K-1.0D0)*(B+K-1.0)/(K*(A+B-C+K))*(1.0-X)
                 R1=R1*(C-A+K-1.0D0)*(C-B+K-1.0)/(K*(C-A-B+K))
     &              *(1.0-X)
                 HF=HF+R0+R1
                 IF (DABS(HF-HW).LT.DABS(HF)*EPS) GO TO 95
90               HW=HF
95            HF=HF+C0+C1
           ENDIF
        ELSE
           A0=1.0D0
           IF (C.GT.A.AND.C.LT.2.0D0*A.AND.
     &         C.GT.B.AND.C.LT.2.0D0*B) THEN
              A0=(1.0D0-X)**(C-A-B)
              A=C-A
              B=C-B
           ENDIF
           HF=1.0D0
           R=1.0D0
           DO 100 K=1,250
              R=R*(A+K-1.0D0)*(B+K-1.0D0)/(K*(C+K-1.0D0))*X
              HF=HF+R
              IF (DABS(HF-HW).LE.DABS(HF)*EPS) GO TO 105
100           HW=HF
105        HF=A0*HF
        ENDIF
        IF (X1.LT.0.0D0) THEN
           X=X1
           C0=1.0D0/(1.0D0-X)**AA
           HF=C0*HF
        ENDIF
        A=AA
        B=BB
        IF (K.GT.120) WRITE(*,115)
115     FORMAT(1X,'Warning! You should check the accuracy')
        RETURN
        END



        SUBROUTINE PSI_AAA(X,PS)
C
C       ======================================
C       Purpose: Compute Psi function
C       Input :  x  --- Argument of psi(x)
C       Output:  PS --- psi(x)
C       ======================================
C
        IMPLICIT DOUBLE PRECISION (A-H,O-Z)
        XA=DABS(X)
        PI=3.141592653589793D0
        EL=.5772156649015329D0
        S=0.0D0
        IF (X.EQ.INT(X).AND.X.LE.0.0) THEN
           PS=1.0D+300
           RETURN
        ELSE IF (XA.EQ.INT(XA)) THEN
           N=XA
           DO 10 K=1 ,N-1
10            S=S+1.0D0/K
           PS=-EL+S
        ELSE IF (XA+.5.EQ.INT(XA+.5)) THEN
           N=XA-.5
           DO 20 K=1,N
20            S=S+1.0/(2.0D0*K-1.0D0)
           PS=-EL+2.0D0*S-1.386294361119891D0
        ELSE
           IF (XA.LT.10.0) THEN
              N=10-INT(XA)
              DO 30 K=0,N-1
30               S=S+1.0D0/(XA+K)
              XA=XA+N
           ENDIF
           X2=1.0D0/(XA*XA)
           A1=-.8333333333333D-01
           A2=.83333333333333333D-02
           A3=-.39682539682539683D-02
           A4=.41666666666666667D-02
           A5=-.75757575757575758D-02
           A6=.21092796092796093D-01
           A7=-.83333333333333333D-01
           A8=.4432598039215686D0
           PS=DLOG(XA)-.5D0/XA+X2*(((((((A8*X2+A7)*X2+
     &        A6)*X2+A5)*X2+A4)*X2+A3)*X2+A2)*X2+A1)
           PS=PS-S
        ENDIF
        IF (X.LT.0.0) PS=PS-PI*DCOS(PI*X)/DSIN(PI*X)-1.0D0/X
        RETURN
        END
C--------------VDIF ROUTINE--------------------

C PROGRAM TO GENERATE 2-D He-CH(X) VDIF DIABAT
C VDIF=1/2*(A"-A')
C DISTANCE- AND PL2-Like
C REPRODUCING KERNEL HILBERT SPACE METHOD 
C BY J. KLOS 12/19/2008 UNIVERSITY OF MARYLAND
C AB INITIO:  CEPA POINTS FROM BEN ABDALLAH
C Units: bohrs, degrees and cm-1

C      PROGRAM EVALUATE
C      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
C      PARAMETER(NPT=261,ZERO=0.D0,ONE=1.D0)
C      DIMENSION RR(301)
C
C        DO I=1,301
C         RR(I)=2.5D0+0.05D0*(I-1)
C         DO J=1,91
C          ANGL=2.D0*(J-1)
C          PES=VDIF_2D(RR(I),ANGL)
C          WRITE(6,*) RR(I),ANGL,PES
C         ENDDO
C        ENDDO
C
C      END

      FUNCTION VDIF_2D(RR,TT)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      PARAMETER (NPT=261)
      DIMENSION VAB(NPT),VCOEF(NPT),VCOEF1(121),VCOEF2(140)
      DIMENSION R1(121),R2(140),THETA1(121),THETA2(140) 
      DIMENSION R(NPT),THETA(NPT)
      DATA R1/
     .                 3.00D0,
     .                 3.25D0,
     .                 3.50D0,
     .                 3.75D0,
     .                 4.00D0,
     .                 4.25D0,
     .                 4.50D0,
     .                 4.75D0,
     .                 5.00D0,
     .                 5.25D0,
     .                 5.50D0,
     .                 5.75D0,
     .                 6.00D0,
     .                 6.25D0,
     .                 6.50D0,
     .                 6.75D0,
     .                 7.00D0,
     .                 7.25D0,
     .                 7.50D0,
     .                 7.75D0,
     .                 8.00D0,
     .                 8.25D0,
     .                 8.50D0,
     .                 8.75D0,
     .                 9.00D0,
     .                 9.50D0,
     .                10.00D0,
     .                11.00D0,
     .                13.00D0,
     .                 3.00D0,
     .                 3.25D0,
     .                 3.50D0,
     .                 3.75D0,
     .                 4.00D0,
     .                 4.25D0,
     .                 4.50D0,
     .                 4.75D0,
     .                 5.00D0,
     .                 5.25D0,
     .                 5.50D0,
     .                 5.75D0,
     .                 6.00D0,
     .                 6.25D0,
     .                 6.50D0,
     .                 6.75D0,
     .                 7.00D0,
     .                 7.25D0,
     .                 7.50D0,
     .                 7.75D0,
     .                 8.00D0,
     .                 8.25D0,
     .                 8.50D0,
     .                 8.75D0,
     .                 9.00D0,
     .                 9.50D0,
     .                10.00D0,
     .                11.00D0,
     .                13.00D0,
     .                 3.00D0,
     .                 3.25D0,
     .                 3.50D0,
     .                 3.75D0,
     .                 4.00D0,
     .                 4.25D0,
     .                 4.50D0,
     .                 4.75D0,
     .                 5.00D0,
     .                 5.25D0,
     .                 5.50D0,
     .                 5.75D0,
     .                 6.00D0,
     .                 6.25D0,
     .                 6.50D0,
     .                 6.75D0,
     .                 7.00D0,
     .                 7.25D0,
     .                 7.50D0,
     .                 7.75D0,
     .                 8.00D0,
     .                 8.25D0,
     .                 8.50D0,
     .                 8.75D0,
     .                 9.00D0,
     .                 9.50D0,
     .                10.00D0,
     .                11.00D0,
     .                13.00D0,
     .                 3.00D0,
     .                 3.25D0,
     .                 3.50D0,
     .                 3.75D0,
     .                 4.00D0,
     .                 4.25D0,
     .                 4.50D0,
     .                 4.75D0,
     .                 5.00D0,
     .                 5.25D0,
     .                 5.50D0,
     .                 5.75D0,
     .                 6.00D0,
     .                 6.25D0,
     .                 6.50D0,
     .                 6.75D0,
     .                 7.00D0,
     .                 7.25D0,
     .                 7.50D0,
     .                 7.75D0,
     .                 8.00D0,
     .                 8.25D0,
     .                 8.50D0,
     .                 8.75D0,
     .                 9.00D0,
     .                 9.50D0,
     .                10.00D0,
     .                11.00D0,
     .                13.00D0,
     .                 3.00D0,
     .                 3.25D0,
     .                 3.50D0,
     .                 3.75D0,
     .                 4.00D0/
      DATA R2/
     .              4.25D0,
     .              4.50D0,
     .              4.75D0,
     .              5.00D0,
     .              5.25D0,
     .              5.50D0,
     .              5.75D0,
     .              6.00D0,
     .              6.25D0,
     .              6.50D0,
     .              6.75D0,
     .              7.00D0,
     .              7.25D0,
     .              7.50D0,
     .              7.75D0,
     .              8.00D0,
     .              8.25D0,
     .              8.50D0,
     .              8.75D0,
     .              9.00D0,
     .              9.50D0,
     .             10.00D0,
     .             11.00D0,
     .             13.00D0,
     .              3.00D0,
     .              3.25D0,
     .              3.50D0,
     .              3.75D0,
     .              4.00D0,
     .              4.25D0,
     .              4.50D0,
     .              4.75D0,
     .              5.00D0,
     .              5.25D0,
     .              5.50D0,
     .              5.75D0,
     .              6.00D0,
     .              6.25D0,
     .              6.50D0,
     .              6.75D0,
     .              7.00D0,
     .              7.25D0,
     .              7.50D0,
     .              7.75D0,
     .              8.00D0,
     .              8.25D0,
     .              8.50D0,
     .              8.75D0,
     .              9.00D0,
     .              9.50D0,
     .             10.00D0,
     .             11.00D0,
     .             13.00D0,
     .              3.00D0,
     .              3.25D0,
     .              3.50D0,
     .              3.75D0,
     .              4.00D0,
     .              4.25D0,
     .              4.50D0,
     .              4.75D0,
     .              5.00D0,
     .              5.25D0,
     .              5.50D0,
     .              5.75D0,
     .              6.00D0,
     .              6.25D0,
     .              6.50D0,
     .              6.75D0,
     .              7.00D0,
     .              7.25D0,
     .              7.50D0,
     .              7.75D0,
     .              8.00D0,
     .              8.25D0,
     .              8.50D0,
     .              8.75D0,
     .              9.00D0,
     .              9.50D0,
     .             10.00D0,
     .             11.00D0,
     .             13.00D0,
     .              3.00D0,
     .              3.25D0,
     .              3.50D0,
     .              3.75D0,
     .              4.00D0,
     .              4.25D0,
     .              4.50D0,
     .              4.75D0,
     .              5.00D0,
     .              5.25D0,
     .              5.50D0,
     .              5.75D0,
     .              6.00D0,
     .              6.25D0,
     .              6.50D0,
     .              6.75D0,
     .              7.00D0,
     .              7.25D0,
     .              7.50D0,
     .              7.75D0,
     .              8.00D0,
     .              8.25D0,
     .              8.50D0,
     .              8.75D0,
     .              9.00D0,
     .              9.50D0,
     .             10.00D0,
     .             11.00D0,
     .             13.00D0,
     .              3.00D0,
     .              3.25D0,
     .              3.50D0,
     .              3.75D0,
     .              4.00D0,
     .              4.25D0,
     .              4.50D0,
     .              4.75D0,
     .              5.00D0,
     .              5.25D0,
     .              5.50D0,
     .              5.75D0,
     .              6.00D0,
     .              6.25D0,
     .              6.50D0,
     .              6.75D0,
     .              7.00D0,
     .              7.25D0,
     .              7.50D0,
     .              7.75D0,
     .              8.00D0,
     .              8.25D0,
     .              8.50D0,
     .              8.75D0,
     .              9.00D0,
     .              9.50D0,
     .             10.00D0,
     .             11.00D0,
     .             13.00D0/

      DATA THETA1/
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           20.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           40.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           60.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           80.00D0,
     .           90.00D0,
     .           90.00D0,
     .           90.00D0,
     .           90.00D0,
     .           90.00D0/
       DATA THETA2 /
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .               90.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              100.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              120.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              140.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0,
     .              160.00D0/
      DATA VCOEF1/
     .             -934451.8171675592893735D0, 
     .             1076071.0746431478764862D0,
     .             -409234.5696133843739517D0,
     .              140977.2756427459826227D0,
     .              -49946.9185028208303265D0,
     .               32170.2181257223164721D0,
     .                9577.7071262124063651D0,
     .               34374.9704930035368307D0,
     .               29496.1227157268513110D0,
     .               45689.7005283145990688D0,
     .               25887.2781644563074224D0,
     .               53888.0907019757432863D0,
     .               27360.2055640322178078D0,
     .               18928.0716020534055133D0,
     .               45691.9644920940772863D0,
     .              -25256.8409691420165473D0,
     .               55762.4026571427093586D0,
     .              -52109.5054588389466517D0,
     .               24945.4144967932079453D0,
     .               75920.9123987134225899D0,
     .             -305881.8007400407223031D0,
     .              479758.8550635529099964D0,
     .             -518511.8812988895224407D0,
     .              275993.7824885208974592D0,
     .              -63815.2264838418705040D0,
     .              -55521.0906444694628590D0,
     .               -7259.2314740519059342D0,
     .              -18024.3388378269955865D0,
     .              -24211.0728657056679367D0,
     .            -5525957.8361540967598557D0,
     .             6143115.4958218093961477D0,
     .            -2320843.7342908270657063D0,
     .              820130.2013395059620962D0,
     .             -269944.6945371766923927D0,
     .              201455.4437902698118705D0,
     .               79170.5368597174528986D0,
     .              216264.4439456412510481D0,
     .              205718.8015579581551719D0,
     .              283406.1814506890950724D0,
     .              184529.6858685361221433D0,
     .              342032.7667670737137087D0,
     .              166002.1454221113817766D0,
     .               94056.7118233292567311D0,
     .              412143.3751327006611973D0,
     .             -367757.5536704187397845D0,
     .              601107.1089089853921905D0,
     .             -665845.9749354103114456D0,
     .              670899.4892302468651906D0,
     .             -321141.2868169271387160D0,
     .             -832596.6350289869587868D0,
     .             1909749.1581957472953945D0,
     .            -2688739.2594383633695543D0,
     .             2053249.1053557228296995D0,
     .            -1042013.3059240744914860D0,
     .               -2486.3439318561627260D0,
     .             -149084.8865439977962524D0,
     .             -125079.4840765644621570D0,
     .             -134817.6296559204638470D0,
     .           -12985798.3096326980739832D0,
     .            14178967.2066482082009315D0,
     .            -5355307.8585856538265944D0,
     .             1912819.4838405882474035D0,
     .             -599197.4890145955141634D0,
     .              500107.3897097168373875D0,
     .              213157.1412836718373001D0,
     .              543179.2101042738649994D0,
     .              526562.4603714363183826D0,
     .              651708.0977240934735164D0,
     .              533183.6057302325498313D0,
     .              767546.6412560455501080D0,
     .              441267.2282554725534283D0,
     .              156180.7771262741589453D0,
     .             1145026.0820021461695433D0,
     .            -1108381.7710809449199587D0,
     .             1560814.2966335427481681D0,
     .            -1517678.8973746437113732D0,
     .             1515518.3672190380748361D0,
     .            -1079576.4487684410996735D0,
     .            -1229731.6467763171531260D0,
     .             3939465.7723111198283732D0,
     .            -6445810.2157415589317679D0,
     .             5154728.4131734520196915D0,
     .            -2582742.2896838067099452D0,
     .              -21827.8637935590304551D0,
     .             -288560.6189165464602411D0,
     .             -393533.0230548396939412D0,
     .             -262115.4899723986745812D0,
     .           -18897023.3857665322721004D0,
     .            20499674.4678211919963360D0,
     .            -7713749.5344432927668095D0,
     .             2795264.5585732017643750D0,
     .             -831205.1829494270496070D0,
     .              763392.1805815513944253D0,
     .              325736.6055273569654673D0,
     .              820306.0058739130618051D0,
     .              779953.4251569248735905D0,
     .              912950.9351464734645560D0,
     .              836055.2996373130008578D0,
     .             1067947.6468731246422976D0,
     .              607580.9616343115922064D0,
     .              256837.8265490157355089D0,
     .             1619593.4738617483526468D0,
     .            -1650640.5513582865241915D0,
     .             2269970.1680178726091981D0,
     .            -2064985.8292870884761214D0,
     .             1988767.5256906598806381D0,
     .            -1542372.7991462680511177D0,
     .            -1617557.5156221052166075D0,
     .             5706687.0110325086861849D0,
     .            -9714226.3978173471987247D0,
     .             7544259.6994468579068780D0,
     .            -3439130.6634360174648464D0,
     .             -155397.6774673105392139D0,
     .             -407648.7789943689131178D0,
     .             -602105.2856197531800717D0,
     .             -327547.9458750414196402D0,
     .              -79487.2558404851151863D0,
     .               95167.6568710606079549D0,
     .              -35959.8411996125068981D0,
     .               12681.1677128824958345D0,
     .               -4568.5448236262209321D0/
         DATA VCOEF2/               
     .             2550.1236004056245292D0,
     .             2252.9516845314201419D0,
     .             -631.4178246307300242D0,
     .             5453.8057328353743287D0,
     .             2930.1188435073545406D0,
     .            -2568.6724981142174329D0,
     .            25987.6752158905474062D0,
     .           -68680.1543420812377008D0,
     .           110872.1154733011062490D0,
     .           -83077.1740854179952294D0,
     .            15353.2805912620242452D0,
     .            87050.7383334228507010D0,
     .          -231988.7586972090939526D0,
     .           328576.0914044684031978D0,
     .          -289651.8853380811051466D0,
     .           249639.9066369864449371D0,
     .          -376817.9531075183767825D0,
     .           495418.6718007121235132D0,
     .          -333858.4111722478992306D0,
     .            60403.9155227444352931D0,
     .            28939.2922511197430140D0,
     .           -18095.7134288889501477D0,
     .             4751.3059230770941213D0,
     .            -3522.1618550438893180D0,
     .        -19398525.1964479200541973D0,
     .         21111529.2497850917279720D0,
     .         -7869177.4008521530777216D0,
     .          2912529.6901345574297011D0,
     .          -818959.9552871556952596D0,
     .           807717.7423026827163994D0,
     .           333893.3879560087225400D0,
     .           835524.0727389175444841D0,
     .           760560.2095471848733723D0,
     .           917065.1419449646491557D0,
     .           797596.2329032830893993D0,
     .          1066258.2829793067649007D0,
     .           511872.4127186475670896D0,
     .           338822.8493069921969436D0,
     .          1504601.7185890991240740D0,
     .         -1721639.5404440497513860D0,
     .          2505671.8045132155530155D0,
     .         -2335587.0696324356831610D0,
     .          1971882.0652852484490722D0,
     .         -1036283.3959778164280578D0,
     .         -2196537.8494797358289361D0,
     .          5818942.7033156240358949D0,
     .         -9850118.9130969233810902D0,
     .          8060109.5715538682416081D0,
     .         -3866744.5806868509389460D0,
     .           120707.1533917151245987D0,
     .          -577578.8222668416565284D0,
     .          -562146.3317472983617336D0,
     .          -297889.9186773087712936D0,
     .        -13911730.5461629666388035D0,
     .         15348488.9898328650742769D0,
     .         -5671617.7625830946490169D0,
     .          2129591.8383530080318451D0,
     .          -583173.2997379486914724D0,
     .           588596.4666226634290069D0,
     .           218756.1412526484054979D0,
     .           581359.2980578377610072D0,
     .           494518.7568055749870837D0,
     .           631985.3196096363244578D0,
     .           493454.5706583372084424D0,
     .           764260.1859664192888886D0,
     .           206222.1310274212155491D0,
     .           409335.3554808035842143D0,
     .           844354.0970584199531004D0,
     .         -1194843.6806773275602609D0,
     .          1756557.5420277328230441D0,
     .         -1378194.9834821319673210D0,
     .           642759.1457036167848855D0,
     .           368776.6469596981769428D0,
     .         -2157264.3002010281197727D0,
     .          3716984.3663825658150017D0,
     .         -6488892.3003575885668397D0,
     .          5958015.5794648695737123D0,
     .         -3074576.0756807746365666D0,
     .           124544.5249982718814863D0,
     .          -305770.5265173176303506D0,
     .          -458102.4689794494188391D0,
     .          -145815.5098633257730398D0,
     .         -5964138.6886188592761755D0,
     .          6701847.0544293569400907D0,
     .         -2472507.5352550619281828D0,
     .           929214.5625988024985418D0,
     .          -257186.7034413547953591D0,
     .           256152.2622327321150806D0,
     .            79891.8654908797470853D0,
     .           242464.5289780388993677D0,
     .           190968.5631200301577337D0,
     .           256119.0123691676999442D0,
     .           189988.8504971283255145D0,
     .           316260.8717068989644758D0,
     .            36087.3739196343158255D0,
     .           237700.5040486371726729D0,
     .           242766.8583169187477324D0,
     .          -354849.5539681504014879D0,
     .           399426.0790647410321981D0,
     .           -68142.5561394159885822D0,
     .          -182776.1907996815280057D0,
     .           312809.7002328313537873D0,
     .          -605965.5857706587994471D0,
     .          1072656.8335878862999380D0,
     .         -2716087.9705796716734767D0,
     .          3071095.1819875845685601D0,
     .         -1716429.6308018241543323D0,
     .           111005.6028995515080169D0,
     .           -83236.3356110744934995D0,
     .          -223045.9020227316068485D0,
     .           -31805.3048039514869743D0,
     .          -952999.6059482896234840D0,
     .          1082420.9795943989884108D0,
     .          -399898.2558945417404175D0,
     .           150341.9379587110015564D0,
     .           -42143.4176425837940769D0,
     .            42251.5460846470305114D0,
     .            10844.8581147444347152D0,
     .            38543.2211518234544201D0,
     .            28267.3786032020107086D0,
     .            39830.2471485234927968D0,
     .            30170.0124781690319651D0,
     .            43231.8078625920243212D0,
     .            14360.8039042988439178D0,
     .            27455.4647796954377554D0,
     .            27788.8823791034192254D0,
     .             4404.0176923962408182D0,
     .           -75985.6858392883732449D0,
     .           153262.7018433203338645D0,
     .           -99470.0012662639346672D0,
     .           -30916.2618959113460733D0,
     .            75516.5945870363211725D0,
     .            72621.4358250910736388D0,
     .          -552955.3489813326159492D0,
     .           757008.8558268324704841D0,
     .          -451540.8155700397328474D0,
     .            68536.7102228699659463D0,
     .           -31419.1062795709513011D0,
     .           -28215.1276459977380000D0,
     .            -5717.4471958373733287D0/
         
C Kernel parameters
      N1=2
      M=5
      N2=10
      M2=2
C
      DO I=1,NPT 
C 150 size of the first R array or Theta or Coef
      IF (I.LE.121) THEN 
       VCOEF(I)=VCOEF1(I)
       R(I)=R1(I)
       THETA(I)=THETA1(I)
      ELSE
       VCOEF(I)=VCOEF2(I-121)
       R(I)=R2(I-121)
       THETA(I)=THETA2(I-121)
      ENDIF
      ENDDO
      PI=DACOS(-1.D0)
      FACT=PI/180.D0
C      EVALUATE PES    
       SUMA=ZERO
       XTT=DCOS(TT*FACT)
       DO I=1,NPT
        TI=DCOS(THETA(I)*FACT)
        SUMA=SUMA+VCOEF(I)*RKHS_DK(R(I),RR,N1,M)*RKHS_OP(TI,XTT,N2,M2)
       END DO
       VDIF_2D=SUMA
       RETURN
       END
