*  System:  O(3P) + H(2S)
*
*   potential energy curves taken from MRCISD calculation
*   by j. klos (25-feb-2015)

*   calculation of spin-orbit matrix
*   elements, taken from Yarkony [j. chem. phys. 97, 1838 (1992)] and 
*   Parlant and Yarkony [j. chem. phys. 110, 363 (1999)]
*
*   3P and 1D-3P spin-orbit matrix elements extend to large R.
*   compute 3P spin-orbit splitting using large R values
*  
*   written by p. dagdigian
*   current revision date:  26-feb-2015
*
      include "common/syusr"
      include "common/bausr"
      include "common/ground"
* --------------------------------------------------------------------------
      subroutine loapot(iunit,filnam)
* --------------------------------------------------------------------------
      character*(*) filnam
      common /coselb/ ibasty
      include "common/parbas"
      include "common/parpot"
      common /conlam/ nlam, nlammx, lamnum(2)
      potnam='O(3P)-H(2S) MRCI'
      npot=1
      ibasty=23
      lammin(1)=1
      lammax(1)=18
      mproj(1)=0
      ntv(1)=1
      ivcol(1,1)=0
      ivrow(1,1)=0
*  count number of anisotropic terms
      nlam = 0
      do il=lammin(1),lammax(1)
        nlam = nlam + 1
      enddo
      nlammx = nlam
      return
      end
* --------------------------------------------------------------------------
      subroutine driver
      implicit double precision (a-h,o-z)
      common /cosysi/ junk(5), npot
      common /cosysr/ isrcod, junkr, en(4)
      common /covvl/ vvl(18)
      include "common/parpot"
      potnam='O(3P)-H(2S) MRCI'
      econv=219474.6d0
      print *, potnam
1     print *, 'R (bohr):'
      read (5, *, end=99) r
      if (r.le.0.d0) goto 99
      call pot(vv0,r)
      write (6, 100) (econv*vvl(i), i=1,18)
100   format('  ',18(1pe16.8))
      goto 1
99    rr=1.075d0
      dr=0.2d0
      open (unit=12,file='oh_vlms_mrcisd.txt')
      write(12,109)
109   format(' R/bohr X2Pi  4Pi  2Sig-  4Sig-  A   B   C',
     :  '  D   E   F   G   A(R=inf)   B(R=inf)',
     :  '  C(R=inf)  D(R=inf)  E(R=inf)  F(R=inf)',
     :  '  G(R=inf)')
      do i=1,276
        call pot(vv0,rr)
        write (12,110) rr,(econv*vvl(j),j=1,18)
110     format(f7.2,18(1pe16.8))
        rr = rr + dr
      enddo
      close(12)
      end
* --------------------------------------------------------------------------
      subroutine pot (vv0, r)
*  subroutine to calculate the r-dependent coefficients
*  in atomic units (distance and energy)
* ----------------------------------------------------------------------
*  on entry:
*    r:      interparticle distance
*  on return:
*    vv0        (not used)
*    vvl(1,4)   contains the X2Pi, 4Pi, 2Sig-, 4Sig- energies
*    vvl(5,11)  contains the spin-orbit matrix elements [A - G]
*    vvl(12,18) contains the spin-orbit matrix elements A - G
*               at R=Rinf 
*  variable in common block /conlam/ used here
*    nlam:      the number of angular coupling terms actually used
*  variable in common block /covvl/
*    vvl:       array to store r-dependence of each
*               angular term in the potential
*  variable in common block /coconv/
*    econv:     conversion factor from cm-1 to hartrees
*  variables in common /cosysr/
*    isrcod:    number of real parameters
*    en1d:      asymptotic energy of the 1D state (cm-1)
* 
* author:  paul dagdigian
* latest revision date:  26-feb-2015
* ----------------------------------------------------------------------
      implicit double precision (a-h,o-z)
      include "common/parbas"
      common /covvl/ vvl(18)

      dimension rrx(69),vlx(69),rr(69),vl4p(69),vl2s(69),vl4s(69),
     +  rso(31),somat(217),vl(54)
      dimension csx(69),cs4p(69),cs42s(69),cd4s(69),csplso(31,11),vecelx(69),
     +  vecl4p(69),vecl2s(69),vecl4s(69),vecso(31)
      dimension v(18)
*
*  values of R for X2Pi PE curve
      data rrx /
     +  1.13383568,  1.22832199,  1.32280829, 
     +  1.41729460,  1.51178091,  1.60626721, 
     +  1.70075352,  1.79523982,  1.83303435, 
     +  1.88972613,  2.07869874,  2.26767136, 
     +  2.45664397,  2.64561658,  2.83458920, 
     +  3.02356181,  3.21253442,  3.30702073, 
     +  3.40150704,  3.59047965,  3.77945226, 
     +  4.25188380,  4.72431533,  5.19674686, 
     +  5.66917839,  6.14160993,  6.61404146, 
     +  7.08647299,  7.18095930,  7.27544561, 
     +  7.36993191,  7.46441822,  7.55890453, 
     +  7.65339083,  7.74787714,  7.84236345, 
     +  7.93684975,  8.03133606,  8.12582237, 
     +  8.22030867,  8.31479498,  8.40928128, 
     +  8.50376759,  8.52266485,  8.54156211, 
     +  8.56045938,  8.59825390,  8.69274020, 
     +  8.88171282,  9.07068543,  9.25965804, 
     +  9.44863066,  9.63760327,  9.92106219, 
     + 10.39349372, 10.86592526, 11.33835679, 
     + 11.81078832, 12.28321985, 13.22808292, 
     + 14.17294599, 15.11780905, 16.06267212, 
     + 17.00753518, 17.95239825, 18.89726131, 
     + 20.78698745, 22.67671358, 24.56643971 /
      data vlx /
     +  3.697934623557e+04, 9.946257140940e+03, -8.524307468560e+03, 
     + -2.090852416904e+04, -2.894157046612e+04, -3.385372464267e+04, 
     + -3.652645612532e+04, -3.760075597377e+04, -3.769374299075e+04, 
     + -3.754202455916e+04, -3.518795928521e+04, -3.127754225046e+04, 
     + -2.683011246314e+04, -2.237612696822e+04, -1.820188165922e+04, 
     + -1.446163209460e+04, -1.123269480180e+04, -9.819905794840e+03, 
     + -8.541705223550e+03, -6.376039178370e+03, -4.690704364310e+03, 
     + -2.104364685600e+03, -9.477925722700e+02, -4.410563467700e+02, 
     + -2.140471387100e+02, -1.087541784700e+02, -5.801164088000e+01, 
     + -3.268865651000e+01, -2.936142091000e+01, -2.641607120000e+01, 
     + -2.385041261000e+01, -2.158762904000e+01, -1.958821504000e+01, 
     + -1.781705466000e+01, -1.624122672000e+01, -1.483878375000e+01, 
     + -1.358338879000e+01, -1.245528912000e+01, -1.144131627000e+01, 
     + -1.052171751000e+01, -9.689908610000e+00, -8.932721090000e+00, 
     + -8.243570710000e+00, -8.111885930000e+00, -7.984590630000e+00, 
     + -7.857295340000e+00, -7.613678480000e+00, -7.071013400000e+00, 
     + -6.149693480000e+00, -5.289352880000e+00, -4.556307570000e+00, 
     + -3.930804840000e+00, -3.393091960000e+00, -2.723694300000e+00, 
     + -2.157435750000e+00, -1.593385910000e+00, -1.191747310000e+00, 
     + -8.976512900000e-01, -6.803714000000e-01, -4.104175800000e-01, 
     + -2.502011000000e-01, -1.514375100000e-01, -9.217935000000e-02, 
     + -5.267392000000e-02, -2.853170000000e-02, -1.097373000000e-02, 
     + 8.778980000000e-03, 1.975272000000e-02, 2.633696000000e-02 /
*  values of R for excited-state curves
      data rr /
     +  1.13383568,  1.22832199,  1.32280829, 
     +  1.41729460,  1.51178091,  1.60626721, 
     +  1.70075352,  1.79523982,  1.83303435, 
     +  1.88972613,  2.07869874,  2.26767136, 
     +  2.45664397,  2.64561658,  2.83458920, 
     +  3.02356181,  3.21253442,  3.30702073, 
     +  3.40150704,  3.59047965,  3.77945226, 
     +  4.25188380,  4.72431533,  5.19674686, 
     +  5.66917839,  6.14160993,  6.61404146, 
     +  7.08647299,  7.18095930,  7.27544561, 
     +  7.36993191,  7.46441822,  7.55890453, 
     +  7.65339083,  7.74787714,  7.84236345, 
     +  7.93684975,  8.03133606,  8.12582237, 
     +  8.22030867,  8.31479498,  8.40928128, 
     +  8.50376759,  8.52266485,  8.54156211, 
     +  8.56045938,  8.59825390,  8.69274020, 
     +  8.88171282,  9.07068543,  9.25965804, 
     +  9.44863066,  9.63760327,  9.92106219, 
     + 10.39349372, 10.86592526, 11.33835679, 
     + 11.81078832, 12.28321985, 13.22808292, 
     + 14.17294599, 15.11780905, 16.06267212, 
     + 17.00753518, 17.95239825, 18.89726131, 
     + 20.78698745, 22.67671358, 24.56643971 / 
      data vl4p /
     + 1.501875015775e+05, 1.212065245422e+05, 1.005848033562e+05, 
     + 8.576685208616e+04, 7.492434818774e+04, 6.671417049010e+04, 
     + 6.013083761400e+04, 5.443333732045e+04, 5.228799901675e+04, 
     + 4.916498457642e+04, 3.941468746262e+04, 3.078659931721e+04, 
     + 2.357448036635e+04, 1.780521405911e+04, 1.331375765829e+04, 
     + 9.875917815520e+03, 7.274566071190e+03, 6.227821264240e+03, 
     + 5.322868050740e+03, 3.868642231090e+03, 2.791737218620e+03, 
     + 1.191472971150e+03, 4.752481983800e+02, 1.692851820600e+02, 
     + 4.646058729000e+01, 1.815055300000e+00, -1.136659179000e+01, 
     + -1.316189438000e+01, -1.297534093000e+01, -1.270099762000e+01, 
     + -1.235861718000e+01, -1.196575757000e+01, -1.154217151000e+01, 
     + -1.109663798000e+01, -1.063574123000e+01, -1.017264973000e+01, 
     + -9.707363480000e+00, -9.244271990000e+00, -8.789959480000e+00, 
     + -8.346620690000e+00, -7.912060900000e+00, -7.492864330000e+00, 
     + -7.086836240000e+00, -7.007825370000e+00, -6.928814500000e+00, 
     + -6.851998370000e+00, -6.696171380000e+00, -6.323064480000e+00, 
     + -5.622940370000e+00, -4.988658650000e+00, -4.420219320000e+00, 
     + -3.913232900000e+00, -3.463309880000e+00, -2.888286310000e+00, 
     + -2.144267270000e+00, -1.610943890000e+00, -1.222473760000e+00, 
     + -9.349619800000e-01, -7.242663200000e-01, -4.411440300000e-01, 
     + -2.765380500000e-01, -1.777744600000e-01, -1.163215600000e-01, 
     + -7.681613000000e-02, -5.267392000000e-02, -3.511594000000e-02, 
     + -1.536323000000e-02, -4.389490000000e-03, 0.000000000000e+00 /
      data vl2s /
     + 1.146218652739e+05, 8.634948187806e+04, 6.658785548316e+04, 
     + 5.283443963468e+04, 4.332266975823e+04, 3.678130482347e+04, 
     + 3.227772464335e+04, 2.911754217213e+04, 2.810755936797e+04, 
     + 2.676933248167e+04, 2.297592396364e+04, 1.941415556865e+04, 
     + 1.595786668734e+04, 1.282862794611e+04, 1.015529729769e+04, 
     + 7.950369433520e+03, 6.169233937550e+03, 5.418134643930e+03, 
     + 4.749292251970e+03, 3.640440510380e+03, 2.759963109130e+03, 
     + 1.331683581840e+03, 6.045772562500e+02, 2.518222459200e+02, 
     + 9.031305048000e+01, 2.211130500000e+01, -3.314832460000e+00, 
     + -1.096132904000e+01, -1.148587344000e+01, -1.180411167000e+01, 
     + -1.195774392000e+01, -1.197310715000e+01, -1.187873305000e+01, 
     + -1.169217960000e+01, -1.143319952000e+01, -1.111496129000e+01, 
     + -1.074843863000e+01, -1.034460529000e+01, -9.914434990000e+00, 
     + -9.462317220000e+00, -9.001420470000e+00, -8.531744730000e+00, 
     + -8.062069000000e+00, -7.969889650000e+00, -7.875515550000e+00, 
     + -7.783336200000e+00, -7.596782750000e+00, -7.140275490000e+00, 
     + -6.260182170000e+00, -5.469308120000e+00, -4.876726580000e+00, 
     + -4.343403200000e+00, -3.869337970000e+00, -3.261393200000e+00, 
     + -2.469089740000e+00, -1.883092440000e+00, -1.437558920000e+00, 
     + -1.099567970000e+00, -8.427826300000e-01, -5.047916800000e-01, 
     + -3.072645000000e-01, -1.887481900000e-01, -1.163215600000e-01, 
     + -6.584240000000e-02, -3.731069000000e-02, -1.755797000000e-02, 
     + 4.389490000000e-03, 1.536322000000e-02, 2.194746000000e-02 /
      data vl4s /
     + 1.123381226358e+05, 8.399808179161e+04, 6.413257146369e+04, 
     + 5.022726379864e+04, 4.050172342464e+04, 3.367029202198e+04, 
     + 2.879023381731e+04, 2.517346727139e+04, 2.396776575910e+04, 
     + 2.233785487678e+04, 1.771869276513e+04, 1.376964599837e+04, 
     + 1.044846790238e+04, 7.802547442190e+03, 5.775947115390e+03, 
     + 4.256530742360e+03, 3.127346869800e+03, 2.677265828790e+03, 
     + 2.289436575670e+03, 1.666631184930e+03, 1.202995389930e+03, 
     + 5.011988802400e+02, 1.776142447800e+02, 3.876580629000e+01, 
     + -1.299070415000e+01, -2.642694183000e+01, -2.526372622000e+01, 
     + -2.040016812000e+01, -1.939716900000e+01, -1.841831209000e+01, 
     + -1.747018163000e+01, -1.655497236000e+01, -1.567268430000e+01, 
     + -1.482551217000e+01, -1.401126125000e+01, -1.322993151000e+01, 
     + -1.248152298000e+01, -1.176603564000e+01, -1.107908001000e+01, 
     + -1.042285082000e+01, -9.797348090000e+00, -9.202571810000e+00, 
     + -8.638521970000e+00, -8.528784650000e+00, -8.421242080000e+00, 
     + -8.313699500000e+00, -8.103003840000e+00, -7.598212160000e+00, 
     + -6.678613410000e+00, -5.868751970000e+00, -5.164238360000e+00, 
     + -4.549709360000e+00, -4.020775470000e+00, -3.357962050000e+00, 
     + -2.519568910000e+00, -1.916013640000e+00, -1.466090620000e+00, 
     + -1.125904920000e+00, -8.691195900000e-01, -5.245444000000e-01, 
     + -3.270172200000e-01, -2.085009100000e-01, -1.360742800000e-01, 
     + -8.778986000000e-02, -5.925815000000e-02, -3.950544000000e-02, 
     + -1.755797000000e-02, -6.584240000000e-03, 0.000000000000e+00 /
      data rso /
     +  2.00000,  2.25000,  2.50000,  2.75000,  3.00000, 
     +  3.25000,  3.50000,  3.75000,  4.00000,  4.25000, 
     +  4.50000,  4.75000,  5.00000,  5.25000,  5.50000, 
     +  5.75000,  6.00000,  6.25000,  6.50000,  6.75000, 
     +  7.00000,  7.25000,  7.50000,  7.75000,  8.00000, 
     +  8.25000,  8.50000,  8.75000,  9.00000,  9.25000, 
     +  9.50000 /
      data somat /
     + -2.6178000d+01, -2.5624206d+01, -2.5322333d+01, -2.5194460d+01, 
     + -2.5162667d+01, -2.5162000d+01, -2.5177000d+01, -2.5197333d+01, 
     + -2.5217333d+01, -2.5234771d+01, -2.5249000d+01, -2.5259872d+01, 
     + -2.5268000d+01, -2.5274095d+01, -2.5278503d+01, -2.5281475d+01, 
     + -2.5283265d+01, -2.5284127d+01, -2.5284312d+01, -2.5284074d+01, 
     + -2.5283667d+01, -2.5283298d+01, -2.5282999d+01, -2.5282759d+01, 
     + -2.5282564d+01, -2.5282403d+01, -2.5282264d+01, -2.5282134d+01, 
     + -2.5282000d+01, -2.5281853d+01, -2.5281692d+01, 
     + -1.7460000d+00, -3.5041328d+00, -5.5650000d+00, -8.0248672d+00, 
     + -1.0980000d+01, -1.4480000d+01, -1.8361000d+01, -2.2287000d+01, 
     + -2.5845000d+01, -2.8750040d+01, -3.0962000d+01, -3.2528256d+01, 
     + -3.3624000d+01, -3.4427786d+01, -3.5003801d+01, -3.5387640d+01, 
     + -3.5614896d+01, -3.5721166d+01, -3.5742043d+01, -3.5713123d+01, 
     + -3.5670000d+01, -3.5641725d+01, -3.5631179d+01, -3.5634696d+01, 
     + -3.5648613d+01, -3.5669266d+01, -3.5692990d+01, -3.5716123d+01, 
     + -3.5735000d+01, -3.5746650d+01, -3.5750871d+01, 
     + -5.7509000d+01, -5.6802859d+01, -5.6806000d+01, -5.7294141d+01, 
     + -5.8043000d+01, -5.8849000d+01, -5.9598000d+01, -6.0231000d+01, 
     + -6.0732000d+01, -6.1111844d+01, -6.1391000d+01, -6.1591449d+01, 
     + -6.1736000d+01, -6.1844550d+01, -6.1924531d+01, -6.1980254d+01, 
     + -6.2016035d+01, -6.2036186d+01, -6.2045022d+01, -6.2046855d+01, 
     + -6.2046000d+01, -6.2045998d+01, -6.2047306d+01, -6.2049608d+01, 
     + -6.2052589d+01, -6.2055935d+01, -6.2059328d+01, -6.2062455d+01, 
     + -6.2065000d+01, -6.2066709d+01, -6.2067576d+01, 
     + -3.9973000d+01, -4.0247413d+01, -4.0802000d+01, -4.1482087d+01, 
     + -4.2133000d+01, -4.2639000d+01, -4.3027000d+01, -4.3313000d+01, 
     + -4.3512000d+01, -4.3648057d+01, -4.3738000d+01, -4.3795743d+01, 
     + -4.3833000d+01, -4.3859289d+01, -4.3877551d+01, -4.3889078d+01, 
     + -4.3895165d+01, -4.3897107d+01, -4.3896197d+01, -4.3893730d+01, 
     + -4.3891000d+01, -4.3889057d+01, -4.3887975d+01, -4.3887583d+01, 
     + -4.3887710d+01, -4.3888186d+01, -4.3888840d+01, -4.3889502d+01, 
     + -4.3890000d+01, -4.3890197d+01, -4.3890081d+01, 
     + -2.3533000d+01, -3.0389322d+01, -3.5561000d+01, -3.9798428d+01, 
     + -4.3852000d+01, -4.8294000d+01, -5.2979000d+01, -5.7537000d+01, 
     + -6.1526000d+01, -6.4678410d+01, -6.7005000d+01, -6.8606145d+01, 
     + -6.9697000d+01, -7.0486843d+01, -7.1046669d+01, -7.1412902d+01, 
     + -7.1621965d+01, -7.1710283d+01, -7.1714279d+01, -7.1670377d+01, 
     + -7.1615000d+01, -7.1577802d+01, -7.1561351d+01, -7.1561445d+01, 
     + -7.1573881d+01, -7.1594457d+01, -7.1618970d+01, -7.1643219d+01, 
     + -7.1663000d+01, -7.1674902d+01, -7.1678675d+01, 
     + -6.8146000d+01, -6.8684892d+01, -6.9187000d+01, -6.9449858d+01, 
     + -6.9271000d+01, -6.8442000d+01, -6.6779000d+01, -6.4343000d+01, 
     + -6.1500000d+01, -5.8736533d+01, -5.6374000d+01, -5.4608382d+01, 
     + -5.3327000d+01, -5.2365232d+01, -5.1659336d+01, -5.1170789d+01, 
     + -5.0861069d+01, -5.0691652d+01, -5.0624017d+01, -5.0619640d+01, 
     + -5.0640000d+01, -5.0653406d+01, -5.0655499d+01, -5.0648753d+01, 
     + -5.0635641d+01, -5.0618636d+01, -5.0600212d+01, -5.0582842d+01, 
     + -5.0569000d+01, -5.0560684d+01, -5.0557995d+01, 
     + 4.8837000d+01, 5.8669650d+01, 6.4021000d+01, 6.6035600d+01, 
     + 6.5858000d+01, 6.4428000d+01, 6.1960000d+01, 5.8839000d+01, 
     + 5.5554000d+01, 5.2559885d+01, 5.0074000d+01, 4.8198276d+01, 
     + 4.6817000d+01, 4.5781239d+01, 4.5026825d+01, 4.4510783d+01, 
     + 4.4190138d+01, 4.4021912d+01, 4.3963132d+01, 4.3970819d+01, 
     + 4.4002000d+01, 4.4021440d+01, 4.4024873d+01, 4.4015775d+01, 
     + 4.3997624d+01, 4.3973894d+01, 4.3948063d+01, 4.3923606d+01, 
     + 4.3904000d+01, 4.3892055d+01, 4.3887919d+01 / 
*
*  set vv0 term to zero
      vv0 = 0.d0
*
*  spline fits
      if (ifirst .eq. 0) then
*  spline fit of the coefficients for the PE curves
*  evaluate derivative at first point
        der1=(vlx(2)-vlx(1))/(rrx(2)-rrx(1))
        call dspline(rrx,vlx,69,der1,0d0,csx)
*
        der1=(vl4p(2)-vl4p(1))/(rr(2)-rr(1))
        call dspline(rr,vl4p,69,der1,0d0,cs4p)
*
        der1=(vl2s(2)-vl2s(1))/(rr(2)-rr(1))
        call dspline(rr,vl2s,69,der1,0d0,cs2s)
*
        der1=(vl4s(2)-vl4s(1))/(rr(2)-rr(1))
        call dspline(rr,vl4s,69,der1,0d0,cs4s)
*
*  spline fit of the coefficients for the spin-orbit matrix elements
        indso=1
        do ilam=5,11
          call dcopy(31,somat(indso),1,vecso,1)
*  evaluate derivative at first point
          der1=(vecso(2)-vecso(1))/(rso(2)-rso(1))
          call dspline(rso,vecso,31,der1,0d0,csplso(1,ilam))
          indso = indso + 31
        enddo
        ifirst = 1
      end if
*
*  determine splined coefficients for PE curves at r=R
      call dsplint(rrx,vlx,csx,69,r,vvx)
      v(1) = vvx
      call dsplint(rr,vl4p,cs4p,69,r,vv4p)
      v(2) = vv4p
      call dsplint(rr,vl2s,cs2s,69,r,vv2s)
      v(3) = vv2s
      call dsplint(rr,vl4s,cs4s,69,r,vv4s)
      v(4) = vv4s
*  fix long-range behavior of PE curves to C6/R^6 at large R
      if (r.gt.rrx(65)) then
        c6 = vlx(65) * rrx(65)**6
        v(1) = c6 / r**6
      endif
      if (r.gt.rr(65)) then
        c6 = vl2s(65) * rr(65)**6
        v(3) = c6 / r**6
      endif
      if (r.gt.rr(66)) then
        c6 = vl4p(66) * rr(66)**6
        v(2) = c6 / r**6
        c6 = vl4s(66) * rr(66)**6
        v(4) = c6 / r**6
      endif
*
*  determine splined coefficients for spin-orbit matrix elements at r=R
      indso=1
      do ilam=5,11
        call dcopy(31,somat(indso),1,vecso,1)
        call dsplint(rso,vecso,csplso(1,ilam),31,r,vvx)
        v(ilam) = vvx
        call dcopy(31,somat(indso),1,vecso,1)
        indso = indso + 31
*  if r≥8.5 bohr, set equal to SO matrix element at R=9.5
        if (r.ge.9.5d0) v(ilam) = somat(indso-1)
*  get value of spin-orbit parameter at R=inf
        v(ilam+7) = somat(indso-1)
      enddo
      call dcopy(18,v,1,vvl,1)
* convert to hartree
      econv=1.d0/219474.6d0
      call dscal(18,econv,vvl,1)
      return
      end
*===================================eof====================================
