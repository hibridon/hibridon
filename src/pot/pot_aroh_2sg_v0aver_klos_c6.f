*Ar-OH(A^2Sigma+ v=0 averaged) PES RCCSD(T) Klos et al
*
*  Reference:  J. Klos, M. H. Alexander, M. Brouard, C. J. Eyles, 
*  and F. J. Aoiz, J. Chem. Phys. 129, 054301 (2008).
*           Phys. Chem. Chem. Phys. 12, 10660-10670 (2010)
*
*  damp long-range part of PES to an isotropic C6 form, with
*  C6 determined from Voo term at R=10
*  (26-aug-2013, p.dagdigian)


      subroutine driver
      implicit double precision (a-h,o-z)
      common /cosysr/ xjunk(2),rshift,xfact
      common /covvl/ vvl(10)
      include "common/parpot"
      potnam='Klos et al Ar-OH(A^2Sigma+ v=0) CCSDT PES'
      print *, potnam
1      print *, ' r (bohr)'
      rshift=0.5
      xfact=0.8
      read (5, *, end=99) r
      call pot(vv0,r)
      write (6, 100) vv0,vvl
100   format(' vsig',/,11(1pe16.8))
      goto 1
99    end

      include "common/syusr"
      include "common/bausr"
      include "common/ground"
      subroutine loapot(iunit,filnam)
* ------------------------------------------------------------------------
      character*(*) filnam
      include "common/parbas"
      include "common/parpot"
      potnam='Klos et al Ar-OH(A^2Sigma+ v=0) CCSDT PES'
      lammin(1)=1
      lammax(1)=10
      mproj(1)=0
      ntv(1)=1
      ivcol(1,1)=0
      ivrow(1,1)=0
      return
      end
* ----------------------------------------------------------------------
      subroutine pot (vv0, r)
*  subroutine to calculate the r-dependent coefficients
*  in atomic units (distance and energy)
* ----------------------------------------------------------------------
*  on entry:
*    r:      interparticle distance
*  on return:
*  vv0        contains isotropic term (d00 term in vsum)
*  variable in common block /covvl/
*    vvl:     vector of length 6 to store r-dependence of each term
*             in potential expansion
*    vvl(1-10) expansion coefficients in dl0 (l=1:11) of vsum

* uses linear least squares routines from cmlib

* author:  millard alexander
* latest revision date:  8-oct-1993
* revised for He-NO(X) : 1-20-95 by Moonbong Yang
* revised for CCSD(T) PES: 2002.10.13 by Jacek Klos
*revised for Ar-OH(A^2Sigma+) 2005 J.Klos
* ----------------------------------------------------------------------

      implicit double precision (a-h,o-z)
      dimension xlam1(7),xlam2(7),r0(7),
     :          vsum(11),xsum(11),
     :          d0(121),aa(121),thta(11),cthta(11)
      dimension kpvt(11),qraux(11),work(121),rsd(7),re(14)

      common /covvl/ vvl(10)
      data half, zero, one, alph /0.5d0, 0.d0, 1.d0, 1.2d0/
* for distances beyond rmax difference potential is damped
      data rmax /13d0/
* coefficicients for d0 rotation matrices
* stored (by column) for each of 7 angles and for l=0:6
* angles are 0 20 40 60 80 90 100 120 140 160 180
      data d0/
     :  1.d0,!l=0
     :  1.d0,
     :  1.d0,
     :  1.d0,
     :  1.d0,
     :  1.d0,
     :  1.d0,
     :  1.d0,
     :  1.d0,
     :  1.d0,
     :  1.d0,!l=0
     :                    1.d0, !l=1
     :    0.939692620785908d0,
     :    0.766044443118978d0,
     :                  0.5d0,
     :     0.17364817766693d0,
     :                  1d-16,
     :    -0.17364817766693d0,
     :                 -0.5d0,
     :   -0.766044443118978d0,
     :   -0.939692620785908d0,
     :                   -1d0, !l=1
     :                    1d0, !l=2
     :    0.824533332339233d0, 
     :    0.380236133250197d0,
     :               -0.125d0,
     :   -0.454769465589431d0,
     :                 -0.5d0,
     :   -0.454769465589431d0,
     :               -0.125d0,
     :    0.380236133250197d0,
     :    0.824533332339233d0,
     :                    1d0, !l=2
     :                    1d0, !l=3
     :    0.664884732794716d0, 
     :  -0.0252333338303835d0,
     :              -0.4375d0,
     :   -0.247381933374901d0,
     :                  1d-16,
     :    0.247381933374901d0,
     :               0.4375d0,
     :   0.0252333338303835d0,
     :   -0.664884732794716d0,
     :                   -1d0, !l=3
     : 1d0,                   !l=4
     :    0.474977735636283d0,
     :   -0.319004346471378d0,
     :           -0.2890625d0,
     :    0.265901610835095d0,
     :                0.375d0,
     :    0.265901610835095d0,
     :           -0.2890625d0,
     :   -0.319004346471378d0,
     :    0.474977735636283d0,
     :                    1d0,!l=4
     :  1.d0,                 !l=5
     :    0.271491745551255d0,
     :   -0.419682045437054d0,
     :           0.08984375d0,
     :    0.281017540988309d0,
     :                  1d-16,
     :   -0.281017540988309d0,
     :          -0.08984375d0,
     :    0.419682045437054d0,
     :   -0.271491745551255d0,
     :                   -1d0,!l=5
     :                   1.d0,!l=6
     :   0.0719030017842305d0,
     :   -0.323570725710931d0,
     :         0.3232421875d0,
     :   -0.132121338573299d0,
     :              -0.3125d0,
     :   -0.132121338573299d0,
     :         0.3232421875d0,
     :   -0.323570725710931d0,
     :   0.0719030017842305d0,
     :                    1d0, !l=6
     :                    1d0, !l=7
     :   -0.107226158692938d0,
     :   -0.100601708629502d0,
     :        0.22314453125d0,
     :   -0.283479918813435d0,
     :                  1d-16,
     :    0.283479918813435d0,
     :       -0.22314453125d0,
     :    0.100601708629502d0,
     :    0.107226158692938d0,
     :                   -1d0,!l=7
     :                    1d0,!l=8
     :   -0.251839432959275d0,
     :    0.138626797752243d0,
     :   -0.073638916015625d0,
     :   0.0233078500507821d0,
     :            0.2734375d0,
     :   0.0233078500507821d0,
     :   -0.073638916015625d0,
     :    0.138626797752243d0,
     :   -0.251839432959275d0,
     :                    1d0,!l=8
     :                    1d0, !l=9
     :   -0.351696543958561d0,
     :    0.290012951832139d0,
     :   -0.267898559570312d0,
     :    0.259627174131175d0,
     :                  1d-16,
     :   -0.259627174131175d0,
     :    0.267898559570312d0,
     :   -0.290012951832139d0,
     :    0.351696543958561d0,
     :                   -1d0, !l=9
     :                    1d0, !l=10
     :   -0.401269139852809d0,
     :    0.297345221371711d0,
     :   -0.188228607177734d0,
     :   0.0646821277096134d0,
     :          -0.24609375d0,
     :   0.0646821277096134d0,
     :   -0.188228607177734d0,
     :    0.297345221371711d0,
     :   -0.401269139852809d0,
     :                    1d0/!l=10
      thta(1)=0.D0
      thta(2)=20.D0
      thta(3)=40.D0
      thta(4)=60.D0
      thta(5)=80.D0
      thta(6)=90.D0
      thta(7)=100.D0
      thta(8)=120.D0
      thta(9)=140.D0
      thta(10)=160.D0
      thta(11)=180.D0
      do i=1,11
      cthta(i)=dcos(thta(i)*dacos(-1.D0)/180.D0)
      enddo
      do 100 i=1,11
        vsum(i)=VPES(r,thta(i))
100   continue
* solve simultaneous equations for solutions
      tol=1.e-10
      call dcopy(121,d0,1,aa,1)
      call dqrank(aa,11,11,11,tol,kr,kpvt,qraux,work)
      call dqrlss(aa,11,11,11,kr,vsum,xsum,rsd,kpvt,qraux)
* convert to hartree
      conv=1.d0/219474.6
      call dscal(11,conv,xsum,1)
      vv0=xsum(1)
      call dcopy(10,xsum(2),1,vvl,1)
*
* switch to isotropic C6 potential at long range
* r^-6 fit to isotropic part of potential at R=20
      c6 = -1.2276092e+07*conv
* switching function for long-range
      rsw = 25.d0
      switch_lr=0.5*(tanh(0.5*(r - rsw)) + 1.d0)
* kill anisotropic terms at large R
      do ilam=1,10
        vvl(ilam) = (1.d0 - switch_lr)*vvl(ilam)
      end do
* isotropic term - merge with C6 form
      vv0 = (1.d0 - switch_lr)*vv0 + switch_lr*c6/(r**6)
      return
      end


      FUNCTION VPES(RR,TT)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      PARAMETER (NPT=360)
      DIMENSION VAB(NPT),VCOEF(NPT),VCOEF1(170),VCOEF2(190)
      DIMENSION R1(170),R2(190),THETA1(170),THETA2(190) 
      DIMENSION R(NPT),THETA(NPT)
      DATA R1/
     .                    2.5D0,
     .                   2.75D0,
     .                   3.25D0,
     .                    3.5D0,
     .                   3.55D0,
     .                   3.65D0,
     .                   3.75D0,
     .                   3.85D0,
     .                   3.95D0,
     .                      4D0,
     .                   4.05D0,
     .                   4.15D0,
     .                   4.25D0,
     .                    4.5D0,
     .                   4.75D0,
     .                      5D0,
     .                   5.15D0,
     .                   5.25D0,
     .                   5.35D0,
     .                    5.5D0,
     .                   5.75D0,
     .                      6D0,
     .                   6.25D0,
     .                    6.5D0,
     .                   6.75D0,
     .                      7D0,
     .                   7.25D0,
     .                    7.5D0,
     .                   7.75D0,
     .                      8D0,
     .                   8.25D0,
     .                    8.5D0,
     .                      9D0,
     .                    9.5D0,
     .                     10D0,
     .                     12D0,
     .                     14D0,
     .                     16D0,
     .                     18D0,
     .                     20D0,
     .                    2.5D0,
     .                   2.75D0,
     .                   3.25D0,
     .                    3.5D0,
     .                   3.55D0,
     .                   3.65D0,
     .                   3.75D0,
     .                   3.85D0,
     .                   3.95D0,
     .                      4D0,
     .                   4.05D0,
     .                   4.15D0,
     .                   4.25D0,
     .                    4.5D0,
     .                   4.75D0,
     .                      5D0,
     .                   5.15D0,
     .                   5.25D0,
     .                   5.35D0,
     .                    5.5D0,
     .                   5.75D0,
     .                      6D0,
     .                   6.25D0,
     .                    6.5D0,
     .                   6.75D0,
     .                      7D0,
     .                   7.25D0,
     .                    7.5D0,
     .                   7.75D0,
     .                      8D0,
     .                   8.25D0,
     .                    8.5D0,
     .                      9D0,
     .                    9.5D0,
     .                     10D0,
     .                     12D0,
     .                     14D0,
     .                     16D0,
     .                     18D0,
     .                     20D0,
     .                    2.5D0,
     .                   2.75D0,
     .                   3.25D0,
     .                    3.5D0,
     .                   3.55D0,
     .                   3.65D0,
     .                   3.75D0,
     .                   3.85D0,
     .                   3.95D0,
     .                      4D0,
     .                   4.05D0,
     .                   4.15D0,
     .                   4.25D0,
     .                    4.5D0,
     .                   4.75D0,
     .                      5D0,
     .                   5.15D0,
     .                   5.25D0,
     .                   5.35D0,
     .                    5.5D0,
     .                   5.75D0,
     .                      6D0,
     .                   6.25D0,
     .                    6.5D0,
     .                   6.75D0,
     .                      7D0,
     .                   7.25D0,
     .                    7.5D0,
     .                   7.75D0,
     .                      8D0,
     .                   8.25D0,
     .                    8.5D0,
     .                      9D0,
     .                    9.5D0,
     .                     10D0,
     .                     12D0,
     .                     14D0,
     .                     16D0,
     .                     18D0,
     .                     20D0,
     .                    2.5D0,
     .                   2.75D0,
     .                   3.25D0,
     .                    3.5D0,
     .                   3.55D0,
     .                   3.65D0,
     .                   3.75D0,
     .                   3.85D0,
     .                   3.95D0,
     .                      4D0,
     .                   4.05D0,
     .                   4.15D0,
     .                   4.25D0,
     .                    4.5D0,
     .                   4.75D0,
     .                      5D0,
     .                   5.15D0,
     .                   5.25D0,
     .                   5.35D0,
     .                    5.5D0,
     .                   5.75D0,
     .                      6D0,
     .                   6.25D0,
     .                    6.5D0,
     .                   6.75D0,
     .                      7D0,
     .                   7.25D0,
     .                    7.5D0,
     .                   7.75D0,
     .                      8D0,
     .                   8.25D0,
     .                    8.5D0,
     .                      9D0,
     .                    9.5D0,
     .                     10D0,
     .                     12D0,
     .                     14D0,
     .                     16D0,
     .                     18D0,
     .                     20D0,
     .                    2.5D0,
     .                   2.75D0,
     .                   3.25D0,
     .                    3.5D0,
     .                   3.55D0,
     .                   3.65D0,
     .                   3.75D0,
     .                   3.85D0,
     .                   3.95D0,
     .                      4D0/
      DATA R2/
     .                    4.05D0,
     .                    4.15D0,
     .                    4.25D0,
     .                     4.5D0,
     .                    4.75D0,
     .                       5D0,
     .                    5.15D0,
     .                    5.25D0,
     .                    5.35D0,
     .                     5.5D0,
     .                    5.75D0,
     .                       6D0,
     .                    6.25D0,
     .                     6.5D0,
     .                    6.75D0,
     .                       7D0,
     .                    7.25D0,
     .                     7.5D0,
     .                    7.75D0,
     .                       8D0,
     .                    8.25D0,
     .                     8.5D0,
     .                       9D0,
     .                     9.5D0,
     .                      10D0,
     .                      12D0,
     .                      14D0,
     .                      16D0,
     .                      18D0,
     .                      20D0,
     .                     2.5D0,
     .                    2.75D0,
     .                    3.25D0,
     .                     3.5D0,
     .                    3.55D0,
     .                    3.65D0,
     .                    3.75D0,
     .                    3.85D0,
     .                    3.95D0,
     .                       4D0,
     .                    4.05D0,
     .                    4.15D0,
     .                    4.25D0,
     .                     4.5D0,
     .                    4.75D0,
     .                       5D0,
     .                    5.15D0,
     .                    5.25D0,
     .                    5.35D0,
     .                     5.5D0,
     .                    5.75D0,
     .                       6D0,
     .                    6.25D0,
     .                     6.5D0,
     .                    6.75D0,
     .                       7D0,
     .                    7.25D0,
     .                     7.5D0,
     .                    7.75D0,
     .                       8D0,
     .                    8.25D0,
     .                     8.5D0,
     .                       9D0,
     .                     9.5D0,
     .                      10D0,
     .                      12D0,
     .                      14D0,
     .                      16D0,
     .                      18D0,
     .                      20D0,
     .                     2.5D0,
     .                    2.75D0,
     .                    3.25D0,
     .                     3.5D0,
     .                    3.55D0,
     .                    3.65D0,
     .                    3.75D0,
     .                    3.85D0,
     .                    3.95D0,
     .                       4D0,
     .                    4.05D0,
     .                    4.15D0,
     .                    4.25D0,
     .                     4.5D0,
     .                    4.75D0,
     .                       5D0,
     .                    5.15D0,
     .                    5.25D0,
     .                    5.35D0,
     .                     5.5D0,
     .                    5.75D0,
     .                       6D0,
     .                    6.25D0,
     .                     6.5D0,
     .                    6.75D0,
     .                       7D0,
     .                    7.25D0,
     .                     7.5D0,
     .                    7.75D0,
     .                       8D0,
     .                    8.25D0,
     .                     8.5D0,
     .                       9D0,
     .                     9.5D0,
     .                      10D0,
     .                      12D0,
     .                      14D0,
     .                      16D0,
     .                      18D0,
     .                      20D0,
     .                     2.5D0,
     .                    2.75D0,
     .                    3.25D0,
     .                     3.5D0,
     .                    3.55D0,
     .                    3.65D0,
     .                    3.75D0,
     .                    3.85D0,
     .                    3.95D0,
     .                       4D0,
     .                    4.05D0,
     .                    4.15D0,
     .                    4.25D0,
     .                     4.5D0,
     .                    4.75D0,
     .                       5D0,
     .                    5.15D0,
     .                    5.25D0,
     .                    5.35D0,
     .                     5.5D0,
     .                    5.75D0,
     .                       6D0,
     .                    6.25D0,
     .                     6.5D0,
     .                    6.75D0,
     .                       7D0,
     .                    7.25D0,
     .                     7.5D0,
     .                    7.75D0,
     .                       8D0,
     .                    8.25D0,
     .                     8.5D0,
     .                       9D0,
     .                     9.5D0,
     .                      10D0,
     .                      12D0,
     .                      14D0,
     .                      16D0,
     .                      18D0,
     .                      20D0,
     .                     2.5D0,
     .                    2.75D0,
     .                    3.25D0,
     .                     3.5D0,
     .                    3.55D0,
     .                    3.65D0,
     .                    3.75D0,
     .                    3.85D0,
     .                    3.95D0,
     .                       4D0,
     .                    4.05D0,
     .                    4.15D0,
     .                    4.25D0,
     .                     4.5D0,
     .                    4.75D0,
     .                       5D0,
     .                    5.15D0,
     .                    5.25D0,
     .                    5.35D0,
     .                     5.5D0,
     .                    5.75D0,
     .                       6D0,
     .                    6.25D0,
     .                     6.5D0,
     .                    6.75D0,
     .                       7D0,
     .                    7.25D0,
     .                     7.5D0,
     .                    7.75D0,
     .                       8D0,
     .                    8.25D0,
     .                     8.5D0,
     .                       9D0,
     .                     9.5D0,
     .                      10D0,
     .                      12D0,
     .                      14D0,
     .                      16D0,
     .                      18D0,
     .                      20D0/

      DATA THETA1/
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                        0D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                     22.5D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                       45D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                     67.5D0,
     .                       90D0,
     .                       90D0,
     .                       90D0,
     .                       90D0,
     .                       90D0,
     .                       90D0,
     .                       90D0,
     .                       90D0,
     .                       90D0,
     .                       90D0/

      DATA THETA2/
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                      90D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                   112.5D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                     135D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                   157.5D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0,
     .                     180D0/

      DATA VCOEF1/
     .                   -.0170231318103584D0, 
     .             -743584.1470470716012642D0,
     .              970659.6590034660184756D0,
     .           338354311.5323111414909363D0,
     .             1058019.5943793011829257D0,
     .               47395.5118208173735184D0,
     .             1173948.6071544988080859D0,
     .              128858.8481600124214310D0,
     .               86884.7121086108818417D0,
     .         -1620623908.1076295375823975D0,
     .               36237.0455569290643325D0,
     .               46789.4647017647876055D0,
     .          5575024394.1904830932617188D0,
     .         -7137483802.0846042633056641D0,
     .          3310860582.7769775390625000D0,
     .         -1415904831.9011425971984863D0,
     .           832011570.1121008396148682D0,
     .          -332890216.7504035234451294D0,
     .            82318752.6574629247188568D0,
     .            19361075.6139376610517502D0,
     .            67976320.9331672638654709D0,
     .            70552999.6945993304252625D0,
     .            64961332.3918410539627075D0,
     .            52605237.0787482038140297D0,
     .            39942423.1660988479852676D0,
     .            29637912.0249740518629551D0,
     .            18951708.5663771554827690D0,
     .            16251228.9241205211728811D0,
     .            14139827.4568785112351179D0,
     .             8269041.7743352996185422D0,
     .             3455688.8552179997786880D0,
     .              837972.7899521662620828D0,
     .            -9045838.9511544667184353D0,
     .             -568167.4311518976464868D0,
     .           -14538171.9285243097692728D0,
     .           -11595307.5469481386244297D0,
     .            -1882774.4188637549523264D0,
     .             3002345.0948144220747054D0,
     .           -21411228.8666372112929821D0,
     .            15353280.7523906771093607D0,
     .                    .0281581100998559D0,
     .            -8119388.4510304750874639D0,
     .            10598894.2867255415767431D0,
     .          3648977498.8014793395996094D0,
     .            11552934.8745212238281965D0,
     .              517632.0399617245420814D0,
     .         -1835477121.3660862445831299D0,
     .             1407877.9893185275141150D0,
     .              946701.1555238011060283D0,
     .          4624090306.4104642868041992D0,
     .              394297.4256663055275567D0,
     .              511391.9001329428865574D0,
     .        -21406775721.3593025207519531D0,
     .         21921361809.2905731201171875D0,
     .        -10728285372.1455287933349609D0,
     .          4476442701.2113552093505859D0,
     .         -2622771384.5020942687988281D0,
     .          1132448918.4823422431945801D0,
     .          -200863348.6302129626274109D0,
     .           199073182.7771873772144318D0,
     .           185527721.8185359537601471D0,
     .           157720156.4556873142719269D0,
     .           125883697.1728972941637039D0,
     .            98641750.6020682305097580D0,
     .            82510137.9547970145940781D0,
     .            67594202.1008548736572266D0,
     .            60609822.4178918674588203D0,
     .            38445135.1960933804512024D0,
     .            28445711.1934469677507877D0,
     .            16066797.4460970219224691D0,
     .            10494113.4723384808748960D0,
     .            10985956.0820356737822294D0,
     .            -9925456.7962292302399874D0,
     .             6770198.3454589126631618D0,
     .           -34502111.6874059587717056D0,
     .           -73478385.6094248443841934D0,
     .            38481450.1300808191299438D0,
     .           -36289138.8661267757415771D0,
     .           -46730912.3890690729022026D0,
     .            34797431.1066235452890396D0,
     .                   -.0547381181621323D0,
     .           -10421875.8380015660077333D0,
     .            13604509.2574584744870663D0,
     .         -1842278091.5013105869293213D0,
     .            14828979.9229067470878363D0,
     .              664367.9341125134378672D0,
     .          5309769810.9675512313842773D0,
     .             1806691.6371686577331275D0,
     .             1216259.3201214899308980D0,
     .         -9782746441.2311611175537109D0,
     .              507118.7316846538451500D0,
     .              656039.8199382522143424D0,
     .         13859383617.6130104064941406D0,
     .        -11744297008.1858673095703125D0,
     .          5676299697.4228534698486328D0,
     .         -2286474638.3296627998352051D0,
     .          1395608365.2053067684173584D0,
     .          -533931776.1567793488502502D0,
     .           116059559.1624809652566910D0,
     .           -57324329.3490974009037018D0,
     .           -75529741.2724158316850662D0,
     .           -81815113.1637524366378784D0,
     .           -63882665.1897158548235893D0,
     .           -43437304.5452707633376122D0,
     .           -29301018.8475438281893730D0,
     .           -15719371.0065715722739697D0,
     .            -9547813.9094732142984867D0,
     .            10448482.2187920343130827D0,
     .             7334314.6688913907855749D0,
     .            23989826.7196705527603626D0,
     .             9764123.4652728643268347D0,
     .            26319494.4256251119077206D0,
     .            39612126.8391465693712234D0,
     .            27706521.7217871136963367D0,
     .            20035551.8173115961253643D0,
     .             9090055.2143273185938597D0,
     .            15636666.5921104028820992D0,
     .             5731964.7695392342284322D0,
     .           -98735196.3275572359561920D0,
     .            78922545.2483791112899780D0,
     .                   -.0570114118507859D0,
     .            10267990.5150097981095314D0,
     .           -13403637.2092441339045763D0,
     .         -5419333067.6300334930419922D0,
     .           -14610192.8686372525990009D0,
     .             -654500.4360565406968817D0,
     .         12140030710.4154586791992188D0,
     .            -1780222.7337225312367082D0,
     .            -1197693.7888373180758208D0,
     .         -7774129022.3049201965332031D0,
     .             -499179.7731769889942370D0,
     .             -646420.0641626759897918D0,
     .          3812421217.9654064178466797D0,
     .         -2879678887.5701875686645508D0,
     .          1090924525.1679413318634033D0,
     .          -698834991.3448328971862793D0,
     .           258695277.4582985341548920D0,
     .          -241331901.8895312249660492D0,
     .           -23578502.5858734101057053D0,
     .          -163124607.2437867820262909D0,
     .          -160711101.8556888997554779D0,
     .          -120920356.6496244519948959D0,
     .           -91448997.8142858594655991D0,
     .           -63197980.0180418267846107D0,
     .           -37149922.7731612026691437D0,
     .           -13903286.7031839638948441D0,
     .            -2767351.7765208943746984D0,
     .            10172180.1528877876698971D0,
     .            22481967.5802900157868862D0,
     .            26362852.5245459936559200D0,
     .            34685825.4204588830471039D0,
     .            49059647.7951811626553535D0,
     .            81592871.5823615938425064D0,
     .            16290821.7936366479843855D0,
     .           103000755.0392810255289078D0,
     .            64187528.1091691777110100D0,
     .           -30447341.2588147856295109D0,
     .            41033782.0694421082735062D0,
     .           -26392932.6395607218146324D0,
     .            -1510140.4063053480349481D0,
     .                    .0054151471338052D0,
     .            62712154.2693900763988495D0,
     .           -81863228.7016335725784302D0,
     .          6839495415.0826988220214844D0,
     .           -89231820.0420817732810974D0,
     .            -3997776.9095773305743933D0,
     .        -14410728924.4237270355224609D0,
     .           -10872516.7378408610820770D0,
     .            -7316198.2631692709401250D0,
     .         13711367617.4725112915039062D0/
         DATA VCOEF2/               
     .            -3049298.2285679434426129D0,
     .            -3948433.4801340699195862D0,
     .         -8170038101.9797725677490234D0,
     .          4632383060.9088277816772461D0,
     .         -2591622748.4342732429504395D0,
     .           686182431.3498704433441162D0,
     .          -674328992.2056639194488525D0,
     .           189460490.3585433363914490D0,
     .          -174459680.9110006093978882D0,
     .          -114975619.9236638247966766D0,
     .          -132121701.4087202250957489D0,
     .           -82988962.3411454260349274D0,
     .           -61184962.9778046756982803D0,
     .           -31713908.7251197621226311D0,
     .            -5452020.6198538439348340D0,
     .             4125100.7845284226350486D0,
     .            34093540.6813706010580063D0,
     .            22356331.6872353516519070D0,
     .            43815693.7466098815202713D0,
     .            39654070.7003151103854179D0,
     .            36166907.8647814765572548D0,
     .            69300629.5558635145425797D0,
     .            93028973.6742636412382126D0,
     .            20498098.3369534313678741D0,
     .           112157639.2307623177766800D0,
     .            55953750.1890948489308357D0,
     .           -26546810.4060775600373745D0,
     .           -10138472.7436898406594992D0,
     .            95986051.5124457627534866D0,
     .           -84707716.6698517352342606D0,
     .                   -.0152549909747512D0,
     .           117719913.5491355508565903D0,
     .          -153669293.3586444854736328D0,
     .         16097890677.8628730773925781D0,
     .          -167501180.1188344955444336D0,
     .            -7504581.1832030778750777D0,
     .        -36563391372.1236877441406250D0,
     .           -20409647.8296654894948006D0,
     .           -13732898.4610043503344059D0,
     .         27487467113.0734100341796875D0,
     .            -5723377.0514636225998402D0,
     .            -7412061.5640648454427719D0,
     .         -5112297882.8248386383056641D0,
     .         -2381035053.1627240180969238D0,
     .          1265597871.7164487838745117D0,
     .          -724863638.3251805305480957D0,
     .           248915380.4743023216724396D0,
     .           -97084860.8741240799427032D0,
     .           -84748204.2916321754455566D0,
     .           -70753616.3464999645948410D0,
     .           -82810868.0062661916017532D0,
     .           -49973988.1156389415264130D0,
     .           -32601122.6853187233209610D0,
     .           -13893692.4751375224441290D0,
     .              228435.9177048190613277D0,
     .            14316793.3544388245791197D0,
     .            14880352.5742942225188017D0,
     .            29046029.2629761174321175D0,
     .            28052586.2979136146605015D0,
     .            31521317.7734561599791050D0,
     .            23634957.0160248391330242D0,
     .            55737291.6754012256860733D0,
     .            52883381.3383666723966599D0,
     .            27423209.3475667499005795D0,
     .            52599974.8816872388124466D0,
     .            40731599.0044827833771706D0,
     .           -30338798.1413448378443718D0,
     .            17161597.9701460413634777D0,
     .            12709555.6503514703363180D0,
     .            -8572020.1256252210587263D0,
     .                   -.0821280388161787D0,
     .           134571469.4339922964572906D0,
     .          -175666990.0047707259654999D0,
     .          6791453173.1771640777587891D0,
     .          -191479046.7472339570522308D0,
     .            -8578692.2874320689588785D0,
     .        -12401099504.3497676849365234D0,
     .           -23331127.8681059554219246D0,
     .           -15698609.6606763489544392D0,
     .          7425210283.1667556762695312D0,
     .            -6542139.2927872175350785D0,
     .            -8473089.2717497609555721D0,
     .         -5719599369.6829643249511719D0,
     .          5644921767.7438554763793945D0,
     .         -2200977859.7349324226379395D0,
     .          1114881548.6517531871795654D0,
     .          -435617981.2787449955940247D0,
     .            23293030.7920938096940517D0,
     .           132889522.6321547180414200D0,
     .           -26981590.0173271670937538D0,
     .             2469853.2253711717203259D0,
     .           -19527864.7322657294571400D0,
     .           -15095318.5680232029408216D0,
     .           -10295943.2538805771619081D0,
     .           -10354470.5272229854017496D0,
     .             2365748.7876824508421123D0,
     .            -4787914.1217299830168486D0,
     .             4940380.9906622180715203D0,
     .            -8050107.0043551521375775D0,
     .             2017967.1548020809423178D0,
     .             -549718.3717783282045275D0,
     .              579160.4138211425160989D0,
     .             6548393.2518060412257910D0,
     .            -8744890.7276201136410236D0,
     .            -5232711.3760749921202660D0,
     .            -6821145.9993158020079136D0,
     .             -792548.5122683744411916D0,
     .           -26825731.2557053938508034D0,
     .            79046381.5597266256809235D0,
     .           -59425013.9356818944215775D0,
     .                   -.0033317990646677D0,
     .            85631121.9811408072710037D0,
     .          -111781209.7445760071277618D0,
     .         -3847949565.1949467658996582D0,
     .          -121842863.4432238489389420D0,
     .            -5458799.1121597485616803D0,
     .          9389845981.9927635192871094D0,
     .           -14846173.5924807135015726D0,
     .            -9989628.8385475594550371D0,
     .        -10283151899.6121902465820312D0,
     .            -4163333.7397943520918489D0,
     .            -5391614.5245939297601581D0,
     .          7928330311.8261070251464844D0,
     .         -5326437069.1591587066650391D0,
     .          2854720481.6424918174743652D0,
     .          -919336109.6366025209426880D0,
     .           634909434.2238441705703735D0,
     .          -150609329.8709413707256317D0,
     .            31690426.5959735400974751D0,
     .            26539035.1293564960360527D0,
     .             7794573.5619267430156469D0,
     .             2604845.3723946334794164D0,
     .              -52388.2179606566569419D0,
     .            -2048086.0613405713811517D0,
     .            -1174079.8957350258715451D0,
     .            -9258394.2904945425689220D0,
     .            -7225442.3013033997267485D0,
     .           -12852510.4363283924758434D0,
     .            -9078792.5126498620957136D0,
     .           -12994918.8000471964478493D0,
     .           -10580271.3242997303605080D0,
     .           -21154296.5453671626746655D0,
     .           -28107894.0666305050253868D0,
     .            -5398262.5610676929354668D0,
     .           -39753196.4272783994674683D0,
     .           -13418224.9431094136089087D0,
     .            -1300220.0486381470691413D0,
     .            -6387572.8178327539935708D0,
     .            15863906.1679095346480608D0,
     .            -7674443.8985529448837042D0,
     .                   -.0020875385497029D0,
     .             9917675.1352820787578821D0,
     .           -12946339.9625966176390648D0,
     .          -893410069.7387892007827759D0,
     .           -14111630.2295002061873674D0,
     .             -632249.5431310371495783D0,
     .          1453707706.9171998500823975D0,
     .            -1719449.3749184748157859D0,
     .            -1156994.8417735199909657D0,
     .            88860212.6020040065050125D0,
     .             -482167.8972929780720733D0,
     .             -624430.6250211930600926D0,
     .         -1926477983.8874557018280029D0,
     .          2039939933.2797667980194092D0,
     .          -980277816.3375984430313110D0,
     .           422453315.0892284512519836D0,
     .          -240182916.4426848590373993D0,
     .            97208360.5775777250528336D0,
     .           -15470006.0331212449818850D0,
     .             6907041.2366656046360731D0,
     .             2174238.1453698719851673D0,
     .             -312062.1281332279322669D0,
     .            -1405634.1426198349799961D0,
     .            -1550832.5831304730381817D0,
     .            -1712368.4278696428518742D0,
     .             -560950.9074717108160257D0,
     .            -2219406.0022966852411628D0,
     .            -1558197.8643974415026605D0,
     .            -3380050.7483815359883010D0,
     .            -2887620.2602936611510813D0,
     .             -970445.0712331619579345D0,
     .            -3878826.9710953617468476D0,
     .            -4376827.7211994323879480D0,
     .            -2964611.7375088250264525D0,
     .            -3949096.4717618366703391D0,
     .            -4409450.8147027771919966D0,
     .             1487305.0872593284584582D0,
     .              246127.4069284483848605D0,
     .            -2176040.8265807460993528D0,
     .             1638235.4329927030485123D0/
         
C Kernel parameters
      N1=2
      M=5
      N2=8
      M2=0
C
      DO I=1,NPT 
      IF (I.LE.170) THEN 
       VCOEF(I)=VCOEF1(I)
       R(I)=R1(I)
       THETA(I)=THETA1(I)
      ELSE
       VCOEF(I)=VCOEF2(I-170)
       R(I)=R2(I-170)
       THETA(I)=THETA2(I-170)
      ENDIF
      ENDDO
      PI=DACOS(-1.D0)
      FACT=PI/180.D0
C      EVALUATE PES    
       SUMA=ZERO
       XTT=DCOS(TT*FACT)
       DO I=1,NPT
        TI=DCOS(THETA(I)*FACT)
        SUMA=SUMA+VCOEF(I)*RKHS_DK(R(I),RR,N1,M)*RKHS_OP(TI,XTT,N2,M2)
       END DO
       VPES=SUMA
       RETURN
       END


C------RKHS ROUTINES

C------------------------RKHS---------------------------------
C Fortran  Deck with distance-like and angular-like 
C kernels for RKHS interpolation method
C****************************************************
C* By J. KLOS  12/05/2007   University of Maryland  *
C* REVISON: 1.0                                     * 
C* jasztol@gmail.com                                *
C****************************************************
C-------------------------------------------------------------
C FUNCTIONS:
C
C RKHS_DK(X,Y,N,M): Reproducing kernel for  distance-like (DK) 
C                   variables, see Ho, Rabitz Eq(17) of
C                   J. Chem. Phys. 104, 2584 (1996) 
C                   Range = [0, inf]
C
C  INPUT: X,Y-DOUBLE PRECISION
C          N:INTEGER:ORDER OF SMOOTHNESS OF THE FUNCTION
C          M>=0:INTEGER:RECIPROCAL POWER OF THE WEIGHT W(X)=X**(-M)
C  OUTPUT: DOUBLE PRECISION
C -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -            
C RKHS_AK(X,Y,N): Reproducing kernel for  angular-like (AK) 
C                   variables, see Ho, Rabitz Eq(23) of
C                   J. Chem. Phys. 104, 2584 (1996) 
C                    Range = [0, 1]
C    
C  INPUT: X,Y-DOUBLE PRECISION
C          N:INTEGER:ORDER OF SMOOTHNESS OF THE FUNCTION
C  OUPUT: DOUBLE PRECISION
C  HINT: SCALE ANGLES TO [0,1] INTEGRAL FOR ANGLES, FOR EXAMPLE: 
C          X=(1.d0-cosd(ANGLE))/2.d0
C -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -
C RKHS_OP(X,Y,N,M):Reproducing kernel for angular like 
C                    variables with a use of orthogonal 
C                    polynomials Plm(L,M,X) where X is 
C                    K=SUM_L=M^N PLM(X)PLM(X')
C                    variable transformed from angles as
C                    x=cos(theta)
C-------------------------------------------------------------
       DOUBLE PRECISION FUNCTION RKHS_DK(X,Y,N,M)
       IMPLICIT DOUBLE PRECISION (A-H,O-Z)
       IF (X .LT. Y) THEN
           XB=X
           XU=Y
       ELSE
           XB=Y
           XU=X
       ENDIF

C       M=ABS(M)! FORCE M>=0
       NSQR=N*N
       XUPOWM=XU**(-(M+1))

C      TERM WITH BETA FUNCTION
       CALL BETA(DFLOAT(M+1),DFLOAT(N),BETATERM)

C      GET TERM WITH 2F1 HYPERGEOMETRIC  GAUSS FUNCTION
       CALL HYGFX(DFLOAT(-N+1),DFLOAT(M+1),DFLOAT(N+M+1),XB/XU,HF)
       RKHS_DK=NSQR*XUPOWM*BETATERM*HF
       RETURN
       END

C-------------------------------------------------------------
       DOUBLE PRECISION FUNCTION RKHS_EXPR(X,Y,XE,N)
       IMPLICIT DOUBLE PRECISION (A-H,O-Z)
       PARAMETER (ZERO=0.D0,ONE=1.D0)
       
       SUMA=ZERO
       Z1=(X-XE)/XE
       Z2=(Y-XE)/XE
       DO I=0,N
       SUMA=SUMA+(Z1**I)*(Z2**I)
       ENDDO

       RKHS_EXPR=SUMA
       RETURN
       END


C-------------------------------------------------------------
       DOUBLE PRECISION FUNCTION RKHS_AK(X,Y,N)
       IMPLICIT DOUBLE PRECISION (A-H,O-Z)
       PARAMETER (ZERO=0.D0,ONE=1.D0)
       
       IF ((X.EQ.ZERO).OR.(Y.EQ.ZERO)) THEN
          RKHS_AK=ONE
          RETURN
       ENDIF
       IF (X .LT. Y) THEN
           XB=X
           XU=Y
       ELSE
           XB=Y
           XU=X
       ENDIF

       SUMA=ZERO
C      GET POLYNOMIAL TERM
       DO I=0,N-1
       SUMA=SUMA+(XU**I)*(XB**I)
       END DO

C      GET TERM WITH 2F1 HYPERGEOMETRIC  GAUSS FUNCTION
       CALL HYGFX(DFLOAT(1),DFLOAT(-N+1),DFLOAT(N+1),XB/XU,HF)
       
       RKHS_AK=SUMA+N*(XB**N)*(XU**(N-1))*HF
       RETURN
       END

       DOUBLE PRECISION FUNCTION RKHS_OP(X,Y,N,M)
       IMPLICIT DOUBLE PRECISION (A-H,O-Z)
       PARAMETER (ZERO=0.D0,ONE=1.D0)

       SUMA=ZERO
C      GET ORTHOGONAL POLYNOMIAL TERM
       DO I=ABS(M),N
       SUMA=SUMA+PLGNDR(I,M,X)*PLGNDR(I,M,Y)
       END DO
       RKHS_OP=SUMA
       RETURN
       END

       DOUBLE PRECISION FUNCTION RKHS_OP2L(X,Y,N,M)
       IMPLICIT DOUBLE PRECISION (A-H,O-Z)
       PARAMETER (ZERO=0.D0,ONE=1.D0)
 
       SUMA=ZERO
C      GET ORTHOGONAL POLYNOMIAL TERM
       DO I=ABS(M),N,2
       SUMA=SUMA+PLGNDR(I,M,X)*PLGNDR(I,M,Y)
       END DO
       RKHS_OP2L=SUMA
       RETURN
       END


            


      FUNCTION PLGNDR(L,M,x)
      IMPLICIT DOUBLE PRECISION (A-H, O-Z)
      if(m.lt.0.or.m.gt.l.or.abs(x).gt.1.)pause
     *'bad arguments in plgndr'
      pmm=1.
      if(m.gt.0) then
        somx2=dsqrt((1.-x)*(1.+x))
        fact=1.
        do 11 i=1,m
          pmm=-pmm*fact*somx2
          fact=fact+2.
11      continue
      endif
      if(l.eq.m) then
        plgndr=pmm
      else
        pmmp1=x*(2*m+1)*pmm
        if(l.eq.m+1) then
          plgndr=pmmp1
        else
         do 12 ll=m+2,l
            pll=(x*(2*ll-1)*pmmp1-(ll+m-1)*pmm)/(ll-m)
            pmm=pmmp1
            pmmp1=pll
12        continue
          plgndr=pll
        endif
      endif
      return
      END



        SUBROUTINE BETA(P,Q,BT)
C
C       ==========================================
C       Purpose: Compute the beta function B(p,q)
C       Input :  p  --- Parameter  ( p > 0 )
C                q  --- Parameter  ( q > 0 )
C       Output:  BT --- B(p,q)
C       Routine called: GAMMA for computing B(x)
C       ==========================================
C
        IMPLICIT DOUBLE PRECISION (A-H,O-Z)
        CALL GAMMA(P,GP)
        CALL GAMMA(Q,GQ)
        PPQ=P+Q
        CALL GAMMA(PPQ,GPQ)
        BT=GP*GQ/GPQ
        RETURN
        END


        SUBROUTINE GAMMA(X,GA)
C
C       ==================================================
C       Purpose: Compute gamma function (x)
C       Input :  x  --- Argument of ( x )
C                       ( x is not equal to 0,-1,-2,...)
C       Output:  GA --- (x)
C       ==================================================
C
        IMPLICIT DOUBLE PRECISION (A-H,O-Z)
        DIMENSION G(26)
        PI=3.141592653589793D0
        IF (X.EQ.INT(X)) THEN
           IF (X.GT.0.0D0) THEN
              GA=1.0D0
              M1=X-1
              DO 10 K=2,M1
10               GA=GA*K
           ELSE
              GA=1.0D+300
           ENDIF
        ELSE
           IF (DABS(X).GT.1.0D0) THEN
              Z=DABS(X)
              M=INT(Z)
              R=1.0D0
              DO 15 K=1,M
15               R=R*(Z-K)
              Z=Z-M
           ELSE
              Z=X
           ENDIF
           DATA G/1.0D0,0.5772156649015329D0,
     &          -0.6558780715202538D0, -0.420026350340952D-1,
     &          0.1665386113822915D0,-.421977345555443D-1,
     &          -.96219715278770D-2, .72189432466630D-2,
     &          -.11651675918591D-2, -.2152416741149D-3,
     &          .1280502823882D-3, -.201348547807D-4,
     &          -.12504934821D-5, .11330272320D-5,
     &          -.2056338417D-6, .61160950D-8,
     &          .50020075D-8, -.11812746D-8,
     &          .1043427D-9, .77823D-11,
     &          -.36968D-11, .51D-12,
     &          -.206D-13, -.54D-14, .14D-14, .1D-15/
           GR=G(26)
           DO 20 K=25,1,-1
20            GR=GR*Z+G(K)
           GA=1.0D0/(GR*Z)
           IF (DABS(X).GT.1.0D0) THEN
              GA=GA*R
              IF (X.LT.0.0D0) GA=-PI/(X*GA*DSIN(PI*X))
           ENDIF
        ENDIF
        RETURN
        END



        SUBROUTINE HYGFX(A,B,C,X,HF)
C
C       ====================================================
C       Purpose: Compute hypergeometric function F(a,b,c,x)
C       Input :  a --- Parameter
C                b --- Parameter
C                c --- Parameter, c <> 0,-1,-2,...
C                x --- Argument   ( x < 1 )
C       Output:  HF --- F(a,b,c,x)
C       Routines called:
C            (1) GAMMA for computing gamma function
C            (2) PSI_AAA for computing psi function
C       ====================================================
C
        IMPLICIT DOUBLE PRECISION (A-H,O-Z)
        LOGICAL L0,L1,L2,L3,L4,L5
        PI=3.141592653589793D0
        EL=.5772156649015329D0
        L0=C.EQ.INT(C).AND.C.LT.0.0
        L1=1.0D0-X.LT.1.0D-15.AND.C-A-B.LE.0.0
        L2=A.EQ.INT(A).AND.A.LT.0.0
        L3=B.EQ.INT(B).AND.B.LT.0.0
        L4=C-A.EQ.INT(C-A).AND.C-A.LE.0.0
        L5=C-B.EQ.INT(C-B).AND.C-B.LE.0.0
        IF (L0.OR.L1) THEN
           WRITE(*,*)'The hypergeometric series is divergent'
           RETURN
        ENDIF
        EPS=1.0D-15
        IF (X.GT.0.95) EPS=1.0D-8
        IF (X.EQ.0.0.OR.A.EQ.0.0.OR.B.EQ.0.0) THEN
           HF=1.0D0
           RETURN
        ELSE IF (1.0D0-X.EQ.EPS.AND.C-A-B.GT.0.0) THEN
           CALL GAMMA(C,GC)
           CALL GAMMA(C-A-B,GCAB)
           CALL GAMMA(C-A,GCA)
           CALL GAMMA(C-B,GCB)
           HF=GC*GCAB/(GCA*GCB)
           RETURN
        ELSE IF (1.0D0+X.LE.EPS.AND.DABS(C-A+B-1.0).LE.EPS) THEN
           G0=DSQRT(PI)*2.0D0**(-A)
           CALL GAMMA(C,G1)
           CALL GAMMA(1.0D0+A/2.0-B,G2)
           CALL GAMMA(0.5D0+0.5*A,G3)
           HF=G0*G1/(G2*G3)
           RETURN
        ELSE IF (L2.OR.L3) THEN
           IF (L2) NM=INT(ABS(A))
           IF (L3) NM=INT(ABS(B))
           HF=1.0D0
           R=1.0D0
           DO 10 K=1,NM
              R=R*(A+K-1.0D0)*(B+K-1.0D0)/(K*(C+K-1.0D0))*X
10            HF=HF+R
           RETURN
        ELSE IF (L4.OR.L5) THEN
           IF (L4) NM=INT(ABS(C-A))
           IF (L5) NM=INT(ABS(C-B))
           HF=1.0D0
           R=1.0D0
           DO 15 K=1,NM
              R=R*(C-A+K-1.0D0)*(C-B+K-1.0D0)/(K*(C+K-1.0D0))*X
15            HF=HF+R
           HF=(1.0D0-X)**(C-A-B)*HF
           RETURN
        ENDIF
        AA=A
        BB=B
        X1=X
        IF (X.LT.0.0D0) THEN
           X=X/(X-1.0D0)
           IF (C.GT.A.AND.B.LT.A.AND.B.GT.0.0) THEN
              A=BB
              B=AA
           ENDIF
           B=C-B
        ENDIF
        IF (X.GE.0.75D0) THEN
           GM=0.0D0
           IF (DABS(C-A-B-INT(C-A-B)).LT.1.0D-15) THEN
              M=INT(C-A-B)
              CALL GAMMA(A,GA)
              CALL GAMMA(B,GB)
              CALL GAMMA(C,GC)
              CALL GAMMA(A+M,GAM)
              CALL GAMMA(B+M,GBM)
              CALL PSI_AAA(A,PA)
              CALL PSI_AAA(B,PB)
              IF (M.NE.0) GM=1.0D0
              DO 30 J=1,ABS(M)-1
30               GM=GM*J
              RM=1.0D0
              DO 35 J=1,ABS(M)
35               RM=RM*J
              F0=1.0D0
              R0=1.0D0
              R1=1.0D0
              SP0=0.D0
              SP=0.0D0
              IF (M.GE.0) THEN
                 C0=GM*GC/(GAM*GBM)
                 C1=-GC*(X-1.0D0)**M/(GA*GB*RM)
                 DO 40 K=1,M-1
                    R0=R0*(A+K-1.0D0)*(B+K-1.0)/(K*(K-M))*(1.0-X)
40                  F0=F0+R0
                 DO 45 K=1,M
45                  SP0=SP0+1.0D0/(A+K-1.0)+1.0/(B+K-1.0)-1.0/K
                 F1=PA+PB+SP0+2.0D0*EL+DLOG(1.0D0-X)
                 DO 55 K=1,250
                    SP=SP+(1.0D0-A)/(K*(A+K-1.0))+(1.0-B)/(K*(B+K-1.0))
                    SM=0.0D0
                    DO 50 J=1,M
50                     SM=SM+(1.0D0-A)/((J+K)*(A+J+K-1.0))+1.0/
     &                    (B+J+K-1.0)
                    RP=PA+PB+2.0D0*EL+SP+SM+DLOG(1.0D0-X)
                    R1=R1*(A+M+K-1.0D0)*(B+M+K-1.0)/(K*(M+K))*(1.0-X)
                    F1=F1+R1*RP
                    IF (DABS(F1-HW).LT.DABS(F1)*EPS) GO TO 60
55                  HW=F1
60               HF=F0*C0+F1*C1
              ELSE IF (M.LT.0) THEN
                 M=-M
                 C0=GM*GC/(GA*GB*(1.0D0-X)**M)
                 C1=-(-1)**M*GC/(GAM*GBM*RM)
                 DO 65 K=1,M-1
                    R0=R0*(A-M+K-1.0D0)*(B-M+K-1.0)/(K*(K-M))*(1.0-X)
65                  F0=F0+R0
                 DO 70 K=1,M
70                  SP0=SP0+1.0D0/K
                 F1=PA+PB-SP0+2.0D0*EL+DLOG(1.0D0-X)
                 DO 80 K=1,250
                    SP=SP+(1.0D0-A)/(K*(A+K-1.0))+(1.0-B)/(K*(B+K-1.0))
                    SM=0.0D0
                    DO 75 J=1,M
75                     SM=SM+1.0D0/(J+K)
                    RP=PA+PB+2.0D0*EL+SP-SM+DLOG(1.0D0-X)
                    R1=R1*(A+K-1.0D0)*(B+K-1.0)/(K*(M+K))*(1.0-X)
                    F1=F1+R1*RP
                    IF (DABS(F1-HW).LT.DABS(F1)*EPS) GO TO 85
80                  HW=F1
85               HF=F0*C0+F1*C1
              ENDIF
           ELSE
              CALL GAMMA(A,GA)
              CALL GAMMA(B,GB)
              CALL GAMMA(C,GC)
              CALL GAMMA(C-A,GCA)
              CALL GAMMA(C-B,GCB)
              CALL GAMMA(C-A-B,GCAB)
              CALL GAMMA(A+B-C,GABC)
              C0=GC*GCAB/(GCA*GCB)
              C1=GC*GABC/(GA*GB)*(1.0D0-X)**(C-A-B)
              HF=0.0D0
              R0=C0
              R1=C1
              DO 90 K=1,250
                 R0=R0*(A+K-1.0D0)*(B+K-1.0)/(K*(A+B-C+K))*(1.0-X)
                 R1=R1*(C-A+K-1.0D0)*(C-B+K-1.0)/(K*(C-A-B+K))
     &              *(1.0-X)
                 HF=HF+R0+R1
                 IF (DABS(HF-HW).LT.DABS(HF)*EPS) GO TO 95
90               HW=HF
95            HF=HF+C0+C1
           ENDIF
        ELSE
           A0=1.0D0
           IF (C.GT.A.AND.C.LT.2.0D0*A.AND.
     &         C.GT.B.AND.C.LT.2.0D0*B) THEN
              A0=(1.0D0-X)**(C-A-B)
              A=C-A
              B=C-B
           ENDIF
           HF=1.0D0
           R=1.0D0
           DO 100 K=1,250
              R=R*(A+K-1.0D0)*(B+K-1.0D0)/(K*(C+K-1.0D0))*X
              HF=HF+R
              IF (DABS(HF-HW).LE.DABS(HF)*EPS) GO TO 105
100           HW=HF
105        HF=A0*HF
        ENDIF
        IF (X1.LT.0.0D0) THEN
           X=X1
           C0=1.0D0/(1.0D0-X)**AA
           HF=C0*HF
        ENDIF
        A=AA
        B=BB
        IF (K.GT.120) WRITE(*,115)
115     FORMAT(1X,'Warning! You should check the accuracy')
        RETURN
        END



        SUBROUTINE PSI_AAA(X,PS)
C
C       ======================================
C       Purpose: Compute Psi function
C       Input :  x  --- Argument of psi(x)
C       Output:  PS --- psi(x)
C       ======================================
C
        IMPLICIT DOUBLE PRECISION (A-H,O-Z)
        XA=DABS(X)
        PI=3.141592653589793D0
        EL=.5772156649015329D0
        S=0.0D0
        IF (X.EQ.INT(X).AND.X.LE.0.0) THEN
           PS=1.0D+300
           RETURN
        ELSE IF (XA.EQ.INT(XA)) THEN
           N=XA
           DO 10 K=1 ,N-1
10            S=S+1.0D0/K
           PS=-EL+S
        ELSE IF (XA+.5.EQ.INT(XA+.5)) THEN
           N=XA-.5
           DO 20 K=1,N
20            S=S+1.0/(2.0D0*K-1.0D0)
           PS=-EL+2.0D0*S-1.386294361119891D0
        ELSE
           IF (XA.LT.10.0) THEN
              N=10-INT(XA)
              DO 30 K=0,N-1
30               S=S+1.0D0/(XA+K)
              XA=XA+N
           ENDIF
           X2=1.0D0/(XA*XA)
           A1=-.8333333333333D-01
           A2=.83333333333333333D-02
           A3=-.39682539682539683D-02
           A4=.41666666666666667D-02
           A5=-.75757575757575758D-02
           A6=.21092796092796093D-01
           A7=-.83333333333333333D-01
           A8=.4432598039215686D0
           PS=DLOG(XA)-.5D0/XA+X2*(((((((A8*X2+A7)*X2+
     &        A6)*X2+A5)*X2+A4)*X2+A3)*X2+A2)*X2+A1)
           PS=PS-S
        ENDIF
        IF (X.LT.0.0) PS=PS-PI*DCOS(PI*X)/DSIN(PI*X)-1.0D0/X
        RETURN
        END
