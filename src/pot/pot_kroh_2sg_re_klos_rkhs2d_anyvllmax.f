*Kr-OH(A^2Sigma+ r=re) PES RCCSD(T)/AVQZ Klos et al
*
*  Reference:  H. Chadwick, M. Brouard, Y.-P. Chang, C. J. Eyles, 
*  T. Perkins, S. A. Seamons, J. Klos, M. H. Alexander, and F. J. Aoiz,
*  J. Chem. Phys. 137, 154305 (2012)
*
      subroutine driver
      implicit double precision (a-h,o-z)
      common /cosysr/ xjunk(2),rshift,xfact
      common /covvl/ vvl(18)
      include "common/parpot"
      potnam='Klos et al Kr-OH(A^2Sigma+ r=re) RCCSDT PES'
      print *, potnam
1      print *, ' r (bohr)'
      rshift=0.5
      xfact=0.8
      read (5, *, end=99) r
      call pot(vv0,r)
      write (6, 100) vv0,vvl
100   format(' vsum',/,7(1pe16.8))
      goto 1
99    end

      include "common/syusr"
      include "common/bausr"
      include "common/ground"
      subroutine loapot(iunit,filnam)
* ------------------------------------------------------------------------
      character*(*) filnam
      include "common/parbas"
      include "common/parpot"
      potnam='Klos et al Ar-OH(A^2Sigma+ r=re) RCCSDT PES'
      lammin(1)=1
      lammax(1)=18
      mproj(1)=0
      ntv(1)=1
      ivcol(1,1)=0
      ivrow(1,1)=0
      return
      end
* ----------------------------------------------------------------------
      subroutine pot (vv0, r)
*  subroutine to calculate the r-dependent coefficients
*  in atomic units (distance and energy)
* ----------------------------------------------------------------------
*  on entry:
*    r:      interparticle distance
*  on return:
*  vv0        contains isotropic term (d00 term in vsum)
*  variable in common block /covvl/
*    vvl:     vector of length 6 to store r-dependence of each term
*             in potential expansion
*    vvl(1-10) expansion coefficients in dl0 (l=1:11) of vsum

* uses linear least squares routines from cmlib

* author:  millard alexander
* latest revision date:  8-oct-1993
* revised for He-NO(X) : 1-20-95 by Moonbong Yang
* revised for CCSD(T) PES: 2002.10.13 by Jacek Klos
*revised for Ar-OH(A^2Sigma+) 2005 J.Klos
* ----------------------------------------------------------------------

      implicit double precision (a-h,o-z)
      dimension  vsum(19),xsum(19),
     :          d0(361),aa(361),thta(19),cthta(19)
      dimension kpvt(19),qraux(19),work(361),rsd(19)

      common /covvl/ vvl(18)
      data half, zero, one, alph /0.5d0, 0.d0, 1.d0, 1.2d0/
      index=1
      do i=1,19
      thta(i)=(i-1)*10
      cthta(i)=dcos(thta(i)*DACOS(-1D0)/180.D0)
      enddo
       do l=0,18 
        do i=1,19
         d0(index)=PLGNDR(l,0,cthta(i))
         index=index+1
        enddo
       enddo
      
      do 100 i=1,19
        vsum(i)=VPES(r,thta(i))
100   continue
* solve simultaneous equations for solutions
      tol=1.e-10
      call dcopy(361,d0,1,aa,1)
      call dqrank(aa,19,19,19,tol,kr,kpvt,qraux,work)
      call dqrlss(aa,19,19,19,kr,vsum,xsum,rsd,kpvt,qraux)
* convert to hartree
      conv=1.d0/219474.6
      call dscal(19,conv,xsum,1)
      vv0=xsum(1)
      call dcopy(18,xsum(2),1,vvl,1)
      end
C------PES---------

      FUNCTION VPES(RR,TT)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      PARAMETER (NPT=405)
      DIMENSION VAB(NPT),VCOEF(NPT),VCOEF1(198),VCOEF2(207)
      DIMENSION R1(198),R2(207),THETA1(198),THETA2(207) 
      DIMENSION R(NPT),THETA(NPT)
      DATA R1/
     .              3.000D0,
     .              3.100D0,
     .              3.250D0,
     .              3.300D0,
     .              3.400D0,
     .              3.500D0,
     .              3.750D0,
     .              3.800D0,
     .              3.900D0,
     .              4.000D0,
     .              4.100D0,
     .              4.200D0,
     .              4.250D0,
     .              4.500D0,
     .              4.750D0,
     .              4.800D0,
     .              4.900D0,
     .              5.000D0,
     .              5.150D0,
     .              5.250D0,
     .              5.350D0,
     .              5.500D0,
     .              5.750D0,
     .              6.000D0,
     .              6.250D0,
     .              6.500D0,
     .              6.750D0,
     .              7.000D0,
     .              7.250D0,
     .              7.500D0,
     .              7.750D0,
     .              8.000D0,
     .              8.250D0,
     .              8.500D0,
     .              9.000D0,
     .              9.500D0,
     .             10.000D0,
     .             12.000D0,
     .             14.000D0,
     .             16.000D0,
     .             18.000D0,
     .             20.000D0,
     .             22.000D0,
     .             24.000D0,
     .              2.500D0,
     .              2.750D0,
     .              3.000D0,
     .              3.100D0,
     .              3.250D0,
     .              3.300D0,
     .              3.400D0,
     .              3.500D0,
     .              3.750D0,
     .              3.800D0,
     .              3.900D0,
     .              4.000D0,
     .              4.100D0,
     .              4.200D0,
     .              4.250D0,
     .              4.500D0,
     .              4.750D0,
     .              4.800D0,
     .              4.900D0,
     .              5.000D0,
     .              5.150D0,
     .              5.250D0,
     .              5.350D0,
     .              5.500D0,
     .              5.750D0,
     .              6.000D0,
     .              6.250D0,
     .              6.500D0,
     .              6.750D0,
     .              7.000D0,
     .              7.250D0,
     .              7.500D0,
     .              7.750D0,
     .              8.000D0,
     .              8.250D0,
     .              8.500D0,
     .              9.000D0,
     .              9.500D0,
     .             10.000D0,
     .             12.000D0,
     .             14.000D0,
     .             16.000D0,
     .             18.000D0,
     .             20.000D0,
     .             22.000D0,
     .             24.000D0,
     .              2.500D0,
     .              2.750D0,
     .              3.000D0,
     .              3.100D0,
     .              3.250D0,
     .              3.300D0,
     .              3.400D0,
     .              3.500D0,
     .              3.750D0,
     .              3.800D0,
     .              3.900D0,
     .              4.000D0,
     .              4.100D0,
     .              4.200D0,
     .              4.250D0,
     .              4.500D0,
     .              4.750D0,
     .              4.800D0,
     .              4.900D0,
     .              5.000D0,
     .              5.150D0,
     .              5.250D0,
     .              5.350D0,
     .              5.500D0,
     .              5.750D0,
     .              6.000D0,
     .              6.250D0,
     .              6.500D0,
     .              6.750D0,
     .              7.000D0,
     .              7.250D0,
     .              7.500D0,
     .              7.750D0,
     .              8.000D0,
     .              8.250D0,
     .              8.500D0,
     .              9.000D0,
     .              9.500D0,
     .             10.000D0,
     .             12.000D0,
     .             14.000D0,
     .             16.000D0,
     .             18.000D0,
     .             20.000D0,
     .             22.000D0,
     .             24.000D0,
     .              3.750D0,
     .              3.800D0,
     .              3.900D0,
     .              4.000D0,
     .              4.100D0,
     .              4.200D0,
     .              4.250D0,
     .              4.500D0,
     .              4.750D0,
     .              4.800D0,
     .              4.900D0,
     .              5.000D0,
     .              5.150D0,
     .              5.250D0,
     .              5.350D0,
     .              5.500D0,
     .              5.750D0,
     .              6.000D0,
     .              6.250D0,
     .              6.500D0,
     .              6.750D0,
     .              7.000D0,
     .              7.250D0,
     .              7.500D0,
     .              7.750D0,
     .              8.000D0,
     .              8.250D0,
     .              8.500D0,
     .              9.000D0,
     .              9.500D0,
     .             10.000D0,
     .             12.000D0,
     .             14.000D0,
     .             16.000D0,
     .             18.000D0,
     .             20.000D0,
     .             22.000D0,
     .             24.000D0,
     .              4.750D0,
     .              4.800D0,
     .              4.900D0,
     .              5.000D0,
     .              5.150D0,
     .              5.250D0,
     .              5.350D0,
     .              5.500D0,
     .              5.750D0,
     .              6.000D0,
     .              6.250D0,
     .              6.500D0,
     .              6.750D0,
     .              7.000D0,
     .              7.250D0,
     .              7.500D0,
     .              7.750D0,
     .              8.000D0,
     .              8.250D0,
     .              8.500D0,
     .              9.000D0,
     .              9.500D0,
     .             10.000D0,
     .             12.000D0/
      DATA R2/
     .           14.000D0,
     .           16.000D0,
     .           18.000D0,
     .           20.000D0,
     .           22.000D0,
     .           24.000D0,
     .            5.000D0,
     .            5.150D0,
     .            5.250D0,
     .            5.350D0,
     .            5.500D0,
     .            5.750D0,
     .            6.000D0,
     .            6.250D0,
     .            6.500D0,
     .            6.750D0,
     .            7.000D0,
     .            7.250D0,
     .            7.500D0,
     .            7.750D0,
     .            8.000D0,
     .            8.250D0,
     .            8.500D0,
     .            9.000D0,
     .            9.500D0,
     .           10.000D0,
     .           12.000D0,
     .           14.000D0,
     .           16.000D0,
     .           18.000D0,
     .           20.000D0,
     .           22.000D0,
     .           24.000D0,
     .            5.150D0,
     .            5.250D0,
     .            5.350D0,
     .            5.500D0,
     .            5.750D0,
     .            6.000D0,
     .            6.250D0,
     .            6.500D0,
     .            6.750D0,
     .            7.000D0,
     .            7.250D0,
     .            7.500D0,
     .            7.750D0,
     .            8.000D0,
     .            8.250D0,
     .            8.500D0,
     .            9.000D0,
     .            9.500D0,
     .           10.000D0,
     .           12.000D0,
     .           14.000D0,
     .           16.000D0,
     .           18.000D0,
     .           20.000D0,
     .           22.000D0,
     .           24.000D0,
     .            4.500D0,
     .            4.750D0,
     .            4.800D0,
     .            4.900D0,
     .            5.000D0,
     .            5.150D0,
     .            5.250D0,
     .            5.350D0,
     .            5.500D0,
     .            5.750D0,
     .            6.000D0,
     .            6.250D0,
     .            6.500D0,
     .            6.750D0,
     .            7.000D0,
     .            7.250D0,
     .            7.500D0,
     .            7.750D0,
     .            8.000D0,
     .            8.250D0,
     .            8.500D0,
     .            9.000D0,
     .            9.500D0,
     .           10.000D0,
     .           12.000D0,
     .           14.000D0,
     .           16.000D0,
     .           18.000D0,
     .           20.000D0,
     .           22.000D0,
     .           24.000D0,
     .            4.100D0,
     .            4.200D0,
     .            4.250D0,
     .            4.500D0,
     .            4.750D0,
     .            4.800D0,
     .            4.900D0,
     .            5.000D0,
     .            5.150D0,
     .            5.250D0,
     .            5.350D0,
     .            5.500D0,
     .            5.750D0,
     .            6.000D0,
     .            6.250D0,
     .            6.500D0,
     .            6.750D0,
     .            7.000D0,
     .            7.250D0,
     .            7.500D0,
     .            7.750D0,
     .            8.000D0,
     .            8.250D0,
     .            8.500D0,
     .            9.000D0,
     .            9.500D0,
     .           10.000D0,
     .           12.000D0,
     .           14.000D0,
     .           16.000D0,
     .           18.000D0,
     .           20.000D0,
     .           22.000D0,
     .           24.000D0,
     .            3.800D0,
     .            3.900D0,
     .            4.000D0,
     .            4.100D0,
     .            4.200D0,
     .            4.250D0,
     .            4.500D0,
     .            4.750D0,
     .            4.800D0,
     .            4.900D0,
     .            5.000D0,
     .            5.150D0,
     .            5.250D0,
     .            5.350D0,
     .            5.500D0,
     .            5.750D0,
     .            6.000D0,
     .            6.250D0,
     .            6.500D0,
     .            6.750D0,
     .            7.000D0,
     .            7.250D0,
     .            7.500D0,
     .            7.750D0,
     .            8.000D0,
     .            8.250D0,
     .            8.500D0,
     .            9.000D0,
     .            9.500D0,
     .           10.000D0,
     .           12.000D0,
     .           14.000D0,
     .           16.000D0,
     .           18.000D0,
     .           20.000D0,
     .           22.000D0,
     .           24.000D0,
     .            2.500D0,
     .            2.750D0,
     .            3.000D0,
     .            3.100D0,
     .            3.250D0,
     .            3.300D0,
     .            3.400D0,
     .            3.500D0,
     .            3.750D0,
     .            3.800D0,
     .            3.900D0,
     .            4.000D0,
     .            4.100D0,
     .            4.200D0,
     .            4.250D0,
     .            4.500D0,
     .            4.750D0,
     .            4.800D0,
     .            4.900D0,
     .            5.000D0,
     .            5.150D0,
     .            5.250D0,
     .            5.350D0,
     .            5.500D0,
     .            5.750D0,
     .            6.000D0,
     .            6.250D0,
     .            6.500D0,
     .            6.750D0,
     .            7.000D0,
     .            7.250D0,
     .            7.500D0,
     .            7.750D0,
     .            8.000D0,
     .            8.250D0,
     .            8.500D0,
     .            9.000D0,
     .            9.500D0,
     .           10.000D0,
     .           12.000D0,
     .           14.000D0,
     .           16.000D0,
     .           18.000D0,
     .           20.000D0,
     .           22.000D0,
     .           24.000D0/

      DATA THETA1/
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .              0.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             20.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             40.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             60.000D0,
     .             80.000D0,
     .             80.000D0,
     .             80.000D0,
     .             80.000D0,
     .             80.000D0,
     .             80.000D0,
     .             80.000D0,
     .             80.000D0,
     .             80.000D0,
     .             80.000D0,
     .             80.000D0,
     .             80.000D0,
     .             80.000D0,
     .             80.000D0,
     .             80.000D0,
     .             80.000D0,
     .             80.000D0,
     .             80.000D0,
     .             80.000D0,
     .             80.000D0,
     .             80.000D0,
     .             80.000D0,
     .             80.000D0,
     .             80.000D0/
       DATA THETA2 /
     .              80.000D0,
     .              80.000D0,
     .              80.000D0,
     .              80.000D0,
     .              80.000D0,
     .              80.000D0,
     .              90.000D0,
     .              90.000D0,
     .              90.000D0,
     .              90.000D0,
     .              90.000D0,
     .              90.000D0,
     .              90.000D0,
     .              90.000D0,
     .              90.000D0,
     .              90.000D0,
     .              90.000D0,
     .              90.000D0,
     .              90.000D0,
     .              90.000D0,
     .              90.000D0,
     .              90.000D0,
     .              90.000D0,
     .              90.000D0,
     .              90.000D0,
     .              90.000D0,
     .              90.000D0,
     .              90.000D0,
     .              90.000D0,
     .              90.000D0,
     .              90.000D0,
     .              90.000D0,
     .              90.000D0,
     .             100.000D0,
     .             100.000D0,
     .             100.000D0,
     .             100.000D0,
     .             100.000D0,
     .             100.000D0,
     .             100.000D0,
     .             100.000D0,
     .             100.000D0,
     .             100.000D0,
     .             100.000D0,
     .             100.000D0,
     .             100.000D0,
     .             100.000D0,
     .             100.000D0,
     .             100.000D0,
     .             100.000D0,
     .             100.000D0,
     .             100.000D0,
     .             100.000D0,
     .             100.000D0,
     .             100.000D0,
     .             100.000D0,
     .             100.000D0,
     .             100.000D0,
     .             100.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             120.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             140.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             160.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0,
     .             180.000D0/
     
      DATA VCOEF1/
     .            23092795740.3262100219726562D0, 
     .           -34479574574.5429916381835938D0,
     .            23276661953.8395195007324219D0,
     .           -13736153575.2621154785156250D0,
     .             1508607254.0388567447662354D0,
     .             -444120761.3152050971984863D0,
     .             -324955884.9531007409095764D0,
     .             1212777166.1337935924530029D0,
     .             -675499532.9111161231994629D0,
     .              364433410.7020100951194763D0,
     .             -427015570.9131940007209778D0,
     .              625260098.7054095268249512D0,
     .             -218178753.4012194275856018D0,
     .               13787062.2106401063501835D0,
     .            -1935232618.7997238636016846D0,
     .             2013125491.8292107582092285D0,
     .             -250444274.4069581329822540D0,
     .              674658153.3941773176193237D0,
     .            -1412061503.5253696441650391D0,
     .              950937116.5246207714080811D0,
     .             -260351104.1752514839172363D0,
     .               22862925.6166418865323067D0,
     .               13696462.1397831458598375D0,
     .               61170955.7017747685313225D0,
     .               72046581.6635076999664307D0,
     .               77757319.8328657597303391D0,
     .               65482144.6390266194939613D0,
     .               54770742.3451209142804146D0,
     .               40058173.1051778048276901D0,
     .               32861160.9170640893280506D0,
     .               17788555.7530217282474041D0,
     .               17698519.6325375847518444D0,
     .                 604847.6256132097914815D0,
     .                6417071.1112622125074267D0,
     .               -3905861.8200243311002851D0,
     .               -5377361.0215423218905926D0,
     .              -12405864.3904476072639227D0,
     .              -27250150.5743684619665146D0,
     .                -377385.1440169084235094D0,
     .               -2766733.1514719841070473D0,
     .                1030630.8534696570131928D0,
     .               -4122592.4137536738999188D0,
     .                3981928.7843842366710305D0,
     .               -3342121.8424896649084985D0,
     .            12830653865.3734359741210938D0,
     .           -43772494645.9513473510742188D0,
     .           169174948632.3132019042968750D0,
     .          -214852020202.3634338378906250D0,
     .           164227864476.4625854492187500D0,
     .           -95579488574.7215118408203125D0,
     .            12404825205.8885478973388672D0,
     .            -3337410641.6981334686279297D0,
     .             2133783455.8042824268341064D0,
     .            -4810105038.3495063781738281D0,
     .             1500959092.5701594352722168D0,
     .            -1219761927.5457611083984375D0,
     .              779944733.5794268846511841D0,
     .             -907414835.5075492858886719D0,
     .              502063222.4599015116691589D0,
     .             -244437047.8075387775897980D0,
     .             2991576656.3008041381835938D0,
     .            -3400029815.7168316841125488D0,
     .              226104950.6644559502601624D0,
     .            -1780111387.0827076435089111D0,
     .             2843773529.9348206520080566D0,
     .            -2006576843.6969065666198730D0,
     .              449356748.5986661911010742D0,
     .               34529348.7354581430554390D0,
     .              300723942.4589837789535522D0,
     .              348395708.3899065852165222D0,
     .              349558262.3656947612762451D0,
     .              295615728.8401453495025635D0,
     .              228206860.3118911087512970D0,
     .              177049070.8814584910869598D0,
     .              127865248.6336607486009598D0,
     .               83973279.3382417261600494D0,
     .               71496870.4241472780704498D0,
     .               12238947.3583563435822725D0,
     .               38581891.0445498675107956D0,
     .               -5284212.1503330040723085D0,
     .              -16847319.7345648705959320D0,
     .               20131284.0186607688665390D0,
     .              -76055208.1426191776990891D0,
     .             -138541825.5153657197952271D0,
     .                5089279.8050776114687324D0,
     .               -5717114.1660041064023972D0,
     .              -20304556.0414973571896553D0,
     .                9780071.0784453563392162D0,
     .               -6852475.0399842550978065D0,
     .               -2481930.6819703797809780D0,
     .           -11026125920.3238010406494141D0,
     .            65369621091.4787216186523438D0,
     .          -387100540238.2198486328125000D0,
     .           540406315612.0474243164062500D0,
     .          -435382820750.4566040039062500D0,
     .           253806552376.5062866210937500D0,
     .           -31864172569.4651260375976562D0,
     .             7937582738.4396982192993164D0,
     .             1286171701.8283634185791016D0,
     .            -2268571711.9191851615905762D0,
     .              131379111.9767262339591980D0,
     .             -181666626.7206954658031464D0,
     .            -1454838454.6774349212646484D0,
     .             1745606164.4670231342315674D0,
     .            -1268133346.9400966167449951D0,
     .             -936596806.0129894018173218D0,
     .            -6484792180.2632122039794922D0,
     .             6874076398.2152957916259766D0,
     .             -849778536.1268777847290039D0,
     .             1170521460.7846522331237793D0,
     .            -1520383787.1477541923522949D0,
     .             1176925150.7966823577880859D0,
     .             -114400629.9582824856042862D0,
     .              298105728.1545095443725586D0,
     .              208321175.9000206887722015D0,
     .               94509688.1326137483119965D0,
     .                9256915.5948263090103865D0,
     .              -23509620.1657352410256863D0,
     .              -32327430.9978984370827675D0,
     .              -35427044.7403171584010124D0,
     .              -16830085.0931801237165928D0,
     .              -15678972.1798456851392984D0,
     .               -6008439.2606058884412050D0,
     .                 491177.2796594904502854D0,
     .                2064493.7053639260120690D0,
     .               31199647.0750845409929752D0,
     .               29932187.8241446502506733D0,
     .               75940764.3524071425199509D0,
     .              -53754567.7434320673346519D0,
     .              -30100836.2695675119757652D0,
     .                5446053.1920506739988923D0,
     .               -6066938.3752986053004861D0,
     .               -7566128.7713700924068689D0,
     .                2752261.6420178408734500D0,
     .               -3954871.4784936788491905D0,
     .               -1968156.5354250418022275D0,
     .            -8993126865.7792949676513672D0,
     .             7585567458.0669231414794922D0,
     .             3363668215.3686456680297852D0,
     .             -219499767.0817124545574188D0,
     .            -1573405613.2189488410949707D0,
     .             2927392611.1513614654541016D0,
     .             -944606536.4629153013229370D0,
     .             -835273639.4814721345901489D0,
     .           -15051710691.6903305053710938D0,
     .            16363198044.6101474761962891D0,
     .            -1926083480.2537236213684082D0,
     .              870487938.2682449817657471D0,
     .            -3898263354.5669608116149902D0,
     .             4280197128.6601500511169434D0,
     .            -1100728618.6890413761138916D0,
     .              -13259080.7656563222408295D0,
     .             -315534614.7156488299369812D0,
     .             -268334201.4993233084678650D0,
     .             -241486093.1114495396614075D0,
     .             -193161095.4701724052429199D0,
     .             -137039664.9401140213012695D0,
     .              -98722828.5748409479856491D0,
     .              -59188702.8740815669298172D0,
     .              -11256015.7726005613803864D0,
     .              -22157481.4263973608613014D0,
     .               72801318.6246849894523621D0,
     .              -17188275.9656277038156986D0,
     .              100291680.0607105642557144D0,
     .              105036512.2739842087030411D0,
     .               15474130.8297282271087170D0,
     .              116034465.8642234057188034D0,
     .              106374151.7831316590309143D0,
     .              -10314240.4977144077420235D0,
     .               -2494292.9811759446747601D0,
     .               16800599.3138881400227547D0,
     .              -32558099.3035462312400341D0,
     .               38205810.8568465411663055D0,
     .              -21597090.3387611731886864D0,
     .            45675415515.8980560302734375D0,
     .           -47821422060.9256896972656250D0,
     .             5442723623.6706295013427734D0,
     .           -14607340407.9325275421142578D0,
     .            29311872065.3623580932617188D0,
     .           -22070684868.6398239135742188D0,
     .             5111766155.2340393066406250D0,
     .            -1222688290.2185878753662109D0,
     .             -152070035.6863631308078766D0,
     .             -248061377.3075999617576599D0,
     .              -99643642.0464322715997696D0,
     .              -69347783.0662887990474701D0,
     .              -27762341.8582338765263557D0,
     .               -7254915.1896373881027102D0,
     .               48035452.7850887700915337D0,
     .              -12826790.1786715872585773D0,
     .              133568596.9037150144577026D0,
     .              -25037342.4826090596616268D0,
     .              135724300.3480714261531830D0,
     .               40429672.1492394730448723D0,
     .              138972768.1975903809070587D0,
     .               20628811.2504454441368580D0,
     .              207232665.3169269561767578D0,
     .               99768424.5603480786085129D0/
         DATA VCOEF2/               
     .               -28122246.5028472542762756D0,
     .                22094082.3755243979394436D0,
     .               -37504647.0343720316886902D0,
     .                64147215.5668610632419586D0,
     .               -91979458.7732433229684830D0,
     .                58888456.4456582441926003D0,
     .             15926967599.7907409667968750D0,
     .            -47533584524.6642837524414062D0,
     .             40293969410.8920135498046875D0,
     .             -9832482274.2044658660888672D0,
     .              1558610065.7148866653442383D0,
     .              -309999129.9916262626647949D0,
     .                53637025.5591742545366287D0,
     .               -62077704.8743233159184456D0,
     .               -48211471.7366920337080956D0,
     .               -28544338.0699616856873035D0,
     .                -3371983.8063026177696884D0,
     .               -59504171.2188396975398064D0,
     .                79046014.6358001977205276D0,
     .              -133656103.0452174842357635D0,
     .               123745106.2477076500654221D0,
     .              -106550555.1770142763853073D0,
     .                63622814.1936504691839218D0,
     .                -8235207.7664829222485423D0,
     .                10095885.0227325037121773D0,
     .                 1596889.8445444190874696D0,
     .                12360144.9405959118157625D0,
     .                 2611409.8344933209009469D0,
     .                -6255267.6728565199300647D0,
     .                27887777.4587011262774467D0,
     .               -67916761.8314860165119171D0,
     .               107738477.1377761363983154D0,
     .               -70897171.0120177865028381D0,
     .             23943223663.5134086608886719D0,
     .            -29867603908.0105705261230469D0,
     .              7052852758.0172090530395508D0,
     .             -1482244610.2648630142211914D0,
     .               -58888468.4489063769578934D0,
     .              -202548492.5052129328250885D0,
     .               -88633913.6942991316318512D0,
     .                 -763584.1842180109815672D0,
     .               -31792823.7653017304837704D0,
     .                18969314.7199526689946651D0,
     .                57801054.7767284289002419D0,
     .               -16545550.9542314503341913D0,
     .               139200445.2366498410701752D0,
     .               -27143465.0227306522428989D0,
     .               110544854.7392248809337616D0,
     .                51304615.5349221676588058D0,
     .               121287534.9524920582771301D0,
     .                44931058.5313494056463242D0,
     .               163131871.0476610362529755D0,
     .                75407369.3545038700103760D0,
     .               -26520028.7249931953847408D0,
     .                12979371.7818287573754787D0,
     .               -23362594.9152855053544044D0,
     .                56277539.6633210182189941D0,
     .               -83986330.1559239327907562D0,
     .                48227801.3744531348347664D0,
     .              6171122228.6857881546020508D0,
     .            -25799785113.2354927062988281D0,
     .             22379606317.5750007629394531D0,
     .             -2607634646.2776207923889160D0,
     .              -819482456.4573781490325928D0,
     .             -3254439831.0805683135986328D0,
     .              5382684325.0818786621093750D0,
     .             -1426070788.6073603630065918D0,
     .               132643859.3174381405115128D0,
     .              -170445744.5331101119518280D0,
     .               -82514668.4185730665922165D0,
     .               -93585007.9128130674362183D0,
     .               -33388676.3793441578745842D0,
     .               -51455287.1408639997243881D0,
     .                 1185059.7128611248917878D0,
     .               -20099897.7685120590031147D0,
     .                35239166.4964914470911026D0,
     .               -22537303.4857313148677349D0,
     .                49673138.1289434283971786D0,
     .                -3852866.5897127431817353D0,
     .                44298938.3351686000823975D0,
     .                52994182.3860580101609230D0,
     .                21829134.5077456384897232D0,
     .                68557600.8195753693580627D0,
     .                32975710.0010868944227695D0,
     .               -10616880.5258261431008577D0,
     .                -3713519.0621770191937685D0,
     .                15625966.0655471347272396D0,
     .               -21664548.6310537979006767D0,
     .                14485429.1578396130353212D0,
     .                -4930490.1387307457625866D0,
     .             10899578246.6567840576171875D0,
     .            -17463245187.0746803283691406D0,
     .              5608144215.4342842102050781D0,
     .             -2604283487.4475183486938477D0,
     .              5167863654.8778171539306641D0,
     .             -3181440427.7678885459899902D0,
     .               643413899.9423127174377441D0,
     .              -551936215.0400342941284180D0,
     .              -557560978.7214215993881226D0,
     .              2288474489.6445078849792480D0,
     .              -279114591.3941955566406250D0,
     .               280557143.7190266251564026D0,
     .                93631189.9949005097150803D0,
     .                 5748305.8516647890210152D0,
     .                 2921576.2965152724646032D0,
     .              -109315895.9553678929805756D0,
     .                27883098.8301900476217270D0,
     .               -71708277.1131147146224976D0,
     .               -18775230.7446656264364719D0,
     .               -22090165.4178576730191708D0,
     .               -35024272.2549113482236862D0,
     .                -6046235.9355522012338042D0,
     .               -21849033.2432330399751663D0,
     .               -16860282.7925511896610260D0,
     .               -30748153.2653949446976185D0,
     .               -12506467.5255542546510696D0,
     .               -36694374.9924012944102287D0,
     .               -21036775.8774046674370766D0,
     .                 2056733.6930611152201891D0,
     .                -7378590.8412494836375117D0,
     .                11908016.1380871646106243D0,
     .               -26656157.2819432280957699D0,
     .                39407840.8962592259049416D0,
     .               -23239514.9259936474263668D0,
     .             14936750061.2865066528320312D0,
     .            -20660642822.5058288574218750D0,
     .              4570267493.4560670852661133D0,
     .             -5224348431.4024085998535156D0,
     .              6382674813.0300350189208984D0,
     .             -1756545387.2290563583374023D0,
     .              -488063553.1159021854400635D0,
     .              1058085032.1983376741409302D0,
     .                 7866809.2449813345447183D0,
     .               191590794.3435797393321991D0,
     .               161112371.2858384549617767D0,
     .              2734717886.5814695358276367D0,
     .             -2650623742.7555212974548340D0,
     .               870096175.9684103727340698D0,
     .               111839190.2819045782089233D0,
     .               147560645.0797961354255676D0,
     .                11514712.1891295593231916D0,
     .               -21019319.8598006106913090D0,
     .               -16121700.5322087816894054D0,
     .               -48693205.0565529540181160D0,
     .               -22377942.0051368847489357D0,
     .               -30578202.2145823724567890D0,
     .               -34303961.9715307652950287D0,
     .                -5826288.4207230899482965D0,
     .               -40732498.9296812117099762D0,
     .                -8363792.0733832828700542D0,
     .               -36247933.6974939182400703D0,
     .               -47224182.2863222658634186D0,
     .               -22690556.0834364481270313D0,
     .               -59909945.6751262098550797D0,
     .               -25204902.9004962779581547D0,
     .                 3126066.9368129004724324D0,
     .                -1431896.7226848003920168D0,
     .                -4785134.3649913575500250D0,
     .                 9107246.0375414658337831D0,
     .                -6932985.6672314051538706D0,
     .                 1599356.8020151318050921D0,
     .               668985755.4271870851516724D0,
     .             -3170916805.7788109779357910D0,
     .             16932064861.2310619354248047D0,
     .            -23738632831.5366020202636719D0,
     .             19706505094.3647232055664062D0,
     .            -11479644905.1028327941894531D0,
     .              1449141958.7311894893646240D0,
     .              -378790602.9345162510871887D0,
     .               284102298.4686219692230225D0,
     .             -4460027588.3497619628906250D0,
     .              5688867095.1325941085815430D0,
     .             -1402131353.2420535087585449D0,
     .              -156078333.1812246739864349D0,
     .               535836658.8011304140090942D0,
     .              -322678567.1989965438842773D0,
     .               167540272.2295531630516052D0,
     .              -466928748.5284626483917236D0,
     .               197580812.0104706585407257D0,
     .               -35430611.8552500680088997D0,
     .                -3637772.5080013275146484D0,
     .             -1102593525.7106561660766602D0,
     .              1372035958.2584323883056641D0,
     .              -321082650.0508201122283936D0,
     .                75227938.6422338932752609D0,
     .                 5467206.3604799322783947D0,
     .                 6745426.9343924149870872D0,
     .                -1499194.7421312453225255D0,
     .                  152126.6809985425206833D0,
     .                -5745869.0065905349329114D0,
     .                 -850743.4340431911405176D0,
     .                -4834545.4471013033762574D0,
     .                  -52278.8193659601165564D0,
     .                -7404126.0374316461384296D0,
     .                 1048836.0329411532729864D0,
     .                -4287993.1948530143126845D0,
     .                -5485548.1378772668540478D0,
     .                -8028056.5779850482940674D0,
     .                -3916460.7844366407953203D0,
     .                -8340875.7449064617976546D0,
     .                -4167433.7130199009552598D0,
     .                  655226.0731320534832776D0,
     .                 -522298.6189026608481072D0,
     .                  296907.5643561522592790D0,
     .                  131241.9507320474367589D0,
     .                -1479353.0029812389984727D0,
     .                 1266227.1406982007902116D0/
         
C Kernel parameters
      N1=2
      M=5
      N2=10
      M2=0
C
      DO I=1,NPT 
      IF (I.LE.198) THEN 
       VCOEF(I)=VCOEF1(I)
       R(I)=R1(I)
       THETA(I)=THETA1(I)
      ELSE
       VCOEF(I)=VCOEF2(I-198)
       R(I)=R2(I-198)
       THETA(I)=THETA2(I-198)
      ENDIF
      ENDDO
      PI=DACOS(-1.D0)
      FACT=PI/180.D0
C      EVALUATE PES    
       SUMA=ZERO
       XTT=DCOS(TT*FACT)
       DO I=1,NPT
        TI=DCOS(THETA(I)*FACT)
        SUMA=SUMA+VCOEF(I)*RKHS_DK(R(I),RR,N1,M)*RKHS_OP(TI,XTT,N2,M2)
       END DO
       VPES=SUMA
       RETURN
       END

C------RKHS ROUTINES

C------------------------RKHS---------------------------------
C Fortran  Deck with distance-like and angular-like 
C kernels for RKHS interpolation method
C****************************************************
C* By J. KLOS  12/05/2007   University of Maryland  *
C* REVISON: 1.0                                     * 
C* jasztol@gmail.com                                *
C****************************************************
C-------------------------------------------------------------
C FUNCTIONS:
C
C RKHS_DK(X,Y,N,M): Reproducing kernel for  distance-like (DK) 
C                   variables, see Ho, Rabitz Eq(17) of
C                   J. Chem. Phys. 104, 2584 (1996) 
C                   Range = [0, inf]
C
C  INPUT: X,Y-DOUBLE PRECISION
C          N:INTEGER:ORDER OF SMOOTHNESS OF THE FUNCTION
C          M>=0:INTEGER:RECIPROCAL POWER OF THE WEIGHT W(X)=X**(-M)
C  OUTPUT: DOUBLE PRECISION
C -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -            
C RKHS_AK(X,Y,N): Reproducing kernel for  angular-like (AK) 
C                   variables, see Ho, Rabitz Eq(23) of
C                   J. Chem. Phys. 104, 2584 (1996) 
C                    Range = [0, 1]
C    
C  INPUT: X,Y-DOUBLE PRECISION
C          N:INTEGER:ORDER OF SMOOTHNESS OF THE FUNCTION
C  OUPUT: DOUBLE PRECISION
C  HINT: SCALE ANGLES TO [0,1] INTEGRAL FOR ANGLES, FOR EXAMPLE: 
C          X=(1.d0-cosd(ANGLE))/2.d0
C -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -
C RKHS_OP(X,Y,N,M):Reproducing kernel for angular like 
C                    variables with a use of orthogonal 
C                    polynomials Plm(L,M,X) where X is 
C                    K=SUM_L=M^N PLM(X)PLM(X')
C                    variable transformed from angles as
C                    x=cos(theta)
C-------------------------------------------------------------
       DOUBLE PRECISION FUNCTION RKHS_DK(X,Y,N,M)
       IMPLICIT DOUBLE PRECISION (A-H,O-Z)
       IF (X .LT. Y) THEN
           XB=X
           XU=Y
       ELSE
           XB=Y
           XU=X
       ENDIF

C       M=ABS(M)! FORCE M>=0
       NSQR=N*N
       XUPOWM=XU**(-(M+1))

C      TERM WITH BETA FUNCTION
       CALL BETA(DFLOAT(M+1),DFLOAT(N),BETATERM)

C      GET TERM WITH 2F1 HYPERGEOMETRIC  GAUSS FUNCTION
       CALL HYGFX(DFLOAT(-N+1),DFLOAT(M+1),DFLOAT(N+M+1),XB/XU,HF)
       RKHS_DK=NSQR*XUPOWM*BETATERM*HF
       RETURN
       END

C-------------------------------------------------------------
       DOUBLE PRECISION FUNCTION RKHS_EXPR(X,Y,XE,N)
       IMPLICIT DOUBLE PRECISION (A-H,O-Z)
       PARAMETER (ZERO=0.D0,ONE=1.D0)
       
       SUMA=ZERO
       Z1=(X-XE)/XE
       Z2=(Y-XE)/XE
       DO I=0,N
       SUMA=SUMA+(Z1**I)*(Z2**I)
       ENDDO

       RKHS_EXPR=SUMA
       RETURN
       END


C-------------------------------------------------------------
       DOUBLE PRECISION FUNCTION RKHS_AK(X,Y,N)
       IMPLICIT DOUBLE PRECISION (A-H,O-Z)
       PARAMETER (ZERO=0.D0,ONE=1.D0)
       
       IF ((X.EQ.ZERO).OR.(Y.EQ.ZERO)) THEN
          RKHS_AK=ONE
          RETURN
       ENDIF
       IF (X .LT. Y) THEN
           XB=X
           XU=Y
       ELSE
           XB=Y
           XU=X
       ENDIF

       SUMA=ZERO
C      GET POLYNOMIAL TERM
       DO I=0,N-1
       SUMA=SUMA+(XU**I)*(XB**I)
       END DO

C      GET TERM WITH 2F1 HYPERGEOMETRIC  GAUSS FUNCTION
       CALL HYGFX(DFLOAT(1),DFLOAT(-N+1),DFLOAT(N+1),XB/XU,HF)
       
       RKHS_AK=SUMA+N*(XB**N)*(XU**(N-1))*HF
       RETURN
       END

       DOUBLE PRECISION FUNCTION RKHS_OP(X,Y,N,M)
       IMPLICIT DOUBLE PRECISION (A-H,O-Z)
       PARAMETER (ZERO=0.D0,ONE=1.D0)

       SUMA=ZERO
C      GET ORTHOGONAL POLYNOMIAL TERM
       DO I=ABS(M),N
       SUMA=SUMA+PLGNDR(I,M,X)*PLGNDR(I,M,Y)
       END DO
       RKHS_OP=SUMA
       RETURN
       END

       DOUBLE PRECISION FUNCTION RKHS_OP2L(X,Y,N,M)
       IMPLICIT DOUBLE PRECISION (A-H,O-Z)
       PARAMETER (ZERO=0.D0,ONE=1.D0)
 
       SUMA=ZERO
C      GET ORTHOGONAL POLYNOMIAL TERM
       DO I=ABS(M),N,2
       SUMA=SUMA+PLGNDR(I,M,X)*PLGNDR(I,M,Y)
       END DO
       RKHS_OP2L=SUMA
       RETURN
       END


            


      FUNCTION PLGNDR(L,M,x)
      IMPLICIT DOUBLE PRECISION (A-H, O-Z)
      if(m.lt.0.or.m.gt.l.or.abs(x).gt.1.)pause
     *'bad arguments in plgndr'
      pmm=1.
      if(m.gt.0) then
        somx2=dsqrt((1.-x)*(1.+x))
        fact=1.
        do 11 i=1,m
          pmm=-pmm*fact*somx2
          fact=fact+2.
11      continue
      endif
      if(l.eq.m) then
        plgndr=pmm
      else
        pmmp1=x*(2*m+1)*pmm
        if(l.eq.m+1) then
          plgndr=pmmp1
        else
         do 12 ll=m+2,l
            pll=(x*(2*ll-1)*pmmp1-(ll+m-1)*pmm)/(ll-m)
            pmm=pmmp1
            pmmp1=pll
12        continue
          plgndr=pll
        endif
      endif
      return
      END



        SUBROUTINE BETA(P,Q,BT)
C
C       ==========================================
C       Purpose: Compute the beta function B(p,q)
C       Input :  p  --- Parameter  ( p > 0 )
C                q  --- Parameter  ( q > 0 )
C       Output:  BT --- B(p,q)
C       Routine called: GAMMA for computing (x)
C       ==========================================
C
        IMPLICIT DOUBLE PRECISION (A-H,O-Z)
        CALL GAMMA(P,GP)
        CALL GAMMA(Q,GQ)
        PPQ=P+Q
        CALL GAMMA(PPQ,GPQ)
        BT=GP*GQ/GPQ
        RETURN
        END


        SUBROUTINE GAMMA(X,GA)
C
C       ==================================================
C       Purpose: Compute gamma function (x)
C       Input :  x  --- Argument of ( x )
C                       ( x is not equal to 0,-1,-2,...)
C       Output:  GA --- (x)
C       ==================================================
C
        IMPLICIT DOUBLE PRECISION (A-H,O-Z)
        DIMENSION G(26)
        PI=3.141592653589793D0
        IF (X.EQ.INT(X)) THEN
           IF (X.GT.0.0D0) THEN
              GA=1.0D0
              M1=X-1
              DO 10 K=2,M1
10               GA=GA*K
           ELSE
              GA=1.0D+300
           ENDIF
        ELSE
           IF (DABS(X).GT.1.0D0) THEN
              Z=DABS(X)
              M=INT(Z)
              R=1.0D0
              DO 15 K=1,M
15               R=R*(Z-K)
              Z=Z-M
           ELSE
              Z=X
           ENDIF
           DATA G/1.0D0,0.5772156649015329D0,
     &          -0.6558780715202538D0, -0.420026350340952D-1,
     &          0.1665386113822915D0,-.421977345555443D-1,
     &          -.96219715278770D-2, .72189432466630D-2,
     &          -.11651675918591D-2, -.2152416741149D-3,
     &          .1280502823882D-3, -.201348547807D-4,
     &          -.12504934821D-5, .11330272320D-5,
     &          -.2056338417D-6, .61160950D-8,
     &          .50020075D-8, -.11812746D-8,
     &          .1043427D-9, .77823D-11,
     &          -.36968D-11, .51D-12,
     &          -.206D-13, -.54D-14, .14D-14, .1D-15/
           GR=G(26)
           DO 20 K=25,1,-1
20            GR=GR*Z+G(K)
           GA=1.0D0/(GR*Z)
           IF (DABS(X).GT.1.0D0) THEN
              GA=GA*R
              IF (X.LT.0.0D0) GA=-PI/(X*GA*DSIN(PI*X))
           ENDIF
        ENDIF
        RETURN
        END



        SUBROUTINE HYGFX(A,B,C,X,HF)
C
C       ====================================================
C       Purpose: Compute hypergeometric function F(a,b,c,x)
C       Input :  a --- Parameter
C                b --- Parameter
C                c --- Parameter, c <> 0,-1,-2,...
C                x --- Argument   ( x < 1 )
C       Output:  HF --- F(a,b,c,x)
C       Routines called:
C            (1) GAMMA for computing gamma function
C            (2) PSI_AAA for computing psi function
C       ====================================================
C
        IMPLICIT DOUBLE PRECISION (A-H,O-Z)
        LOGICAL L0,L1,L2,L3,L4,L5
        PI=3.141592653589793D0
        EL=.5772156649015329D0
        L0=C.EQ.INT(C).AND.C.LT.0.0
        L1=1.0D0-X.LT.1.0D-15.AND.C-A-B.LE.0.0
        L2=A.EQ.INT(A).AND.A.LT.0.0
        L3=B.EQ.INT(B).AND.B.LT.0.0
        L4=C-A.EQ.INT(C-A).AND.C-A.LE.0.0
        L5=C-B.EQ.INT(C-B).AND.C-B.LE.0.0
        IF (L0.OR.L1) THEN
           WRITE(*,*)'The hypergeometric series is divergent'
           RETURN
        ENDIF
        EPS=1.0D-15
        IF (X.GT.0.95) EPS=1.0D-8
        IF (X.EQ.0.0.OR.A.EQ.0.0.OR.B.EQ.0.0) THEN
           HF=1.0D0
           RETURN
        ELSE IF (1.0D0-X.EQ.EPS.AND.C-A-B.GT.0.0) THEN
           CALL GAMMA(C,GC)
           CALL GAMMA(C-A-B,GCAB)
           CALL GAMMA(C-A,GCA)
           CALL GAMMA(C-B,GCB)
           HF=GC*GCAB/(GCA*GCB)
           RETURN
        ELSE IF (1.0D0+X.LE.EPS.AND.DABS(C-A+B-1.0).LE.EPS) THEN
           G0=DSQRT(PI)*2.0D0**(-A)
           CALL GAMMA(C,G1)
           CALL GAMMA(1.0D0+A/2.0-B,G2)
           CALL GAMMA(0.5D0+0.5*A,G3)
           HF=G0*G1/(G2*G3)
           RETURN
        ELSE IF (L2.OR.L3) THEN
           IF (L2) NM=INT(ABS(A))
           IF (L3) NM=INT(ABS(B))
           HF=1.0D0
           R=1.0D0
           DO 10 K=1,NM
              R=R*(A+K-1.0D0)*(B+K-1.0D0)/(K*(C+K-1.0D0))*X
10            HF=HF+R
           RETURN
        ELSE IF (L4.OR.L5) THEN
           IF (L4) NM=INT(ABS(C-A))
           IF (L5) NM=INT(ABS(C-B))
           HF=1.0D0
           R=1.0D0
           DO 15 K=1,NM
              R=R*(C-A+K-1.0D0)*(C-B+K-1.0D0)/(K*(C+K-1.0D0))*X
15            HF=HF+R
           HF=(1.0D0-X)**(C-A-B)*HF
           RETURN
        ENDIF
        AA=A
        BB=B
        X1=X
        IF (X.LT.0.0D0) THEN
           X=X/(X-1.0D0)
           IF (C.GT.A.AND.B.LT.A.AND.B.GT.0.0) THEN
              A=BB
              B=AA
           ENDIF
           B=C-B
        ENDIF
        IF (X.GE.0.75D0) THEN
           GM=0.0D0
           IF (DABS(C-A-B-INT(C-A-B)).LT.1.0D-15) THEN
              M=INT(C-A-B)
              CALL GAMMA(A,GA)
              CALL GAMMA(B,GB)
              CALL GAMMA(C,GC)
              CALL GAMMA(A+M,GAM)
              CALL GAMMA(B+M,GBM)
              CALL PSI_AAA(A,PA)
              CALL PSI_AAA(B,PB)
              IF (M.NE.0) GM=1.0D0
              DO 30 J=1,ABS(M)-1
30               GM=GM*J
              RM=1.0D0
              DO 35 J=1,ABS(M)
35               RM=RM*J
              F0=1.0D0
              R0=1.0D0
              R1=1.0D0
              SP0=0.D0
              SP=0.0D0
              IF (M.GE.0) THEN
                 C0=GM*GC/(GAM*GBM)
                 C1=-GC*(X-1.0D0)**M/(GA*GB*RM)
                 DO 40 K=1,M-1
                    R0=R0*(A+K-1.0D0)*(B+K-1.0)/(K*(K-M))*(1.0-X)
40                  F0=F0+R0
                 DO 45 K=1,M
45                  SP0=SP0+1.0D0/(A+K-1.0)+1.0/(B+K-1.0)-1.0/K
                 F1=PA+PB+SP0+2.0D0*EL+DLOG(1.0D0-X)
                 DO 55 K=1,250
                    SP=SP+(1.0D0-A)/(K*(A+K-1.0))+(1.0-B)/(K*(B+K-1.0))
                    SM=0.0D0
                    DO 50 J=1,M
50                     SM=SM+(1.0D0-A)/((J+K)*(A+J+K-1.0))+1.0/
     &                    (B+J+K-1.0)
                    RP=PA+PB+2.0D0*EL+SP+SM+DLOG(1.0D0-X)
                    R1=R1*(A+M+K-1.0D0)*(B+M+K-1.0)/(K*(M+K))*(1.0-X)
                    F1=F1+R1*RP
                    IF (DABS(F1-HW).LT.DABS(F1)*EPS) GO TO 60
55                  HW=F1
60               HF=F0*C0+F1*C1
              ELSE IF (M.LT.0) THEN
                 M=-M
                 C0=GM*GC/(GA*GB*(1.0D0-X)**M)
                 C1=-(-1)**M*GC/(GAM*GBM*RM)
                 DO 65 K=1,M-1
                    R0=R0*(A-M+K-1.0D0)*(B-M+K-1.0)/(K*(K-M))*(1.0-X)
65                  F0=F0+R0
                 DO 70 K=1,M
70                  SP0=SP0+1.0D0/K
                 F1=PA+PB-SP0+2.0D0*EL+DLOG(1.0D0-X)
                 DO 80 K=1,250
                    SP=SP+(1.0D0-A)/(K*(A+K-1.0))+(1.0-B)/(K*(B+K-1.0))
                    SM=0.0D0
                    DO 75 J=1,M
75                     SM=SM+1.0D0/(J+K)
                    RP=PA+PB+2.0D0*EL+SP-SM+DLOG(1.0D0-X)
                    R1=R1*(A+K-1.0D0)*(B+K-1.0)/(K*(M+K))*(1.0-X)
                    F1=F1+R1*RP
                    IF (DABS(F1-HW).LT.DABS(F1)*EPS) GO TO 85
80                  HW=F1
85               HF=F0*C0+F1*C1
              ENDIF
           ELSE
              CALL GAMMA(A,GA)
              CALL GAMMA(B,GB)
              CALL GAMMA(C,GC)
              CALL GAMMA(C-A,GCA)
              CALL GAMMA(C-B,GCB)
              CALL GAMMA(C-A-B,GCAB)
              CALL GAMMA(A+B-C,GABC)
              C0=GC*GCAB/(GCA*GCB)
              C1=GC*GABC/(GA*GB)*(1.0D0-X)**(C-A-B)
              HF=0.0D0
              R0=C0
              R1=C1
              DO 90 K=1,250
                 R0=R0*(A+K-1.0D0)*(B+K-1.0)/(K*(A+B-C+K))*(1.0-X)
                 R1=R1*(C-A+K-1.0D0)*(C-B+K-1.0)/(K*(C-A-B+K))
     &              *(1.0-X)
                 HF=HF+R0+R1
                 IF (DABS(HF-HW).LT.DABS(HF)*EPS) GO TO 95
90               HW=HF
95            HF=HF+C0+C1
           ENDIF
        ELSE
           A0=1.0D0
           IF (C.GT.A.AND.C.LT.2.0D0*A.AND.
     &         C.GT.B.AND.C.LT.2.0D0*B) THEN
              A0=(1.0D0-X)**(C-A-B)
              A=C-A
              B=C-B
           ENDIF
           HF=1.0D0
           R=1.0D0
           DO 100 K=1,250
              R=R*(A+K-1.0D0)*(B+K-1.0D0)/(K*(C+K-1.0D0))*X
              HF=HF+R
              IF (DABS(HF-HW).LE.DABS(HF)*EPS) GO TO 105
100           HW=HF
105        HF=A0*HF
        ENDIF
        IF (X1.LT.0.0D0) THEN
           X=X1
           C0=1.0D0/(1.0D0-X)**AA
           HF=C0*HF
        ENDIF
        A=AA
        B=BB
        IF (K.GT.120) WRITE(*,115)
115     FORMAT(1X,'Warning! You should check the accuracy')
        RETURN
        END



        SUBROUTINE PSI_AAA(X,PS)
C
C       ======================================
C       Purpose: Compute Psi function
C       Input :  x  --- Argument of psi(x)
C       Output:  PS --- psi(x)
C       ======================================
C
        IMPLICIT DOUBLE PRECISION (A-H,O-Z)
        XA=DABS(X)
        PI=3.141592653589793D0
        EL=.5772156649015329D0
        S=0.0D0
        IF (X.EQ.INT(X).AND.X.LE.0.0) THEN
           PS=1.0D+300
           RETURN
        ELSE IF (XA.EQ.INT(XA)) THEN
           N=XA
           DO 10 K=1 ,N-1
10            S=S+1.0D0/K
           PS=-EL+S
        ELSE IF (XA+.5.EQ.INT(XA+.5)) THEN
           N=XA-.5
           DO 20 K=1,N
20            S=S+1.0/(2.0D0*K-1.0D0)
           PS=-EL+2.0D0*S-1.386294361119891D0
        ELSE
           IF (XA.LT.10.0) THEN
              N=10-INT(XA)
              DO 30 K=0,N-1
30               S=S+1.0D0/(XA+K)
              XA=XA+N
           ENDIF
           X2=1.0D0/(XA*XA)
           A1=-.8333333333333D-01
           A2=.83333333333333333D-02
           A3=-.39682539682539683D-02
           A4=.41666666666666667D-02
           A5=-.75757575757575758D-02
           A6=.21092796092796093D-01
           A7=-.83333333333333333D-01
           A8=.4432598039215686D0
           PS=DLOG(XA)-.5D0/XA+X2*(((((((A8*X2+A7)*X2+
     &        A6)*X2+A5)*X2+A4)*X2+A3)*X2+A2)*X2+A1)
           PS=PS-S
        ENDIF
        IF (X.LT.0.0) PS=PS-PI*DCOS(PI*X)/DSIN(PI*X)-1.0D0/X
        RETURN
        END
